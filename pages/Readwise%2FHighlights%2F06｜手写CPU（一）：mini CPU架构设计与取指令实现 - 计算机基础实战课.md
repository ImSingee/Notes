title:: Readwise/Highlights/06｜手写CPU（一）：mini CPU架构设计与取指令实现 - 计算机基础实战课
author:: [[彭东]]
full-title:: 06｜手写CPU（一）：mini CPU架构设计与取指令实现 - 计算机基础实战课
category:: #articles
url:: https://time.geekbang.org/column/article/547921

- 总体上看，流水线提高了指令的处理速度，缩短了程序执行的时间。 #Highlight #[[2022-08-08]]
- 以经典的五级流水线为例，流水线中一条指令的生命周期分为五个阶段：
  取指阶段（Instruction Fetch）：取指阶段是指将指令从存储器中读取出来的过程。程序指针寄存器用来指定当前指令在存储器中的位置。读取一条指令后，程序指针寄存器会根据指令的长度自动递增，或者改写成指定的地址。
  译码阶段（Instruction Decode）：指令译码是指将存储器中取出的指令进行翻译的过程。指令译码器对指令进行拆分和解释，识别出指令类别以及所需的各种操作数。
  执行阶段（Instruction Execute）：指令执行是指对指令进行真正运算的过程。例如指令是一条加法运算指令，则对操作数进行相加操作；如果是一条乘法运算指令，则进行乘法运算。在“执行”阶段最关键的模块为算术逻辑单元（Arithmetic Logical Unit，ALU），它是实施具体运算的硬件功能单元。
  访存阶段（Memory Access）：访存是指存储器访问指令将数据从存储器中读出，或写入存储器的过程。
  写回阶段（Write-Back）：写回是指将指令执行的结果写回通用寄存器的过程。如果是普通运算指令，该结果值来自于“执行”阶段计算的结果；如果是存储器读指令，该结果来自于“访存”阶段从存储器中读取出来的数据。 #Highlight #[[2022-08-08]]
- 如果指令执行之后发现跳转的条件不成立，这时预读取的指令就是无效的，需要对流水线进行冲刷（flush），把无效的指令都清除掉。 #Highlight #[[2022-08-09]]
- 预读取模块读出的指令，并不是全部都能发送后续模块去执行。 #Highlight #[[2022-08-09]]
- 不管指令是否跳转，都提前把跳转之后的下一条指令从存储器中读取出来，以备流水线的下一阶段使用，这就提高了 CPU 的执行效率。 #Highlight #[[2022-08-09]]
- 条件跳转指令执行时是否发生跳转，要根据相关的数据来判断，这就需要指令执行之后才能知道是否需要跳转 #Highlight #[[2022-08-09]]
- 条件跳转指令的操作码，也就是指令中的低 7 位数都是 7’b1100011。根据这一特点，我们就可以在指令解码之前，判断出接下来可能会发生跳转。 #Highlight #[[2022-08-09]]
- RISC-V 指令集中有两类分支跳转指令，分别是条件跳转指令和无条件跳转指令。 #Highlight #[[2022-08-09]]
- 由于我们的指令长度是 32 位的，也就是一条指令在存储器中占有 4 个字节的空间，所以一般情况下，CPU 中的程序计数器（PC）是以 4 递增的。 #Highlight #[[2022-08-09]]