title:: Readwise/Highlights/08 | 一个几乎每个系统必踩的坑儿：访问数据库超时 - 后端存储实战课
author:: [[李玥]]
full-title:: 08 | 一个几乎每个系统必踩的坑儿：访问数据库超时 - 后端存储实战课
category:: #articles
url:: https://time.geekbang.org/column/article/211008

- 当关键系统出现故障的时候，要有临时的降级方案，尽量减少故障带来的影响。 #Highlight #[[2022-08-06]]
- 做一个简单的静态页面的首页作为降级方案，只要包含商品搜索栏、大的品类和其他顶级功能模块入口的链接就可以了。在 Nginx 上做一个策略，如果请求首页数据超时的时候，直接返回这个静态的首页作为替代。这样后续即使首页再出现任何的故障，也可以暂时降级，用静态首页替代。至少不会影响到用户使用其他功能。 #Highlight #[[2022-08-06]]
- 上线一个定时监控和杀掉慢 SQL 的脚本。这个脚本每分钟执行一次，检测上一分钟内，有没有执行时间超过一分钟（这个阈值可以根据实际情况调整）的慢 SQL，如果发现，直接杀掉这个会话。 #Highlight #[[2022-08-06]]
- 首先，你需要知道的一点是，当数据库非常忙的时候，它执行任何一个 SQL 都很慢。所以，并不是说，慢 SQL 日志中记录的这些慢 SQL 都是有问题的 SQL。大部分情况下，导致问题的 SQL 只是其中的一条或者几条。不能简单地依据执行次数和执行时长进行判断，但是，单次执行时间特别长的 SQL，仍然是应该重点排查的对象。 #Highlight #[[2022-08-06]]
- 一般来说，慢 SQL 的日志中，会有这样一些信息：SQL、执行次数、执行时长。通过分析慢 SQL 找问题，并没有什么标准的方法，主要还是依靠经验。 #Highlight #[[2022-08-06]]