title:: Readwise/Highlights/网络是怎样连接的
author:: [[户根勤]]
full-title:: 网络是怎样连接的
category:: #books

- 要发送给Web服务器的HTTP消息是一种数字信息（digital data），因此也可以说是委托协议栈来发送数字信息 #Highlight #[[2023-04-16]]
- MTU是包含头部的总长度，因此需要从MTU减去头部的长度，然后得到的长度就是一个网络包中所能容纳的最大数据长度，这一长度叫作MSS #Highlight #[[2023-04-18]]
- 在进行收发数据操作之前，双方需要先建立起这条管道才行。建立管道的关键在于管道两端的数据出入口，这些出入口称为套接字。 #Highlight #[[2023-04-16]]
- 服务器一方先创建套接字，然后等待客户端向该套接字连接管道[插图]。当服务器进入等待状态时，客户端就可以连接管道了。具体来说，客户端也会先创建一个套接字，然后从该套接字延伸出管道，最后管道连接到服务器端的套接字上。当双方的套接字连接起来之后，通信准备就完成了。 #Highlight #[[2023-04-16]]
- 管道在连接时是由客户端发起的，但在断开时可以由客户端或服务器任意一方发起[插图]。其中一方断开后，另一方也会随之断开，当管道断开后，套接字也会被删除。 #Highlight #[[2023-04-16]]
- [插图] #Highlight #[[2023-04-18]]
- 浏览器等应用程序并不会自己去做连接管道、放入数据这些工作，而是委托协议栈来代劳 #Highlight #[[2023-04-16]]
- 发送数据的长度也需要告知接收方，不过这个并不是放在TCP头部里面的，因为用整个网络包的长度减去头部的长度就可以得到数据的长度，所以接收方可以用这种方法来进行计算。 #Highlight #[[2023-04-18]]
- 发送方说的是“现在发送的是从第××字节开始的部分，一共有××字节哦！”而接收方则回复说，“到第××字节之前的数据我已经都收到了哦！”这个返回ACK号的操作被称为确认响应，通过这样的方式，发送方就能够确认对方到底收到了多少数据。 #Highlight #[[2023-04-18]]
- 在实际的通信中，序号并不是从1开始的，而是需要用随机数计算出一个初始值，这是因为如果序号都从1开始，通信过程就会非常容易预测，有人会利用这一点来发动攻击。但是如果初始值是随机的，那么对方就搞不清楚序号到底是从多少开始计算的，因此需要在开始收发数据之前将初始值告知通信对象。大家应该还记得在我们刚才讲过的连接过程中，有一个将SYN控制位设为1并发送给服务器的操作，就是在这一步将序号的初始值告知对方的。实际上，在将SYN设为1的同时，还需要同时设置序号字段的值，而这里的值就代表序号的初始值[插图]。 #Highlight #[[2023-04-18]]
- 首先客户端先计算出一个序号，然后将序号和数据一起发送给服务器，服务器收到之后会计算ACK号并返回给客户端；相反地，服务器也需要先计算出另一个序号，然后将序号和数据一起发送给客户端，客户端收到之后计算ACK号并返回给服务器 #Highlight #[[2023-04-18]]
- 网卡、集线器、路由器都没有错误补偿机制，一旦检测到错误就直接丢弃相应的包。应用程序也是一样，因为采用TCP传输，即便发生一些错误对方最终也能够收到正确的数据，所以应用程序只管自顾自地发送这些数据就好了 #Highlight #[[2023-04-18]]
- 所谓滑动窗口，就是在发送一个包之后，不等待ACK号返回，而是直接发送后续的一系列包 #Highlight #[[2023-04-18]]
- 首先，接收方需要告诉发送方自己最多能接收多少数据，然后发送方根据这个值对数据发送操作进行控制，这就是滑动窗口方式的基本思路。 #Highlight #[[2023-04-18]]
- 更新窗口大小的时机应该是接收方从缓冲区中取出数据传递给应用程序的时候。这个操作是接收方应用程序发出请求时才会进行的，而发送方不知道什么时候会进行这样的操作，因此当接收方将数据传递给应用程序，导致接收缓冲区剩余容量增加时，就需要告知发送方，这就是更新窗口大小的时机 #Highlight #[[2023-04-18]]
- 接收方在发送ACK号和窗口更新时，并不会马上把包发送出去，而是会等待一段时间，在这个过程中很有可能会出现其他的通知操作，这样就可以把两种通知合并在一个包里面发送了。 #Highlight #[[2023-04-18]]