alias:: The Design of a Practical System for Fault-Tolerant Virtual Machines
file:: [vm-ft_1667223237327_0.pdf](../assets/vm-ft_1667223237327_0.pdf)
file-path:: ../assets/vm-ft_1667223237327_0.pdf

-
- 主从备份
	- 目的：在出现问题时可以让备机完全替代主机，以让客户端无感
	- 方案一：完全克隆，包括 CPU、内存、I/O 设备等
		- 问题：所需网络流量过高（特别是同步内存）
	- 方案二：状态机
		- 问题：可预测性 & 不可预测性
			- 不可预测事件：中断
			- 不可预测操作：读 CPU 时钟
- 基础设计
	- 对于一个 fault tolerant 的 VM，会在另一个物理机上启动一个 backup VM
	- 两个 VM 几乎同步（有一定时间差），状态称为 virtual lock-step
	- 两个 VM 的虚拟硬盘是在同一个共享存储上的
	- 所有的 I/O（包括网络 IO）都只发生在 primary VM 上
		- 所有发生的 IO 都会同步发送给 backup VM（利用网络，称为 logging channel）
		- backup VM 的写操作会被执行，但会被 hypervisor 丢弃（只有主 VM 的才会被真实发送）
	- 监控 VM 是否正常通过 heartbeat + logging channel 共同完成
- Deterministic Replay 实现
	- 将所有的 Non-deterministic 的事件和操作映射到 VM 状态机
	-
- ls-type:: annotation
  hl-page:: 2
  hl-color:: blue
  id:: 635fd2ee-107e-4746-8a1c-9451f09e1cad