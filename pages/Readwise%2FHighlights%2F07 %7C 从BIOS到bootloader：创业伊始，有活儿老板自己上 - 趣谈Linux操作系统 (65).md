title:: Readwise/Highlights/07 | 从BIOS到bootloader：创业伊始，有活儿老板自己上 - 趣谈Linux操作系统 (65)
author:: [[刘超]]
full-title:: 07 | 从BIOS到bootloader：创业伊始，有活儿老板自己上 - 趣谈Linux操作系统
category:: #articles
url:: https://time.geekbang.org/column/article/89739

- 在保护模式下，第 21 根要起作用了，于是我们就需要打开 Gate A20。 #Highlight #[[2021-07-14]]
	- **Note**: intel必须兼容8086，因此就加了个A20与门，当处于实模式时，关闭A20开关，即与门输出为0，这就等价于8086丢弃最高20位的1了，从而地址仍然会进行回卷，这样旧的软件就可以继续跑了。
	  同时，当我们在保护模式下运行基于80286的新程序时，就开启A20开关，即A20与门的输出与地址线A20保持一致，从而可以直接访问更宽的地址了
- 那就是打开 Gate A20 #Highlight #[[2021-07-14]]
	- **Note**: 因为8086只有20根地址线，即A0-A19。而段寄存器却只有16位，导致无法直接寻址20位的内存空间，因此intel使了个小把戏，即CS<<4: offset（16位)作为拼凑为20位的地址，而FFFF左移4位后与FFFF相加的值为10FFEF，结果为21位，最高位1被丢弃，从而100000-10FFEF回卷为00000-0FFEF。因此00000-0FFEF对应有两个逻辑地址，很多8086的程序员利用这个回卷特点进行编程。但是到80286时，地址线变为了24根，而CS中存放的也不再是段基地址，而是段选择子，通过段选择子拿到的段基地址可以很方便的扩充到24位，因此就可以访问整个16M地址空间了，但是为了不得罪老用户，intel必须兼容8086，因此就加了个A20与门，当处于实模式时，关闭A20开关，即与门输出为0，这就等价于8086丢弃最高20位的1了，从而地址仍然会进行回卷，这样旧的软件就可以继续跑了。同时，当我们在保护模式下运行基于80286的新程序时，就开启A20开关，即A20与门的输出与地址线A20保持一致，从而可以直接访问更宽的地址了
- 在 BIOS 的界面上。你会看到一个启动盘的选项。启动盘有什么特点呢？它一般在第一个扇区，占 512 字节，而且以 0xAA55 结束。这是一个约定，当满足这个条件的时候，就说明这是一个启动盘，在 512 字节以内会启动相关的代码。 #Highlight #[[2021-07-14]]
- 当电脑刚加电的时候，会做一些重置的工作，将 CS 设置为 0xFFFF，将 IP 设置为 0x0000，所以第一条指令就会指向 0xFFFF0，正是在 ROM 的范围内。在这里，有一个 JMP 命令会跳到 ROM 中做初始化工作的代码，于是，BIOS 开始进行初始化的工作。 #Highlight #[[2021-07-14]]