title:: Readwise/Highlights/09｜技术选型：如何选择微服务框架和注册中心？ - 中间件核心技术与实战
author:: [[丁威]]
full-title:: 09｜技术选型：如何选择微服务框架和注册中心？ - 中间件核心技术与实战
category:: #articles
url:: https://time.geekbang.org/column/article/535141

- 微服务框架的基本诉求主要包括：服务注册与自动发现机制、高性能 RPC 调用和服务治理，它致力于让分布式架构中的服务治理变得简单高效。 #Highlight #[[2022-08-02]]
- 综合来看，服务注册中心这种场景，AP 模式显然比 CP 模式更佳。这也是为什么现在很多原先使用 CP 模式的注册中心都开始尝试向 AP 转化，而像 Eureka、Nacos 这种注册中心基本都同时提供了 AP 和 CP 两种工作模式，用户可以按照场景进行选择 #Highlight #[[2022-08-02]]
- 由于基于 AP 的注册中心不需要保证强一致性，所以集群内节点的地位通常都是平等的。客户端在同一时间与集群中一个节点保持长连接，当出现错误后，客户端再从注册中心集群中选择另外一个节点，并且客户端可以向集群中任何一个节点写入数据后立即返回“写入成功”，然后让数据异步在集群内部复制，最终实现数据的一致性。E #Highlight #[[2022-08-02]]
- 正是因为 CP 模型存在严重的可用性问题，以 AP 为设计思想的注册中心开始逐渐涌现出来。AP 的核心指导思想是容忍分布式集群中多个节点之间的数据短暂不一致，但最终能达到一致性。EureKa 就是典型的基于 AP 的注册中心 #Highlight #[[2022-08-02]]
- 注册中心是微服务体系的大脑，一旦出现问题会带来不可估量的损失，其可用性尤为重要 #Highlight #[[2022-08-02]]
- 在 Leader 选举期间，集群是不可用的（牺牲了可用性）。但在正常生产实践过程中，ZooKeeper 集群内部选举 Leader 节点的耗时在毫秒级别，并不会影响使用。然而，一旦遇到异常情况就很难说了。 #Highlight #[[2022-08-02]]
- 在 ZooKeeper 集群中，首先会进行 Leader 选举，根据 ZAB 协议选举出一个 Leader 节点用来处理写请求，然后将数据复制给从节点：
  当集群内超过半数节点写入成功，则返回“数据写入成功”；
  如果集群内还没有成功选举出 Leader，则 ZooKeeper 集群无法向外提供数据写入与读取服务。 #Highlight #[[2022-08-02]]
- ZooKeeper 是一个分布式协调组件，符合 CAP 分布式理论中的 CP。 #Highlight #[[2022-08-02]]