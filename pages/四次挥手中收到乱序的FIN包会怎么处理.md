- #CruelFundamental #2023-03-29 [讨论](https://github.com/CYZH1307/CruelFundamental/tree/main/homework/202303/29) #计算机网络
-
- 乱序队列
-
- 如果 FIN 报文比数据包先抵达客户端，此时 FIN 报文其实是一个乱序的报文，此时客户端的 TCP 连接**并不会**从 FIN_WAIT_2 状态转换到 TIME_WAIT 状态
	- 数据包的 Seq 可以标识乱序的发生
- 事实上，在 FIN_WAIT_2 状态时，如果收到乱序的 FIN 报文，那么就被会加入到「乱序队列」，并不会进入到 TIME_WAIT 状态
	- 等再次收到前面被网络延迟的数据包时，会判断乱序队列有没有数据，然后会检测乱序队列中是否有可用的数据，如果能在乱序队列中找到与当前报文的序列号保持的顺序的报文，就会看该报文是否有 FIN 标志，如果发现有 FIN 标志，这时才会进入 TIME_WAIT 状态。
-
- [源码分析](https://xiaolincoding.com/network/3_tcp/out_of_order_fin.html#tcp-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90)