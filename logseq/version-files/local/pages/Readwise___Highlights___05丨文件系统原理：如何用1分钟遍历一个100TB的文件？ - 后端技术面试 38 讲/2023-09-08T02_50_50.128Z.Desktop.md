title:: Readwise/Highlights/05丨文件系统原理：如何用1分钟遍历一个100TB的文件？ - 后端技术面试 38 讲
author:: [[李智慧]]
full-title:: 05丨文件系统原理：如何用1分钟遍历一个100TB的文件？ - 后端技术面试 38 讲
category:: #articles
url:: https://time.geekbang.org/column/article/169533

- 有了 HDFS，可以实现单一文件存储几百 T 的数据，再配合大数据计算框架 MapReduce 或者 Spark，可以对这个文件的数据块进行并发计算。也可以使用 Impala 这样的 SQL 引擎对这个文件进行结构化查询，在数千台服务器上并发遍历 100T 的数据，1 分钟都是绰绰有余的。 #Highlight #[[2023-01-03]]
- HDFS 的关键组件有两个，一个是 DataNode，一个是 NameNode。 #Highlight #[[2023-01-03]]
- 实践中，使用最多的是 RAID 5，数据被分成 N-1 片并发写入 N-1 块硬盘，这样既可以得到较好的硬盘利用率，也能得到很好的读写速度，同时还能保证较好的数据可用性。使用 RAID 5 的文件系统比简单的文件系统文件容量和读写速度都提高了 N-1 倍 #Highlight #[[2023-01-03]]
- 这样，每个 inode 最多可以存储 12+256+256*256+256*256*256 个数据块，如果每个数据块的大小为 4k，也就是单个文件最大不超过 70G #Highlight #[[2023-01-03]]
- inode 是固定结构的，能够记录的硬盘地址索引数也是固定的，只有 15 个索引。其中前 12 个索引直接记录数据块地址，第 13 个索引记录索引地址，也就是说，索引块指向的硬盘数据块并不直接记录文件数据，而是记录文件数据块的索引表，每个索引表可以记录 256 个索引；第 14 个索引记录二级索引地址，第 15 个索引记录三级索引地址，如下图： #Highlight #[[2023-01-03]]
- inode 中记录着文件权限、所有者、修改时间和文件大小等文件属性信息，以及文件数据块硬盘地址索引。 #Highlight #[[2023-01-03]]
- 文件系统将硬盘空间以块为单位进行划分，每个文件占据若干个块，然后再通过一个文件控制块 FCB 记录每个文件占据的硬盘数据块。 #Highlight #[[2023-01-03]]
- 到目前为止固态硬盘的成本还是明显高于机械式硬盘，因此在生产环境中，最主要的存储介质依然是机械式硬盘。如果一个场景对数据访问速度、存储容量、成本都有较高要求，那么可以采用固态硬盘和机械式硬盘混合部署的方式，即在一台服务器上既有固态硬盘，也有机械式硬盘，以满足不同文件类型的存储需求，比如日志文件存储在机械式硬盘上，而系统文件和随机读写的文件存储在固态硬盘上。 #Highlight #[[2023-01-03]]
- 相比离散存储的同样大小的文件，连续存储的文件的读写速度要快得多。 #Highlight #[[2023-01-03]]