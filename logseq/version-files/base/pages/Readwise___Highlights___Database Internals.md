title:: Readwise/Highlights/Database Internals
author:: [[Alex Petrov]]
full-title:: Database Internals
category:: #books


![](https://res.weread.qq.com/wrepub/CB_C799z19wEA7p6jF6kf64b37Q_parsecover)
None
- 具有非托管内存模型的语言允许我们在任何时候（在合理的范围内）分配更多的内存，而无需我们考虑或担心是否有连续的内存段可用，它是否被碎片化，或者在我们释放它之后会发生什么。在磁盘上，我们必须自己处理垃圾回收和碎片化。 #Highlight #[[2024-02-09]]
- 在内存中，数据布局不如在磁盘上重要。对于驻留在磁盘上的数据结构来说，我们需要以允许快速访问的方式在磁盘上布局数据，并考虑持久存储介质的具体情况，提出二进制数据格式，并找到一种高效地序列化和反序列化数据的方法。 #Highlight #[[2024-02-09]]
- The balanced tree is defined as one that has a height of log2 N, where N is the total number of items in the tree, and the difference in height between the two subtrees is not greater than one1 [KNUTH98]. Without balancing, we lose performance benefits of the binary search tree structure, and allow insertions and deletions order to determine tree shape. #Highlight #[[2024-02-07]]
- unbalanced trees have a worst-case complexity of O(N). Balanced trees give us an average O(log2 N). At the same time, due to low fanout (fanout is the maximum allowed number of children per node), we have to perform balancing, relocate nodes, and update pointers rather frequently. Increased maintenance costs make BSTs impractical as on-disk data structures #Highlight #[[2024-02-07]]
- 字符串和其他可变大小的数据类型（例如固定大小的数据数组）可以作为数字进行序列化，表示数组或字符串的长度，后跟大小字节：实际数据。对于字符串，这种表示方法通常称为UCSD字符串或Pascal字符串 #Highlight #[[2024-02-09]]
- The smallest transfer unit of a spinning drive is a sector, so when some operation is performed, at least an entire sector can be read or written. Sector sizes typically range from 512 bytes to 4 Kb. #Highlight #[[2024-02-07]]
- Solid state drives (SSDs) do not have moving parts: there’s no disk that spins, or head that has to be positioned for the read. A typical SSD is built of memory cells, connected into strings (typically 32 to 64 cells per string), strings are combined into arrays, arrays are combined into pages, and pages are combined into blocks #Highlight #[[2024-02-07]]
- Depending on the exact technology used, a cell can hold one or multiple bits of data. Pages vary in size between devices, but typically their sizes range from 2 to 16 Kb. Blocks typically contain 64 to 512 pages. Blocks are organized into planes and, finally, planes are placed on a die. SSDs can have one or more dies. #Highlight #[[2024-02-07]]
- The smallest unit that can be written (programmed) or read is a page. However, we can only make changes to the empty memory cells (i.e., to ones that have been erased before the write). The smallest erase entity is not a page, but a block that holds multiple pages, which is why it is often called an erase block. Pages in an empty block have to be written sequentially. #Highlight #[[2024-02-07]]
- In SSDs, we don’t have a strong emphasis on random versus sequential I/O, as in HDDs, because the difference in latencies between random and sequential reads is not as large. There is still some difference caused by prefetching, reading contiguous pages, and internal parallelism #Highlight #[[2024-02-07]]
- 数据库文件通常由多个部分组成，一个查找表有助于导航，并指向这些部分在文件头、尾或单独文件中的起始偏移量。 #Highlight #[[2024-02-09]]
- 为了高效地存储字符串、二进制大对象（BLOB）等可变大小的记录，我们可以使用一种组织技术，称为插槽页（即具有插槽的页面）【SILBERSCHATZ10】或插槽目录【RAMAKRISHNAN03】。这种方法被许多数据库使用，例如PostgreSQL。 #Highlight #[[2024-02-09]]
- We organize the page into a collection of slots or cells and split out pointers and cells in two independent memory regions residing on different sides of the page. This means that we only need to reorganize pointers addressing the cells to preserve the order, and deleting a record can be done either by nullifying its pointer or removing it. #Highlight #[[2024-02-09]]
- A slotted page has a fixed-size header that holds important information about the page and cells (see “Page Header”). Cells may differ in size and can hold arbitrary data: keys, pointers, data records, etc. #Highlight #[[2024-02-09]]
- Dynamic layout: from outside the page, slots are referenced only by their IDs, so the exact location is internal to the page. #Highlight #[[2024-02-09]]
- What sets B-Trees apart is that, rather than being built from top to bottom (as binary search trees), they’re constructed the other way around—from bottom to top. The number of leaf nodes grows, which increases the number of internal nodes and tree height. #Highlight #[[2024-02-07]]
- Keys can be inserted out of order and their logical sorted order is kept by sorting cell offset pointers in key order. This design allows appending cells to the page with minimal effort, since cells don’t have to be relocated during insert, update, or delete operations. #Highlight #[[2024-02-09]]
- To improve locality (especially when keys are small in size), some implementations store keys and values separately on the leaf level. Keeping keys together can improve the locality during the search. After the searched key is located, its value can be found in a value cell with a corresponding index. With variable-size keys, this requires us to calculate and store an additional value cell pointer. #Highlight #[[2024-02-09]]
- The main goal of CRC is to make sure that there were no unintended and accidental changes in data. These algorithms are not designed to resist attacks and intentional changes in data. #Highlight #[[2024-02-09]]
- Since computing a checksum over the whole file is often impractical and it is unlikely we’re going to read the entire content every time we access it, page checksums are usually computed on pages and placed in the page header. This way, checksums can be more robust (since they are performed on a small subset of the data), and the whole file doesn’t have to be discarded if corruption is contained in a single page. #Highlight #[[2024-02-09]]