import{m as Ro,d as p,l as he,f as ne,p as te,e as Yo,r as v,j as g,a as t,u as Nt,F as Mt,i as _e,L as Fo,b as X,c as V,B as Ho,g as $o,P as Et,h as re,k as M,n as U,S as F,o as P,A as Uo,q as Wo,I as Go,s as zo,R as qt,t as f,M as se,v as K,D as Re,w as W,C as le,x as Qo,T as Ie,y as Pt,z as Jo,E as Vo,G as Ko,H as Zo,J as Xo,K as ea,N as ta,O as jt,Q as it,U as oa,V as Ye,W as Oe,X as aa,Y as na,Z as ra,_ as Bt,$ as sa,a0 as la,a1 as ae,a2 as Ne,a3 as Lt,a4 as _t,a5 as Rt,a6 as Fe,a7 as ia,a8 as ie,a9 as da,aa as ca,ab as ua,ac as ma,ad as pa,ae as ha,af as ga,ag as fa,ah as Me,ai as ya,aj as Ee,ak as wa,al as ba,am as dt,an as ct,ao as Yt,ap as ka,aq as va,ar as xa,as as Ca,at as Da,au as Ta,av as Sa,aw as Aa,ax as Ia,ay as Oa,az as Na,aA as be,aB as Ft,aC as He,aD as Ma,aE as Ea,aF as qa,aG as Pa,aH as ja,aI as Ba,aJ as La,aK as _a,aL as Ra,aM as Ya}from"./vendor.6af53e39.js";const Fa=function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function a(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerpolicy&&(s.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?s.credentials="include":r.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=a(r);fetch(r.href,s)}};Fa();const Ht=new Ro({}),qe="yyyy-MM-dd",Ha="yyyy-MM-dd EEE",$a="Daily Log",ke=/^((?:[0-9]|0[0-9]|1[0-9]|2[0-3]):[0-5][0-9])(-(?:[0-9]|0[0-9]|1[0-9]|2[0-3]):[0-5][0-9])*/,$e=/>\[[\d -:]+\]\(#(agenda:\/\/[^\n\r ]+)\)/,Ue=/>\[\[#(agenda:\/\/[^\n\r ]+)\]\[[\d -:]+\]\]/,We=/>\[[ðŸ… 0-9min]+\]\(#(agenda-pomo:\/\/[^\n\r ]+)\)/,Ge=/>\[\[#(agenda-pomo:\/\/[^\n\r ]+)\]\[[ðŸ… 0-9min]+\]\]/,Ua=/\[\w+\]\(([\w:\/\.\?=]+)\)/,Wa=/\[\[([\w:\/\.\?=]+)\]\[\w+\]\]/,$t=[{value:"day",label:"Daily"},{value:"week",label:"Weekly"},{value:"2week",label:"2 Weeks"},{value:"month",label:"Monthly"}],Ga=[{value:"light",label:"Light"},{value:"dark",label:"Dark"},{value:"auto",label:"Auto"}],za=[{value:"green",label:"Green"},{value:"purple",label:"Purple"}],Z={theme:"auto",lightThemeType:"green",homePage:"dashboard",defaultView:"month",weekStartDay:0,weekHourStart:0,weekHourEnd:24,defaultDuration:{value:.5,unit:"h"},logKey:{id:$a,bgColor:"#047857",textColor:"#fff",borderColor:"#047857",enabled:!0},journal:{id:"Journal",bgColor:"#047857",textColor:"#fff",borderColor:"#047857",enabled:!0,query:[{script:`
[:find (pull ?block [*])
:where
[?block :block/marker ?marker]
[(missing? $ ?block :block/deadline)]
(not [(missing? $ ?block :block/scheduled)])
[(contains? #{"TODO" "DOING" "NOW" "LATER" "WAITING" "DONE"} ?marker)]]
        `,scheduleStart:"scheduled",dateFormatter:"yyyyMMdd",queryType:"advanced",isMilestone:!1},{script:`
[:find (pull ?block [*])
:where
[?block :block/marker ?marker]
[(missing? $ ?block :block/scheduled)]
(not [(missing? $ ?block :block/deadline)])
[(contains? #{"TODO" "DOING" "NOW" "LATER" "WAITING" "DONE"} ?marker)]]
        `,scheduleStart:"deadline",dateFormatter:"yyyyMMdd",queryType:"advanced",isMilestone:!1},{script:`
[:find (pull
?block
[:block/uuid
  :db/id
  :block/parent
  :block/left
  :block/collapsed?
  :block/format
  :block/_refs
  :block/path-refs
  :block/tags
  :block/content
  :block/marker
  :block/priority
  :block/properties
  :block/pre-block?
  :block/scheduled
  :block/deadline
  :block/repeated?
  :block/created-at
  :block/updated-at
  :block/file
  :block/heading-level
  {:block/page
  [:db/id :block/name :block/original-name :block/journal-day :block/journal?]}])
:where
[?block :block/page ?page]
[?page :block/journal? true]
[?block :block/marker ?marker]
[(contains? #{"TODO" "DOING" "NOW" "LATER" "WAITING" "DONE"} ?marker)]
[(missing? $ ?block :block/scheduled)]
[(missing? $ ?block :block/deadline)]]
        `,scheduleStart:"page.journal-day",dateFormatter:"yyyyMMdd",isMilestone:!1,queryType:"advanced"},{script:`
[:find (pull
  ?block
  [:block/uuid
    :block/parent
    :db/id
    :block/left
    :block/collapsed?
    :block/format
    :block/_refs
    :block/path-refs
    :block/tags
    :block/content
    :block/marker
    :block/priority
    :block/properties
    :block/pre-block?
    :block/scheduled
    :block/deadline
    :block/repeated?
    :block/created-at
    :block/updated-at
    :block/file
    :block/heading-level
    {:block/page
      [:db/id :block/name :block/original-name :block/journal-day :block/journal?]}
    {:block/refs
      [:block/journal-day]}])
  :where
  [?block :block/marker ?marker]
  [?rp :block/journal? true]
  [?block :block/refs ?rp]
  [(contains? #{"TODO" "DOING" "NOW" "LATER" "WAITING" "DONE"} ?marker)]]
        `,scheduleStart:"refs[0].journal-day",dateFormatter:"yyyyMMdd",isMilestone:!1,queryType:"advanced"},{script:`
[:find (pull ?block [*])
:where
[?rp :block/name "milestone"]
[?block :block/scheduled]
[?block :block/refs ?rp]]
        `,scheduleStart:"scheduled",dateFormatter:"yyyyMMdd",isMilestone:!0,queryType:"advanced"}]},projectList:[],calendarList:[],subscriptionList:[],pomodoro:{pomodoro:25,shortBreak:5,longBreak:15,autoStartBreaks:!1,autoStartPomodoros:!1,longBreakInterval:4,commonPomodoros:[10,15,20,25,40]}},Qa={light:{"month.holidayExceptThisMonth.color":"#f3acac","month.dayExceptThisMonth.color":"#bbb","month.weekend.backgroundColor":"#fafafa","month.day.fontSize":"16px","week.daygrid.borderRight":"1px solid #ddd","week.daygrid.backgroundColor":"inherit","week.daygridLeft.width":"77px","week.daygridLeft.backgroundColor":"#a8def74d","week.daygridLeft.paddingRight":"5px","week.daygridLeft.borderRight":"1px solid #ddd","week.today.backgroundColor":"#b857d81f","week.weekend.backgroundColor":"#fafafa","week.timegridLeft.width":"77px","week.timegridLeft.backgroundColor":"#03a9f44d","week.timegridLeft.borderRight":"1px solid #ddd","week.timegridLeft.fontSize":"12px","week.timegridLeftTimezoneLabel.height":"51px","week.timegridLeftAdditionalTimezone.backgroundColor":"#fdfdfd","week.timegridOneHour.height":"48px","week.timegridHalfHour.height":"24px","week.timegridHalfHour.borderBottom":"1px dotted #f9f9f9","week.timegridHorizontalLine.borderBottom":"1px solid #eee","week.timegrid.paddingRight":"10px","week.timegrid.borderRight":"1px solid #ddd","week.timegridSchedule.borderRadius":"0","week.timegridSchedule.paddingLeft":"0","week.currentTime.color":"#135de6","week.currentTime.fontSize":"12px","week.currentTime.fontWeight":"bold","week.pastTime.color":"#808080","week.pastTime.fontWeight":"normal","week.futureTime.color":"#333","week.futureTime.fontWeight":"normal","week.currentTimeLinePast.border":"1px solid rgba(19, 93, 230, 0.3)","week.currentTimeLineBullet.backgroundColor":"#135de6","week.currentTimeLineToday.border":"1px solid #135de6","week.currentTimeLineFuture.border":"1px solid #135de6"},dark:{"common.backgroundColor":"#32373d","common.saturday.color":"#babec4","common.dayname.color":"#babec4","common.border":"1px solid #58595c","common.creationGuide.backgroundColor":"#32373d","month.dayname.borderLeft":"1px solid #58595c","month.holidayExceptThisMonth.color":"#f3acac","month.dayExceptThisMonth.color":"#bbb","month.weekend.backgroundColor":"#282c31","month.day.fontSize":"16px","week.vpanelSplitter.border":"1px solid #58595c","week.today.color":"#fff","week.pastDay.color":"#8f9296","week.dayname.borderTop":"1px solid #58595c","week.dayname.borderBottom":"1px solid #58595c","week.daygrid.borderRight":"1px solid #58595c","week.daygrid.backgroundColor":"inherit","week.daygridLeft.width":"77px","week.daygridLeft.backgroundColor":"rgba(252, 183, 20, 0.3)","week.daygridLeft.paddingRight":"5px","week.daygridLeft.borderRight":"1px solid #58595c","week.today.backgroundColor":"#b857d81f","week.weekend.backgroundColor":"#282c31","week.timegridLeft.width":"77px","week.timegridLeft.backgroundColor":"rgba(252, 183, 20, 0.4)","week.timegridLeft.borderRight":"1px solid #58595c","week.timegridLeft.fontSize":"12px","week.timegridLeftTimezoneLabel.height":"51px","week.timegridLeftAdditionalTimezone.backgroundColor":"#fdfdfd","week.timegridOneHour.height":"48px","week.timegridHalfHour.height":"24px","week.timegridHalfHour.borderBottom":"1px dotted #3d3e40","week.timegridHorizontalLine.borderBottom":"1px solid #58595c","week.timegrid.paddingRight":"10px","week.timegrid.borderRight":"1px solid #58595c","week.timegridSchedule.borderRadius":"0","week.timegridSchedule.paddingLeft":"0","week.currentTime.color":"#fcb714","week.currentTime.fontSize":"12px","week.currentTime.fontWeight":"bold","week.pastTime.color":"#bababd","week.pastTime.fontWeight":"normal","week.futureTime.color":"#dadade","week.futureTime.fontWeight":"normal","week.currentTimeLinePast.border":"1px solid rgba(252, 183, 20, 0.4)","week.currentTimeLineBullet.backgroundColor":"#fcb714","week.currentTimeLineToday.border":"1px solid #fcb714","week.currentTimeLineFuture.border":"1px solid #fcb714"}},Ut="yyyyMMdd",Ja=[{value:"m",label:"minute"},{value:"h",label:"hour"}],Wt="Agenda",Gt="|`~|",zt={id:void 0,bgColor:"#b8e986",textColor:"#4a4a4a",borderColor:"#047857",enabled:!0},ve=(e,o="blue")=>console.log(`%c${e}`,`color:${o}`),ze=e=>{const o=document.querySelector("html"),a=logseq.settings?.lightThemeType||Z.lightThemeType,n=a==="green"?"purple":"green";e==="dark"?(o?.classList.add("dark"),o?.classList.remove(a),Jt("./antd.dark.min.css")):(o?.classList.remove("dark",n),o?.classList.add(a),Jt("./antd.min.css"))},Qt=async()=>{const{theme:e}=logseq.settings;if(e==="dark")return ze("dark");if(e==="light")return ze("light");const o=await logseq.App.getStateFromStore("ui/theme");ze(o)},Va=e=>{const o=document.createElement("textarea");o.value=e,document.body.appendChild(o),o.select(),document.execCommand("copy"),document.body.removeChild(o)},Ka=e=>{document.addEventListener("keyup",o=>{o.key==="Escape"&&e()})},Za=()=>{const e=navigator.userAgent,o=e.indexOf("Windows")>-1,a=e.indexOf("Macintosh")>-1,n=e.indexOf("Linux")>-1;return o?"windows":a?"mac":n?"linux":"unknown"},Jt=e=>{const o=document.createElement("link");o.rel="stylesheet",o.href=e,o.className="antd-css";const a=document.head||document.getElementsByTagName("head")[0],n=a.childNodes[0];n?a.insertBefore(o,n):a.appendChild(o);const r=a.querySelectorAll(".antd-css");Array.from(r)?.slice(1)?.forEach(s=>{a.removeChild(s)})},ut=e=>{const o=document.querySelector("html"),a=document.querySelector("body");e?(o?.classList.add("modal-app"),a?.classList.add("modal-app")):(o?.classList.remove("modal-app"),a?.classList.remove("modal-app"))},Xa=(e,o)=>{const a=[];let n=e;for(;n.isSameOrBefore(o);)a.push(n.clone()),n=n.add(1,"day");return a},mt=(e=6)=>{const o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let a="";for(let n=0;n<e;n++)a+=o.charAt(Math.floor(Math.random()*o.length));return a},Vt=e=>{const o=new URL(e).searchParams;let a={};return o.forEach((n,r)=>a[r]=n),a},en=e=>{const o=new Notification(e);o.onclick=()=>{o.close()}},Kt=(e,o,a="markdown")=>a==="org"?`[${o}][${e}]]`:`[${e}](${o})`,tn=async()=>{let e=[];const o=j(),{calendarList:a=[]}=o,n=a.filter(d=>d?.enabled);let r=[];r=n.map(d=>d?.query?.filter(c=>c?.script?.length)?.map(c=>({calendarConfig:d,query:c}))).filter(Boolean).flat();const s=r.map(async d=>{const{query:c}=d,{script:u="",queryType:m}=c;let h=[];m==="simple"?h=await logseq.DB.q(u)||[]:h=await logseq.DB.datascriptQuery(u);const w=he.exports.flattenDeep(h).map(C=>an({block:C,queryWithCalendar:d,settings:o}));return Promise.all(w)}),i=await Promise.allSettled(s),l=[];return i.forEach((d,c)=>{if(d.status==="fulfilled")l.push(d.value);else{console.error("[faiz:] === scheduleRes error: ",r[c],d);const{calendarConfig:u,query:m}=r[c],h=`Query Exec Error:
calendar: ${u.id}
query: ${m.script}
message: ${d.reason.message}`;logseq.UI.showMsg(h,"error")}}),e=he.exports.flattenDeep(e.concat(l)),e},on=async()=>{const{logKey:e,defaultDuration:o}=j();if(!e?.enabled)return[];const r=((await logseq.DB.q(`[[${e.id}]]`))?.filter(i=>i?.marker||!i?.page?.journalDay?!1:ke.test(i?.content))||[])?.map(async i=>{const l=i?.page?.journalDay,{start:d,end:c}=pt(i?.content.replace(new RegExp(`^${i.marker} `),"")),u=d||c;if(!!u)return await ht({blockData:i,category:u?"time":"allday",start:d?ne(te(l+" "+d,"yyyyMMdd HH:mm",new Date)):Qe(l),end:c?ne(te(l+" "+c,"yyyyMMdd HH:mm",new Date)):void 0,calendarConfig:e,defaultDuration:o,isAllDay:!u,isReadOnly:!0})});return(await Promise.all(r)).filter(Boolean)},an=async({block:e,queryWithCalendar:o,settings:a})=>{const{calendarConfig:n,query:r}=o,{script:s="",scheduleStart:i="",scheduleEnd:l="",dateFormatter:d,isMilestone:c,queryType:u}=r,{defaultDuration:m}=a,h=["scheduled","deadline"].includes(i||l)?Ut:d||Ha,w=he.exports.get(e,i,void 0),C=he.exports.get(e,l,void 0);let S=/[Hhm]+/.test(h||""),I,x;try{I=w&&Qe(w,h),x=C&&(S?Qe(C,h):ne(Yo(te(C,h,new Date))))}catch(y){return console.warn("[faiz:] === parse calendar date error: ",y,e,r),[]}if(e?.page?.["journal-day"]){const{start:y,end:T}=pt(e?.content.replace(new RegExp(`^${e.marker} `),""));if(y||T){const O=e?.page?.["journal-day"];I=y?ne(te(O+" "+y,"yyyyMMdd HH:mm",new Date)):Qe(O),x=T?ne(te(O+" "+T,"yyyyMMdd HH:mm",new Date)):void 0,S=!0}}if(w&&["scheduled","deadline"].includes(i)){const y=e.content?.split(`
`)?.find(O=>O.startsWith(`${i.toUpperCase()}:`))?.trim(),T=/ (\d{2}:\d{2})[ >]/.exec(y)?.[1]||"";T&&(I=ne(te(`${w} ${T}`,"yyyyMMdd HH:mm",new Date)),S=!0)}if(C&&["scheduled","deadline"].includes(l)){const y=e.content?.split(`
`)?.find(O=>O.startsWith(`${l.toUpperCase()}:`))?.trim(),T=/ (\d{2}:\d{2})[ >]/.exec(y)?.[1]||"";T&&(x=ne(te(`${C} ${T}`,"yyyyMMdd HH:mm",new Date)),S=!0)}let q=S?"time":"allday";c&&(q="milestone");const k=q,D=Zt(e,x||I,!S);return!c&&D&&(q="task"),await ht({blockData:{...e,category:k,type:"project",rawStart:I,rawEnd:x,rawAllDay:!S,rawOverdue:D},category:q,start:I,end:x,calendarConfig:n,defaultDuration:m,isAllDay:!c&&!S&&!D,isReadOnly:!0})},Zt=(e,o,a)=>e.marker&&e.marker!=="DONE"&&e.marker!=="CANCELED"&&e.marker!=="WAITING"?a?p().isAfter(p(o),"day"):p().isAfter(p(o),"minute"):!1,pt=e=>{const o=e.match(ke);return o?{start:o[1],end:o[2]?.slice(1)}:{start:void 0,end:void 0}},nn=(e,o,a)=>{const n=`${o}${a?"-"+a:""}`;return e.match(ke)?e.replace(ke,n):n+" "+e},Xt=e=>e.replace(ke,""),eo=async e=>{const o=/\(\([0-9a-z\-]{30,}\)\)/;if(o.test(e)){const a=o.exec(e)?.[0]?.replace("((","")?.replace("))","");if(a){const n=await xe({uuid:a},!0);return e.replace(o,n?.content||"")}}return e};async function ht(e){const{id:o,blockData:a,category:n="time",start:r,end:s,calendarConfig:i,isAllDay:l,defaultDuration:d,isReadOnly:c}=e,u=typeof a?.uuid=="string"?a?.uuid:a?.uuid?.$uuid$;if(!a?.id){const k=await xe({uuid:u},!0);k&&(a.id=k.id)}let m=a?.page;he.exports.has(m,"id")&&he.exports.has(m,"name")&&he.exports.has(m,"original-name")&&(m={id:m.id,journalDay:m["journal-day"],journal:m["journal?"],name:m.name,originalName:m["original-name"]}),a.page=m,a.fullContent=await eo(a.content);const h=window.logseqAppUserConfigs?.preferredFormat==="org"?Ue:$e,w=a.fullContent.split(`
`)[0]?.replace(new RegExp(`^${a.marker} `),"")?.replace(ke,"")?.replace(h,"")?.replace(" #milestone","")?.trim?.(),C=a.marker==="DONE";function S(){return!!(a.page?.properties?.agenda===!0||a?.page?.["journal-day"]&&!a?.scheduled&&!a?.deadline)}const I=c===void 0?S():!c,x=d||j()?.defaultDuration;let q=s;return(n==="time"||a?.category==="time")&&!s&&r&&x&&(q=p(r).add(x.value,x.unit).format()),a?.category!=="time"&&!s&&(q=r),a.uuid=u,{id:o||u,calendarId:i.id,title:w,body:a.fullContent,category:n,dueDateClass:"",start:r,end:q,raw:a,color:i?.textColor,bgColor:i?.bgColor,borderColor:i?.borderColor,isAllDay:l,customStyle:C?"opacity: 0.6;":"",isReadOnly:!I}}const Qe=(e,o=Ut)=>ne(te(""+e,o,new Date)),ge=(e=[])=>({waiting:e.filter(o=>o?.addOns?.status==="waiting"),todo:e.filter(o=>o?.addOns?.status==="todo"),doing:e.filter(o=>o?.addOns?.status==="doing"),done:e.filter(o=>o?.addOns?.status==="done"),canceled:e.filter(o=>o?.addOns?.status==="canceled")}),rn=e=>{const o=new Map;return e.forEach(a=>{const n=p(a.addOns.start).startOf("day").format();o.has(n)||o.set(n,[]),o.get(n)?.push(a)}),o},sn=({start:e,end:o,allDay:a})=>{const n=new URL("agenda://");n.searchParams.append("start",""+e.valueOf()),n.searchParams.append("end",""+o.valueOf()),a===!1&&n.searchParams.append("allDay","false");const r=a?e.format("YYYY-MM-DD"):e.format("YYYY-MM-DD HH:mm");let s=a?o.format("YYYY-MM-DD"):o.format("YYYY-MM-DD HH:mm");const i=e.isSame(o,"day");i&&a&&(s=""),i&&!a&&(s=o.format("HH:mm"));const l=r+(s?` - ${s}`:"");return window.logseqAppUserConfigs?.preferredFormat==="org"?`>[[#${n.toString()}][${l}]]`:`>[${l}](#${n.toString()})`},ln=e=>{const o=window.logseqAppUserConfigs?.preferredFormat==="org"?Ue:$e,a=e.match(o);return!a||!a?.[1]?null:Vt(a[1])},to=e=>{const o=window.logseqAppUserConfigs?.preferredFormat==="org"?Ue:$e;return e.replace(o,"")},gt=(e,o)=>{const a=window.logseqAppUserConfigs?.preferredFormat==="org"?Ue:$e,n=sn(o),r=Xt(e)?.trim();return a.test(r)?r.replace(a,n):r?.split(`
`).map((s,i)=>i===0?s+" "+n:s).join(`
`)};function oo(e){let o=[],a=[],n=[];return e.forEach(r=>{r.addOns.isOverdue?o.push(r):r.addOns.allDay?a.push(r):n.push(r)}),{overdueTasks:o,allDayTasks:a,timeTasks:n}}function ao(e){let o=[],a=[];return e.forEach(n=>{n.isAllDay?o.push(n):a.push(n)}),{allDaySubscriptions:o,timeSubscriptions:a}}const dn=e=>/ #milestone/.test(e.content)||/ #\[\[milestone\]\]/.test(e.content),no=async(e,o,a)=>{const n=await logseq.Editor.getBlock(e);if(!n)return logseq.UI.showMsg("Block not found","error"),Promise.reject(new Error("Block not found"));o&&await logseq.Editor.updateBlock(n.uuid,o);const r=Object.keys(a||{}).map(s=>logseq.Editor.upsertBlockProperty(n.uuid,s,a?.[s]));return Promise.allSettled(r)},ro=async(e,o)=>{const a=await logseq.Editor.createPage(o);return a?(await logseq.Editor.moveBlock(e,a.uuid),await xe({uuid:e})):logseq.UI.showMsg("Create page failed","error")},ft=async(e,o,a)=>{const r=await xe(typeof e=="number"?{id:e}:{uuid:e});if(!r)return logseq.UI.showMsg("moveBlockToSpecificBlock: Block not found","error");let s=await de({originalName:o});s||(s=await logseq.Editor.createPage(o));let i=await io(o,a);return i||(i=await logseq.Editor.insertBlock(o,a,{before:!0,isPageBlock:!0})),i&&await logseq.Editor.moveBlock(r.uuid,i.uuid,{children:!0}),await xe({uuid:r.uuid})},so=async(e,o,a,n={})=>{let r=await de({originalName:e});r||(r=await logseq.Editor.createPage(e));let s=await io(e,o);return s||(s=await logseq.Editor.insertBlock(e,o,{before:!0,isPageBlock:!0})),await logseq.Editor.insertBlock(s.uuid,a,{isPageBlock:!1,properties:n,sibling:!1,before:!1})},Je=new Map,xe=async(e,o=!1)=>{const{id:a,uuid:n}=e,r=a||n;if(!r)return Promise.reject(new Error("getBlockData: id or uuid is required"));if(o&&Je.has(r))return Je.get(r);const s=await logseq.Editor.getBlock(r);if(!s)return null;const{id:i,uuid:l}=s;return Je.set(i,s),Je.set(l,s),s},Pe=new Map,de=async(e,o,a=!1)=>{const{id:n,uuid:r,originalName:s}=e,i=n||r||s;if(!i)return Promise.reject(new Error("getPageData: id, uuid or pageOriginalName is required"));if(a&&Pe.has(i))return Pe.get(i);const l=await logseq.Editor.getPage(i,o);if(!l)return null;const{id:d,uuid:c,originalName:u}=l;return Pe.set(d,l),Pe.set(c,l),Pe.set(u,l),l},lo=async()=>{const e=await logseq.App.getStateFromStore("ui/theme"),o=logseq.settings?.theme==="auto"?e:logseq.settings?.theme,a=logseq.settings?.lightThemeType||"green";return o==="dark"?"dark":a},io=async(e,o)=>(await logseq.Editor.getPageBlocksTree(e)).find(r=>r.content===o)||null,cn=e=>{let o=null;for(let a=0;a<e.length;a++){const n=e[a],r=n.getAttribute("blockid");if(n?.className?.includes("block-content")&&r){o=r;break}a++}return o},co=(e,o)=>{const a=e.marker,n=e.priority;return(o||e.content)?.replace(a,"").trim().replace(`[#${n}]`,"").trim()},Ve=(e,o)=>{const a=e.marker,n=e.priority;let r=o;return n&&(r=`[#${n}] `+r),a&&(r=a+" "+r),r};let yt=new Map;const un=(e,o=2e3)=>({blocks:a,txData:n,txMeta:r})=>{const{marker:s,properties:i,uuid:l}=a[0];if(!s||!i?.todoistId||!l)return;const d=yt.get(l);d&&clearInterval(d),yt.set(l,window.setInterval(async()=>{if(await logseq.Editor.checkEditing()!==l){const u=yt.get(l);clearInterval(u),e(l)}},o))},j=(e={filterInvalideProject:!0})=>{const{filterInvalideProject:o}=e;let a=Z.logKey;const n=logseq.settings?.logKey;n&&(a=n,typeof n=="string"&&Z.logKey&&(a={...Z.logKey,id:n}));const r=logseq.settings?.projectList||Z.projectList;return{...Z,...logseq.settings,logKey:a,projectList:o?r?.filter(s=>Boolean(s.id)):r}},mn=()=>{if(!logseq.settings?.initialized){const o=j();logseq.updateSettings({...o,initialized:!0})}},pn=async()=>{const o=await lo()==="dark"?"dark":"light";let a=logseq.settings?.defaultView||"month";return logseq.settings?.defaultView==="2week"&&(a="month"),{defaultView:a,taskView:!0,scheduleView:!0,useDetailPopup:!0,isReadOnly:!1,disableClick:!0,theme:Qa[o],usageStatistics:!1,week:{startDayOfWeek:logseq.settings?.weekStartDay||0,hourStart:logseq.settings?.weekHourStart||0,hourEnd:logseq.settings?.weekHourEnd||24},month:{startDayOfWeek:logseq.settings?.weekStartDay||0,scheduleFilter:n=>Boolean(n.isVisible),visibleWeeksCount:logseq.settings?.defaultView==="2week"?2:void 0},template:{taskTitle:()=>'<span class="tui-full-calendar-left-content">Overdue</span>',task:n=>"\u{1F525}"+n.title,timegridDisplayPrimayTime:function(n){return n.hour<10?"0"+n.hour+":00":n.hour+":00"},popupDetailBody:n=>{const r=`<b>Project: ${n.calendarId}</b>`,s=n.raw?.subscription?"":'<br/><a id="faiz-nav-detail" href="javascript:void(0);">Navigate To Block</a>';return`
          <div class="calendar-popup-detail-content">
            ${Ht.render(n.body||"")}
          </div>
          ${r}
          ${s}
        `}}}},hn=e=>({...e,isReadOnly:!0,defaultView:"week",taskView:["time"]}),gn=e=>({id:e,bgColor:"#b8e986",textColor:"#4a4a4a",borderColor:"#047857",enabled:!0,query:[{script:`
[:find (pull ?block [*])
:where
[?block :block/marker ?marker]
[(missing? $ ?block :block/deadline)]
(not [(missing? $ ?block :block/scheduled)])
[?page :block/name ?pname]
[?block :block/page ?page]
[(contains? #{"${e}"} ?pname)]
[(contains? #{"TODO" "DOING" "NOW" "LATER" "WAITING" "DONE"} ?marker)]]
        `,scheduleStart:"scheduled",dateFormatter:"yyyyMMdd"},{script:`
[:find (pull ?block [*])
:where
[?block :block/marker ?marker]
[(missing? $ ?block :block/scheduled)]
[(get-else $ ?block :block/deadline "nil") ?d]
[(not= ?d "nil")]
[?page :block/name ?pname]
[?block :block/page ?page]
[(contains? #{"${e}"} ?pname)]
[(contains? #{"TODO" "DOING" "NOW" "LATER" "WAITING" "DONE"} ?marker)]]
        `,scheduleStart:"deadline",dateFormatter:"yyyyMMdd"},{script:`
[:find (pull ?block [*])
:where
[?page :block/name ?pname]
[?block :block/page ?page]
[(contains? #{"${e}"} ?pname)]
[?rp :block/name "milestone"]
[?block :block/refs ?rp]]
        `,scheduleStart:"scheduled",dateFormatter:"yyyyMMdd",isMilestone:!0}]}),fn=e=>({id:e,bgColor:"#b8e986",textColor:"#4a4a4a",borderColor:"#047857",enabled:!0,query:[{script:`(and (page "${e}") (task todo doing done later now waitting) (property end) (property start))`,scheduleStart:"properties.start",scheduleEnd:"properties.end",dateFormatter:"yyyy-MM-dd",queryType:"simple"},{script:`(and (page "${e}") (task todo doing done later now waitting) (property end) (property start))`,scheduleStart:"properties.start",scheduleEnd:"properties.end",dateFormatter:"yyyy-MM-dd HH:mm",queryType:"simple"},{script:`(and (page "${e}") [[milestone]] (property start))`,scheduleStart:"properties.start",dateFormatter:"yyyy-MM-dd",queryType:"simple",isMilestone:!0}]});var yn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAAAXNSR0IArs4c6QAADHpJREFUeF7tnXlwG9Udx797yJIsW7ZjTOwcTogdhyPN6Rx2m2CHkIZAuQkQjoEBWmC4WtrSdso9TMtAgULLDKTMdCg3JIGGAikYhyMk0NCSBGgwEJL4kC+k+JSsazsrx0U+tbvvPeHlPf3lsX6/3/u97++zvz20+1aC+HCtgMT17MXkIQDgHAIBgACAcwU4n77oAAIAzhXgfPqiAwgAOFeA8+mLDiAA4FwBzqcvOoAAgHMFOJ++6AACAM4V4Hz6ogMIADhXgPPpj7sOUPP2rgWejMwvli6d2cm6Nq/V7Lw8JssfnVy9YCfrsV6p2VkCOdq3pnppA+uxzMQfNwDUbt9zJWK4FRIKD0/gyervf+9CM5MxavvGu3tOVCQ8HIvFSoOhIGRF7jr5hCVeo/5m7F59Y8ecaFx7FsDRCT9J2u6IxU9ZvbrSbyYOK9txA8DWbXu2aUBl8kQlSVpXVTn7adqTHxgrFotBB0D/OBwZf1pdvfBa2mO9vGXHPZqk/Tw5rqbhoVN/WHEd7bGsxBs3ANRu26MNnUA8Hr/9hGVzb7MysbF8BsZKBkBV1a0nrVhUTXuszf/cXgugakjcrT9aVUF9LCu5CwAOdwABgBV8KPqIDkBRTBOhmHaAlvMqKqNxaZUErVyTUCLF0Txabp/d8OjQNoncj97cP3HrM/tNzMeQ6cBYybuArNaG6KSN67sNBTBhVH/6ZVnBwmI12cXdfDA69cXHRh1Lg6TIUrxRQfw9TcMTpRtr9N0Ikw8TAJrOqVinSfgZgIVGs667/tFhpvk7NiP//c1GQxi2GxhrEADN9Thy018NxzBq6DvtYgQnTRtk7m46gKKXHjcaAg4pUu+QwjcdteEt6gfE1AFoWLv0BQnSWYZnd9hQADC2YhI0ZMjh2tINNSvMajuWPVUAGtZW3C8BN1hJUABgTDWnHHq6dMOb64xZp7aiBkDL+UvmRGPyrtRDjmwhADCunCpFzpy18fVNxj1Gt6QGQNO5lQ9rmnaV1aQEAMaVU6R4w9EbX5tq3CMNADSurRh2IcdMggIA42rpxwPHbnqVysZLJciBc5YsVCWZ6AcVAYBxAHRLt9q3asbzNa+b8xpuTQWAxrUV5wN4iiQZAYA59dxK8M4ZL9TeYs5rHAPQeNp16Jk+e1CGk196EJ79H5POcZh/0ylXo7tkHpKvAxzx4TvwfrCV+liB8uUILDp+UNy8f72FvJ1vE431nQOgt/hYHJpThd4pZXC11cPdUMfkIpCuejR7Atorz0DHtNnoi0SQ0eFH4bOPEBVkNGfNkYH2ZasTF4PkSATu+i+R/x5x58Z3DgAm6qcI2pNThEh76NsYmnhMAQCxhEBUU9EdzaYQKf0hBAAUNBcAgM4SMTTOAijU03QIAYAAQOwCTG82IziIDkBDRXMxxDGAOb1GtBa7AEq7gPoLqi6UI31/o1CTtIawMwAuj3R3yRP/+BWpYFQuBTfd9Zs7tF21N5Mmk25/WwMwb/6rJbfetYZUMwGATa8DqGvOemzWFZddPv4AUB2kOaXNPxpT0B12p208mgOpZ1/651kXnHMNaUwqHaC+TatSFDC7c5V0kqP5J34MCvayCs80rqKqPy2ZlPkA6SACAAEAKUOA6ADkGpqNIDqAWcVGsBe7AFrXAcQxAAUczYUQHWAEveRIK5RQPeS+Buh/J3+iWfMRzZwFTfnm59+ROoAr8C7c/m1Qgr5B/pHsMkQ8MxHOno2os8hctRhYCwAOiyrFw8gIbIHTvwWOrg9SSh31zEE4dxlC+WcgKnkSZwFZjU/B43sFcncTEI2ljBHPKUKwaDU6p1yS0paVgQBAvzPWtz5ReKXvoHmdJQV9jsWQDrwPRMLm/XUPtwehomoEZvzCmj+BF9cA6Fu9p/5uOL8me3BU69MQaUm9xaeqUzx3ClrKn0xlRvV7bgFQe/ciZ+/FVMSkBUAiGVWBr+pNKnkZCcIlAEpoH3I/Pc+IPoZsqAKgj5jhgG/5G4bGJjXiDgAp2oncvRdCDo+6xoRpTakDoN9yXlCGtrnrTedi1oE7ALL3/RIZh+g+uMECAL2QkcL5aJ9NfJl+TCa4AiAjUIPsr35tdiNJac8KAMgS/OX3o887P2UOVg24AsBb9xM4uv9jVatR/ZgBkIZdATcAuNpfgufgXdSLrwdkCYB+w33HvJvRm7+SSe7cAJC97yZkHGJzqwFTAAD0FVfBX3a7AMCqAvoFn7zdKyHF2Ty/xxqAeO4ktJRTX9grIScXHcDR+QG8XxDf9fStHAMkBmV4XYALAPRr/Zk+dufUrDuAzkDzitehyRlWm+CofgIACpKmA4D2HzyOiGvwQpEUUudjF/Bd6ACBRfcilLOIRs0HxRAdgIKk6egAnXNvQk8B8fMbw2bLBQCutufhqb+HQqlHDpEOAAKL70PIa3jJZMNz5QIAR+d2eL+43rAoZg2ZA6DI8FWzuYbBBQBKaD9yP11rtq6G7VkDoGXno3nJRsP5mDHkAgD9QlDuJ6dDjrSb0cawLWsAWP4qyAUAeiVZngkwBUACAuV/QCin3DCQZgy5AUDf+vVbwFh0AZYAxPOmomXhE2ZqasqWGwBYdgGWAHQddxW6i+jdvjaUDq4AkMMtidvBpGiHqa0klTErADRvAZoXv5BqeKLvuQJAV8rT8ABcrUTrUQ8TnBUAXcddh+4i02/NMQUEdwAowc+R+98LTImUypgFAPEJ09CywPgLoVLlONr33AGgC+GtuxKO7n9b1SwtHaBn1iXonHoptRwFAEkK0D4lpN4BZAm+FXTvXBYAJCkw3h8MiecUomWR/qJw9h8udwG6rBP0W8SinVQUpt0BWN4DyPVpYPLkcz67FGrPJ+MSgJ5jLkPnZDrPLaaaILcdIGv/LXD6X0ulT8rvQ0euQ0/+2UDDFnia/g45UJ/SJ5UBq59+RxqXWwBoHAh2HfU7hPNO6H9n0OFVwoq2nwr0kF1o8q18KxUj1L7nFgBX6zPwNNxHJKR/bi00xTMIgIJdV0Btq7MeN41nAHqS3ALg9L+CrP23WS8UgK8X9C8lk9wBjvj4BjiaCR4/c6jwHV9DlJcZZ24ByOh4B9lf3mhGq2G2TABwuuBbtoUoLzPO3ALg6PoQ3s8tv6I4oTELALTMbDRXvmymhkS2AgAC+QQA34hnu7WCRQfoLx63HUDt/Qw5ey+yvP1rshP+ee8MOwjM3/tbZDT0/9/KR8vKQ/PSF624WvLhFgBdrQkfLbf8xHDMXYpDx/TfV5B8FuBp3Qzv7nstFSMR64iZaJ33F8v+Zh25BsD7+TWGVgUdSdRwbjW6Ztw9DAA5EsDEt08HNLOl6LcPFx+Pr8vusOZswYtrADIbH4S7xdoNl8GJF6N3cv8j50PXCi7atgYI9lgoB5Cu+wAGkuMaAP0ewZy6H0MOD17QOVXlop7Z6Cz94/8XjB4KQM7B9cisMw9WLK8YrQvT+9I0rgHQC2125TBNdqOz7NHEiuEDn5FWCy/YfTXUVhO/Nro9aKl4EXEGawCMBTT3AOjiuNo2wNX2HJTQV2Nu/FHPXAQLL0I4Z/kgu9FeGFGw51qobXuA+NgHBPoNIB0zb0Qod3Gq5kP9ewHAYUmlWE8CAr0jqKF9gBbt/0ZyIOouQTjvRAQnjnzaONYbQ1yHdsD71SNQOuuBSOSbAsoS4MxEcPJJODT9WuqFNRpQADCSUloUSugAICmIOacAkjqmnkZfGaOE2+Dq+BBRVxH6sucarRFTOwEABXmNAkBhKOohBAAUJBUAUHpplK9LO1aLwMShM4XqUQhhZwBk1Xlm6STnJlIZqPwYpGmayxdAkDSZdPvbGQCnlj1h2jQpQKoZFQD0JHx+7WMNOI40oXT62xUASZLDM6dmOWloRROAhzSA3bKeNGY7JIZdAVAV9f0ZkzOX0pCEGgB6Mk1+7QCAYhqJpSOGHQGQZbm9dEpWAS19qAJgt4NBOwJQVuylWjOqwRLHAj6tQHPiOQBVtChlFcdOAKiq48CMSe7ptLWgDsBAgo1+7ffQcKYkYSbtpGnFswMAsqz0Kor08lFFmefSmndyHGYADAzypV/LyYxjVlRDJosJkMQMR4LzSPxZ+iqytHt6oZv5iwiZA8BSJBGbXAEBALmGto4gALB1+ciTFwCQa2jrCAIAW5ePPHkBALmGto4gALB1+ciTFwCQa2jrCAIAW5ePPHkBALmGto4gALB1+ciTFwCQa2jrCAIAW5ePPHkBALmGto4gALB1+ciTFwCQa2jrCAIAW5ePPPn/AeXG+9voOJDHAAAAAElFTkSuQmCC";const wn="_container_1xwon_1",bn="_buttonWrapper_1xwon_4",kn="_button_1xwon_4",vn="_active_1xwon_19",xn="_indicatorBack_1xwon_23",Cn="_indicatorDot_1xwon_34";var Ce={container:wn,buttonWrapper:bn,button:kn,active:vn,indicatorBack:xn,indicatorDot:Cn};const Dn=({initialValue:e,onChange:o,tabs:a})=>{const[n,r]=v.exports.useState(e||a?.[0]?.value),s=a.findIndex(({value:l})=>l===n)*100,i=l=>{r(l),o?.(l)};return g("div",{className:Ce.container,children:[a.map(({label:l,value:d,icon:c})=>t("div",{className:Ce.buttonWrapper,onClick:()=>i(d),children:t("div",{className:`${Ce.button} ${d===n?Ce.active:""}`,title:l,children:c})},d)),t("div",{className:Ce.indicatorBack,style:{transform:`translateX(60px) translateY(${s}%)`}}),t("div",{className:Ce.indicatorDot,style:{transform:`translateY(${s}%)`}})]})},Tn="_container_1ph2e_1",Sn="_logo_1ph2e_6",An="_close_1ph2e_16";var wt={container:Tn,logo:Sn,close:An};const In=({defaultRoute:e,menus:o})=>{const a=Nt(),{homePage:n=Z.homePage}=j(),r=s=>{const{path:i}=o.find(l=>l.value===s)||{path:"/"};a(i)};return v.exports.useEffect(()=>{e&&a(e)},[e]),g("div",{className:wt.container,children:[t("div",{className:wt.logo,children:t("img",{src:yn})}),t(Dn,{tabs:o,onChange:r,initialValue:n}),t("div",{className:wt.close,onClick:()=>logseq.hideMainUI(),children:t(Mt,{})})]})};function ce(){const[e,o]=v.exports.useState(Z.lightThemeType);return v.exports.useEffect(()=>{lo().then(a=>{o(a)})}),e}const On={green:{lineColor:"#058f68",backColor:"rgba(5, 143, 104, 0.8)",backColorEnd:"rgba(255,255,255,0)"},purple:{lineColor:"#3a4de9",backColor:"rgba(58,77,233,0.8)",backColorEnd:"rgba(255,255,255,0)"},dark:{lineColor:"#d19811",backColor:"rgba(148, 108, 12, 0.8)",backColorEnd:"rgba(33, 37, 40, 0.8)"}},Nn={green:{backColor:"#e9f2f0",lineColor:"#058f68",shadowColor:"rgba(5, 143, 104, 0.8)",colorPrimary:"#333",colorSecondary:"#777"},purple:{backColor:"#f2f6ff",lineColor:"#5146a0",shadowColor:"rgba(58,77,233,0.8)",colorPrimary:"#333",colorSecondary:"#777"},dark:{backColor:"#212528",lineColor:"#d19811",shadowColor:"rgba(33, 37, 40, 0.8)",colorPrimary:"#fafafe",colorSecondary:"#aaadb3"}},Mn=Za(),uo=({progress:e=0,uniqueId:o="",height:a=160,type:n="primary"})=>{const r=v.exports.useRef(),s=ce();return v.exports.useEffect(()=>{const i=document.getElementById("gauge"+o);async function l(){if(!i||!s)return;const d=Nn[s],c=n==="normal"?20:60,u=n==="normal"?4:7,m={series:[{type:"gauge",startAngle:90,endAngle:-270,min:0,max:100,splitNumber:12,grid:{left:"0",right:"0",bottom:"0",containLabel:!0},itemStyle:{color:d.lineColor,shadowColor:d.shadowColor,shadowBlur:n==="normal"?3:10,shadowOffsetX:n==="normal"?0:2,shadowOffsetY:n==="normal"?0:2},progress:{show:!0,roundCap:!0,width:u},pointer:{show:!1},axisLine:{roundCap:!0,lineStyle:{width:u,color:[[1,d.backColor]]}},axisTick:{show:!1},splitLine:{show:!1},axisLabel:{show:!1},title:{show:!1},detail:{show:!0,width:c,height:c,lineHeight:c+(Mn==="windows"?4:0),borderRadius:100,offsetCenter:[0,0],valueAnimation:!0,formatter:function(h){return"{value|"+h.toFixed(0)+"}{unit|%}"},rich:{value:{fontSize:n==="normal"?15:34,color:d.colorPrimary},unit:{fontSize:n==="normal"?10:15,color:d.colorSecondary,padding:n==="normal"?[0,0,-2,1]:[0,0,-8,2]}}},data:[{value:e}]}]};window.requestAnimationFrame(()=>{const h=_e(i);r.current=h,h.setOption(m)})}return l(),()=>{r.current&&r.current.dispose()}},[e,s]),t("div",{children:t("div",{id:"gauge"+o,style:{width:"100%",height:a+"px"}})})},En=({data:e})=>{const o=v.exports.useRef(),a=ce();return v.exports.useEffect(()=>{const n=document.getElementById("polygonal");async function r(){if(!n||!a)return;const s=On[a],i={xAxis:{type:"category",data:e.map(l=>{const d=p(l.date).format("DD");return d==="01"?p(l.date).format("MM.DD"):d}),axisTick:{show:!1},axisLine:{show:!1}},yAxis:{type:"value",splitLine:{show:!1},minInterval:1},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},series:[{data:e.map(l=>l.value),type:"line",smooth:!0,emphasis:{focus:"series"},showSymbol:!1,itemStyle:{color:s.lineColor},areaStyle:{color:new Fo(0,0,0,1,[{offset:0,color:s.backColor},{offset:1,color:s.backColorEnd}])}}]};window.requestAnimationFrame(()=>{const l=_e(n);o.current=l,l.setOption(i)})}return r(),()=>{o.current&&o.current.dispose()}},[e,a]),t("div",{id:"polygonal",style:{height:"240px",width:"100%"}})},mo=`
  .external-link[href^="#agenda://"]::before {
    content: '\u{1F4C5}';
    margin: 0 4px;
  }
  .agenda-sidebar-task__add {
    display: none;
  }
  .agenda-sidebar-task:hover {
    opacity: 1;
  }
  .agenda-sidebar-task:hover .agenda-sidebar-task__add {
    display: flex;
  }
  .agenda-sidebar-task:hover .agenda-sidebar-task__title {
    color: var(--ls-link-text-color);
  }

  .external-link[href^="#agenda-pomo://"]::before {
    display: none;
  }
  .external-link[href^="#agenda-pomo://"] {
    font-weight: 600;
    border: 1px solid #0F9960;
    background: #defcf0;
    border-radius: 4px;
    padding: 1px 6px;
    color: #222;
    white-space: nowrap;
  }
  .dark .external-link[href^="#agenda-pomo://"] {
    background-color: #1a543b;
    color: #ddd;
  }

  .agenda-toolbar-pompdoro {
    height: 1.5rem;
    width: 62px;
    line-height: 1.5rem;
    font-size: 14px;
    font-weight: 600;
    border-radius: 0.3rem;
    margin: 0 0.125rem;
    color: #cd3838;
    border: 1px solid #cd3838;
    text-align: center;
    position: relative;
  }
  .agenda-toolbar-pompdoro .timer-progress-back {
    width: 0;
    height: 100%;
    background: #f6dbdb;
    position: absolute;
    z-index: -1;
    left: 0;
    top: 0;
    transition: width 0.5s;
  }
  .dark .agenda-toolbar-pompdoro .timer-progress-back {
    background-color: #a69494;
  }
  .agenda-toolbar-pompdoro.break {
    color: #0F9960;
    border-color: #0F9960;
  }
  .agenda-toolbar-pompdoro.break .timer-progress-back {
    background-color: #defcf0;
  }
  .dark .agenda-toolbar-pompdoro.break .timer-progress-back {
    background-color: #1a543b;
  }
  .agenda-toolbar-pompdoro.hide {
    display: none;
  }
`,Ke={bgColor:"#b8e986",textColor:"#4a4a4a",borderColor:"#047857"},po=(e,o,a,n=!1)=>`<div data-on-click="showPomodoro" class="agenda-toolbar-pompdoro ${n?"break":""}" data-uuid="${e}">
    ${o}
    <div class="timer-progress-back" style="width: ${a*100}%;"></div>
  </div>`,bt=(e=!0)=>{const o=document.querySelector("#pomodoro-root");o&&e&&o.classList.remove("hide"),o&&!e&&o.classList.add("hide")},ho=(e,o)=>{const a=o==="markdown"?We:Ge,n=e.match(a);if(!n||!n?.[1])return null;const s=Vt(n[1]).t;return s?s.split(",").map(l=>{const d=l.split("-"),[c,u,m,...h]=d,w=h.join("-"),C=h?.length>0?w.split(Gt):[];return{isFull:c==="f",start:parseInt(u),length:parseInt(m),interruptions:C.map(S=>({type:Number(S?.[0]),time:Number(S.substring(1,14)),remark:S.substring(14)}))}}):null},kt=async(e,o,a="addon")=>{const n=await logseq.Editor.getBlock(e);if(!n)return;let r=[].concat(o);a==="addon"&&(r=(ho(n.content,n.format)||[]).concat(o));const s=r.map(S=>{const{isFull:I,start:x,length:q,interruptions:k}=S,D=I?"f":"p",b=k?.map(y=>{const{type:T,time:O,remark:E}=y;return`${T}${O}${E}`}).join(Gt);return`${D}-${x}-${q}${b?`-${b}`:""}`}).join(","),i=new URL("agenda-pomo://");i.searchParams.append("t",s);const l=r.reduce((S,I)=>S+I.length,0),c=`${r.filter(S=>S.isFull)?.map(()=>"\u{1F345}")?.join("")||"\u{1F345}"} ${Math.ceil(l/60)}min`,u=n?.format==="org"?`>[[#${i.toString()}][${c}]]`:`>[${c}](#${i.toString()})`,[m,...h]=n.content?.split(`
`)||[];let w=m;const C=n.format==="markdown"?We:Ge;return C.test(n.content)?w=m.replace(C,u):w=`${m} ${u}`,`${w}
${h.join(`
`)}`},qn=(e,o)=>{const a=o==="markdown"?We:Ge;return e.replace(a,"")?.trim()},Ze=e=>{const{journal:o,projectList:a=[]}=j();let n=e?.addOns?.allDay?"allday":"time";e?.addOns?.isOverdue&&(n="task");let r=e?.addOns?.isJournal?o:a.find(s=>s.id===e?.addOns?.project);return r||(r=Ke),{id:e.uuid,calendarId:e.addOns.isJournal?"Journal":e.addOns.project,title:e.addOns.showTitle,body:e.content,category:n,dueDateClass:"",start:e.addOns.start,end:e.addOns.end,raw:e,color:r?.textColor,bgColor:r?.bgColor,borderColor:r?.borderColor,isAllDay:!e?.addOns?.isOverdue&&e.addOns.allDay,customStyle:e.addOns.status==="done"?"opacity: 0.6;":"",isReadOnly:!1}},Xe=e=>{const{journal:o,projectList:a=[]}=j();let n=e?.addOns?.isJournal?o:a.find(r=>r.id===e?.addOns?.project);return n||(n=Ke),{id:e.uuid,calendarId:e.addOns.isJournal?"Journal":e.addOns.project,title:e.addOns.showTitle,body:e.content,category:"milestone",dueDateClass:"",start:e.addOns.start,end:e.addOns.end,raw:e,color:n?.textColor,bgColor:n?.bgColor,borderColor:n?.borderColor,isAllDay:!1,customStyle:e.addOns.status==="done"?"opacity: 0.6;":"",isReadOnly:!1}},go=e=>{const o=p(e.addOns.start),a=p(e.addOns.end);return{id:e.uuid,title:e.addOns.showTitle,start:o.format("YYYY-MM-DD"),end:a.format("YYYY-MM-DD"),raw:e,completed:e.addOns.status==="done",detailPopup:g("div",{className:"text-xs",children:[t("div",{className:"font-bold text-base my-2",children:e.addOns.showTitle}),t("div",{className:"my-2",children:`${o.format("YYYY.MM.DD")} - ${a.format("YYYY.MM.DD")}`}),t("div",{className:"whitespace-pre-line",dangerouslySetInnerHTML:{__html:Ht.render(e.content)}}),t("a",{onClick:async()=>{const{id:n,originalName:r}=e.page||{};let s=r;s||(s=(await de({id:n}))?.originalName),logseq.Editor.scrollToBlockInPage(s,e.uuid),logseq.hideMainUI()},children:"Navigate to block"})]})}},oe=async(e,o)=>{const{defaultDuration:a,journal:n,projectList:r}=o,s=e?.page?.originalName?e.page:await logseq.Editor.getPage(e.page.id);e.page=s;const i=Pn(e),l=ho(e.content,e.format),d=dn(e),c=e.refs?.find(C=>C.originalName===e.properties?.project?.[0]),u=Boolean(c?c?.journalDay:s?.journalDay);let m=i?{...e,rawTime:i,addOns:{showTitle:"",project:"Journal",contentWithoutTime:"",end:"",status:"todo",isOverdue:!1,isJournal:!1,type:"task",...i}}:{...e,addOns:{showTitle:"",project:"Journal",contentWithoutTime:"",status:"todo",isOverdue:!1,isJournal:!1,type:"task"}},h=co(e);if(i?.timeFrom==="customLink"&&(h=to(h.trim())),i?.timeFrom==="journal"&&!i?.allDay&&(h=Xt(h.trim())),i?.timeFrom==="refs"){const{preferredDateFormat:C}=await logseq.App.getUserConfigs(),S=X(p(i.start).valueOf(),C);h=h.replace(`[[${S}]]`,"")?.trim()}m.addOns.contentWithoutTime=h,l&&(h=qn(h,e.format)),d&&(h=h?.replace("#milestone","")?.trim()),m.addOns.showTitle=await eo(h?.split(`
`)?.[0]?.trim()),i&&!i.end&&(i.allDay?m.addOns.end=i.start:m.addOns.end=p(m.addOns.start).add(a.value,a.unit).format()),["DOING","NOW"].includes(e.marker)?m.addOns.status="doing":e.marker==="WAITING"?m.addOns.status="waiting":e.marker==="DONE"?m.addOns.status="done":e.marker==="CANCELED"&&(m.addOns.status="canceled"),i&&Zt(e,m.addOns.end,i?.allDay)&&(m.addOns.isOverdue=!0),u&&(m.addOns.isJournal=!0),d&&(m.addOns.type="milestone"),m.addOns.pomodoros=l||[],m.addOns.project=u?"Journal":c?.originalName||s?.originalName,m.addOns.projectPage=c||s;const w=r?.find(C=>C.id===m.addOns.project);return w?m.addOns.calendarConfig=w:u?m.addOns.calendarConfig=n:m.addOns.calendarConfig={id:m.addOns.project,enabled:!0,...Ke},m},Pn=e=>{const{start:o,end:a}=e.properties||{};if(o&&a)return o?.length>=16?{start:p(o,"YYYY-MM-DD HH:mm").format(),end:p(a,"YYYY-MM-DD HH:mm").format(),allDay:!1,timeFrom:"startProperty"}:{start:p(o,"YYYY-MM-DD").format(),end:p(a,"YYYY-MM-DD").format(),allDay:!0,timeFrom:"startProperty"};const n=ln(e.content),r=n?.start?.length===13?Number(n.start):n?.start,s=n?.end?.length===13?Number(n.end):n?.end;if(n)return{start:p(r).format(),end:p(s).format(),allDay:n.allDay!=="false",timeFrom:"customLink"};if(e.scheduled){const d=e.content?.split(`
`)?.find(u=>u.startsWith("SCHEDULED:"))?.trim(),c=/ (\d{2}:\d{2})[ >]/.exec(d)?.[1]||"";return c?{start:p(`${e.scheduled} ${c}`,"YYYYMMDD HH:mm").format(),allDay:!1,timeFrom:"scheduledProperty"}:{start:p(""+e.scheduled,"YYYYMMDD").format(),allDay:!0,timeFrom:"scheduledProperty"}}if(e.deadline){const d=e.content?.split(`
`)?.find(u=>u.startsWith("DEADLINE:"))?.trim(),c=/ (\d{2}:\d{2})[ >]/.exec(d)?.[1]||"";return c?{start:p(`${e.deadline} ${c}`,"YYYYMMDD HH:mm").format(),allDay:!1,timeFrom:"deadlineProperty"}:{start:p(""+e.deadline,"YYYYMMDD").format(),allDay:!0,timeFrom:"deadlineProperty"}}const i=e.refs?.find(d=>Boolean(d?.journalDay));if(i)return{start:p(i?.journalDay+"","YYYYMMDD").format(),allDay:!0,timeFrom:"refs"};if(Boolean(e?.page?.journalDay)){const d=co(e),{start:c,end:u}=pt(d);return c&&u?{start:p(`${e?.page?.journalDay} ${c}`,"YYYYMMDD HH:mm").format(),end:p(`${e?.page?.journalDay} ${u}`,"YYYYMMDD HH:mm").format(),allDay:!1,timeFrom:"journal"}:c&&!u?{start:p(`${e?.page?.journalDay} ${c}`,"YYYYMMDD HH:mm").format(),allDay:!1,timeFrom:"journal"}:{start:p(e?.page?.journalDay+"","YYYYMMDD").format(),allDay:!0,timeFrom:"journal"}}return null},je=()=>({tasks:{withTime:[],noTime:[]},milestones:{withTime:[],noTime:[]}}),vt=async()=>{let e=await logseq.DB.datascriptQuery(`
  [:find (pull
    ?block
    [:block/uuid
      :block/parent
      :db/id
      :block/left
      :block/collapsed?
      :block/format
      :block/_refs
      :block/path-refs
      :block/tags
      :block/content
      :block/marker
      :block/priority
      :block/properties
      :block/pre-block?
      :block/scheduled
      :block/deadline
      :block/repeated?
      :block/created-at
      :block/updated-at
      :block/file
      :block/heading-level
      {:block/page
        [:db/id :block/name :block/original-name :block/journal-day :block/journal?]}
      {:block/refs
        [:db/id :block/name :block/original-name :block/journal-day :block/journal?]}])
    :where
    [?block :block/marker ?marker]
    [(contains? #{"TODO" "DOING" "NOW" "LATER" "WAITING" "DONE" "CANCELED"} ?marker)]]
  `);if(!e||e?.length===0)return null;const o=j();e=e.flat(),o.ignoreTag&&(e=e.filter(l=>!l.refs?.some(c=>c?.["original-name"]===o.ignoreTag)));let a=je(),n=je();const r=new Map,s=o?.projectList?.filter(l=>l?.enabled!==!0),i=e.map(async l=>{l={...l,uuid:typeof l.uuid=="string"?l.uuid:l.uuid?.$uuid$,page:{...l.page,originalName:l.page?.["original-name"],journalDay:l.page?.["journal-day"]},refs:l.refs?.map(h=>({...h,journalDay:h?.["journal-day"],originalName:h?.["original-name"]}))};const d=await oe(l,o),c=d.addOns.type==="milestone",u=d.rawTime,m=d.addOns.isJournal;if(!(m&&!o?.journal?.enabled)&&!s?.some(h=>h?.id===d?.addOns.project))if(c?u?a.milestones.withTime.push(d):a.milestones.noTime.push(d):u?a.tasks.withTime.push(d):a.tasks.noTime.push(d),m)c?u?n.milestones.withTime.push(d):n.milestones.noTime.push(d):u?n.tasks.withTime.push(d):n.tasks.noTime.push(d);else{const h=d.addOns.project,w=r.get(h)||je();c?u?w.milestones.withTime.push(d):w.milestones.noTime.push(d):u?w.tasks.withTime.push(d):w.tasks.noTime.push(d),r.set(h,w)}});return await Promise.all(i),{journalEvents:n,projectEventsMap:r,fullEvents:a}},fo=e=>e.addOns.pomodoros?.reduce((o,a)=>o+a.length,0)||0,fe=V(je()),De=V(je()),Te=V(new Map),xt=V(e=>{const o=e(fe),a=o.tasks.withTime.map(Ze),n=o.milestones.withTime.map(Xe);return a.concat(n)}),jn=V(e=>{const{journal:o}=j(),a=e(xt);return{calendarConfig:o,schedules:a.filter(({calendarId:n})=>n==="Journal")}}),Bn=V(e=>{const{projectList:o=[]}=j(),a=e(xt);return o?.map(n=>({calendarConfig:n,schedules:a.filter(({calendarId:r})=>r===n.id)}))}),Ln=V(e=>{const o=e(fe),a=p().subtract(14,"day"),n=p();return o.tasks.withTime.filter(r=>p(r.start).isBetween(a,n,"day","(]"))}),et=V(e=>e(fe).tasks.withTime.filter(a=>{if(a.addOns.status==="canceled")return!1;if(a.addOns.isOverdue)return!0;const n=p(a.addOns.start),r=p(a.addOns.end);return p().isBetween(n,r,"day","[]")}).sort((a,n)=>p(a.addOns.start).diff(p(n.addOns.start)))),tt=V(e=>{const{projectList:o=[],journal:a}=j();return([a].concat(o)?.filter(s=>s?.enabled)).map(s=>{const i=s.id;let l=e(Te).get(i);if(s.id==="Journal"){const h=e(De),w=p().subtract(1,"week"),C=p().add(1,"year");l={tasks:{withTime:h.tasks?.withTime?.filter(S=>p(S.addOns.start).isBetween(w,C)),noTime:[]},milestones:{withTime:h.milestones?.withTime?.filter(S=>p(S.addOns.start).isBetween(w,C)),noTime:[]}}}const d=s.id==="Journal"?a:o.find(h=>h.id===i);if(!l)return{id:i,title:i,amount:{doing:0,todo:0,done:0},style:{bgColor:s.bgColor||"#fff",borderColor:s.borderColor||"#fff",color:s.textColor||"#000"},events:[],milestones:[]};const{doing:c,todo:u,done:m}=ge(l?.tasks?.withTime);return{id:i,title:i,amount:{doing:c?.length,todo:u?.length,done:m?.length},style:{bgColor:d?.bgColor||"#fff",borderColor:d?.borderColor||"#fff",color:d?.textColor||"#000"},events:l.tasks.withTime.map(go),milestones:l.milestones.withTime.map(go)}}).filter(function(s){return Boolean(s)})}),yo=0,ue=40,ot=40,_n=160,Rn={day:108,week:44,month:20},Yn=[{value:"simple",label:"Simple"},{value:"advanced",label:"Advanced"}],Fn=[{value:"day",label:"Day"},{value:"week",label:"Week"},{value:"month",label:"Month"}],Ct=(e,o)=>{const a=[];let n=e;for(;n.isSameOrBefore(o);)a.push(n.clone()),n=n.add(1,"day");return a},wo=e=>e.day()===0||e.day()===6,Hn=(e,o="simple")=>{let a=[];return e.forEach((n,r)=>{const s=a[r-1],{levelCount:i=0,events:l=[],milestones:d=[]}=s||{},c=o==="simple"?i:l.length,u=o==="simple"?d.length>0?1:0:d.length,m=r===0?0:s.coordinate.y+(c+u)*ue+yo+ot;a.push({...n,coordinate:{x:0,y:m}})}),a},bo=(e,o,a)=>o.diff(e,"day")*a,at=(e,o="")=>{document.getElementById(`date${o}${e.format("YYYYMMDD")}`)?.scrollIntoView({block:"nearest",inline:"center",behavior:"smooth"})},$n=e=>e.map(o=>ko(o)),Un=e=>e.map(o=>Wn(o)),Wn=e=>{const{events:o,rangeStart:a,rangeEnd:n}=ko(e);let r=vo(o,[],p(a),p(n));return{...e,levelCount:r.length,events:r.map((s,i)=>s.map(l=>({...l,level:i}))).flat()}},ko=e=>{const{events:o,milestones:a}=e;o.sort((d,c)=>p(d.start).diff(p(c.start)));let n=new Map;o.forEach(d=>{const{start:c}=d;n.has(c)?n.get(c)?.push(d):n.set(c,[d])}),n.forEach(d=>{d.sort((c,u)=>{const m=p(c.end).diff(p(c.start),"day");return p(u.end).diff(p(u.start),"day")-m})});const r=Array.from(n.values()),s=r[0]?.[0]?.start,i=r[r.length-1]?.[0]?.end,l=r.flat();return{...e,events:l,milestones:a?.sort((d,c)=>p(d.start).diff(p(c.start))),rangeStart:s,rangeEnd:i}};function Gn(e,o){const a=new Map;return Ct(e,o).forEach(n=>{a.set(n.format("YYYY-MM-DD"),!1)}),a}function vo(e=[],o=[],a,n){const r=Gn(p(a),p(n)),s=[],i=[];return e.forEach(l=>{const{start:d,end:c}=l,u=p(d),m=p(c),h=Ct(u,m).map(w=>w.format("YYYY-MM-DD"));r.get(u.format("YYYY-MM-DD"))===!1?(h.forEach(w=>{r.set(w,!0)}),s.push(l)):i.push(l)}),o.push(s),i?.length===0?o:vo(i,o,a,n)}const zn=e=>{const o=e.map(r=>{const{events:s,milestones:i=[]}=r;return[...s,...i]}).flat();let a=p(),n=p();return o.forEach(r=>{const{start:s,end:i}=r;p(s).isBefore(a)&&(a=p(s)),p(i).isAfter(n)&&(n=p(i))}),{start:a,end:n}},Qn=({groupId:e,groupName:o,events:a,milestones:n=[],mode:r,levelCount:s=0,uniqueId:i="",foldedGroups:l,onFoldChange:d})=>{const c=l?.includes(e||""),u=m=>d?.(e||"",m);return g("div",{className:"group rounded-sm min-h-full",children:[g("div",{className:"group__title sticky bg-quaternary title-text z-10 flex items-center cursor-pointer",title:o,onClick:()=>u?.(!c),children:[c?t(Ho,{className:"shrink-0"}):t($o,{className:"shrink-0"}),t("span",{className:"single_ellipsis",children:o})]}),!c&&g("div",{className:"group__content",children:[r==="simple"?new Array(s).fill(0).map((m,h)=>t("div",{className:"group__event cursor-pointer"})):a.map(m=>t("div",{className:"group__event cursor-pointer single_ellipsis",onClick:()=>at(p(m.start),i),children:m?.title})),r==="simple"?n?.length>0?t("div",{className:"group__event cursor-pointer flex justify-between items-center"}):null:n?.map((m,h)=>t("div",{className:"group__event cursor-pointer single_ellipsis milestone",onClick:()=>at(p(m.start),i),children:m?.title}))]})]})},Jn=({data:e,mode:o="simple",view:a="day",weekStartDay:n=0,uniqueId:r="",foldedGroups:s,showSidebar:i,onFoldChange:l},d)=>{const c=i?_n:0,u=p(),m=e.map(b=>s?.includes(b.id)?{...b,events:[],milestones:[],levelCount:0}:b),{start:h,end:w}=zn(m),C=h.subtract(1,"day"),S=w.add(9,"day"),I=Rn[a],x=Ct(C,S),k=Hn(m,o).map((b,y)=>{const{events:T,milestones:O=[]}=b,E=o==="simple"?(b.levelCount||0)*ue:T.length*ue,N=o==="simple"?(O.length>0?1:0)*ue:O.length*ue,B=E+N+ot;return{...b,height:B,events:b.events.map((A,_)=>{const z=o==="simple"?A?.level||0:_;return{...A,coordinates:{x:bo(C,p(A.start),I)+c,y:b.coordinate.y+z*ue},size:{width:I*(p(A.end).diff(p(A.start),"day")+1)-8,height:ue-4}}}),milestones:b.milestones?.map((A,_)=>{const z=o==="simple"?0:_;return{...A,coordinates:{x:bo(C,p(A.start),I)+c,y:b.coordinate.y+E+z*ue}}})}}),D=k.reduce((b,y)=>b+y.height+yo,0);return v.exports.useEffect(()=>{document.getElementById(`date${r}${p().format("YYYYMMDD")}`)?.scrollIntoView({block:"nearest",inline:"center"})},[]),v.exports.useImperativeHandle(d,()=>({scrollToToday(){at(p(),r)}})),g("div",{className:"calendar h-full w-full overflow-auto scroll-style",children:[t("div",{className:"w-fit whitespace-nowrap bg-quaternary sticky top-0 z-20 text",style:{marginLeft:c+"px"},children:x.map(b=>{const T=b.format("DD")==="01"||b.isSame(C,"day");return t("div",{className:"inline",children:t("span",{className:"inline-block text-center sticky bg-quaternary overflow-visible box-content",style:{width:`${I}px`,left:0,lineHeight:"25px",paddingRight:"100px",marginRight:"-100px"},children:T?b.format("MMMM YYYY"):""})},"month"+b.valueOf())})}),g("div",{className:"calendar__header w-fit whitespace-nowrap bg-quaternary sticky z-20",style:{top:"25px"},children:[t("div",{className:"inline-block",style:{width:c+"px"}}),x.map(b=>{const y=b.format("DD"),T=wo(b),O=b.isSame(u,"day");let E=!0;return a==="month"&&(E=b.day()===n||O),t("div",{className:`calendar__date inline-flex ${T?"weekend":""} ${O?"today":""}`,id:"date"+r+b.format("YYYYMMDD"),children:t("span",{className:`inline-block text-center ${E?"":"opacity-0"}`,style:{width:"108px"},children:y})},"date"+b.valueOf())})]}),g("div",{className:"calendar__content relative flex w-fit",style:{height:"calc(100% - 50px)"},children:[i&&t("div",{className:"side-bar bg-quaternary sticky left-0 z-10 h-fit min-h-full",children:e.map((b,y)=>t(Qn,{mode:o,groupId:b.id,groupName:b.title,events:b?.events,milestones:b?.milestones,levelCount:b.levelCount,uniqueId:r,foldedGroups:s,onFoldChange:l},b.id))}),t("div",{className:"flex w-fit sticky top-0 min-h-full",style:{left:c+"px",height:D+"px"},children:x.map((b,y)=>{const T=wo(b),O=b.isSame(u,"day");return t("div",{className:`calendar__content__back ${T?"weekend":""} ${O?"today":""}`})})}),k.map(b=>g("div",{className:"calendar__group w-fit",children:[b.events.map(y=>{const{coordinates:T,size:O,detailPopup:E,completed:N}=y;return t(Et,{content:E,trigger:"click",overlayInnerStyle:{borderRadius:"4px",maxWidth:"500px"},children:t("div",{className:`calendar__event absolute bg-quaternary rounded cursor-pointer single_ellipsis shadow ${N?"completed":""}`,style:{left:T.x,top:T.y+ot,width:O.width+"px",height:O.height+"px"},title:y.title,children:y.title},y.id)})}),b.milestones?.map(y=>{const{coordinates:T,detailPopup:O,completed:E}=y;return g(re,{children:[t("div",{className:"calendar__milestone__line absolute min-h-full",style:{left:T.x+I/2,top:0,height:D+"px"}},"milestone-line"+y.id),t(Et,{content:O,trigger:"click",overlayInnerStyle:{borderRadius:"4px",maxWidth:"500px"},children:g("div",{className:"calendar__milestone__text absolute flex items-center cursor-pointer",style:{left:T.x+2+I/2,top:T.y+ot},title:y.title,children:[E&&t("svg",{"data-v-651e2bfe":"",viewBox:"0 0 16 16",fill:"var(--ls-primary-background-color)",className:"milestone__mark",children:t("path",{"data-v-651e2bfe":"",d:"M5.536 11.175L2 7.639l1.497-1.497L7 9.642l6-6.28 1.497 1.497-7.464 7.814-1.497-1.497z"})}),t("span",{className:"single_ellipsis",style:{maxWidth:I-20},children:y.title})]},"milestone-text"+y.id)})]})}),t("div",{})]},b.id))]})]})};var Vn=v.exports.forwardRef(Jn);const nt=({weekStartDay:e,data:o,showSidebar:a=!0,showOptions:n=!0,defaultView:r="day",defaultMode:s="simple",showModeSelector:i=!1,theme:l="light",uniqueId:d="",...c})=>{const u=v.exports.useRef(),[m,h]=v.exports.useState(r),[w,C]=v.exports.useState(s),[S,I]=v.exports.useState([]),[x,q]=v.exports.useState([]),k=(D,b)=>{q(b?[...x,D]:x.filter(y=>y!==D))};return v.exports.useEffect(()=>{const D=w==="simple"?Un(o):$n(o);I(D)},[o,w]),g("div",{className:M(`w-full h-full relative gantt text view-${m}`,{dark:l==="dark"},{light:l!=="dark"}),...c,children:[a&&t("div",{className:"calendar__placeholder absolute bg-quaternary"}),n&&g("div",{className:"operation absolute right-0 top-0 z-30 bg-quaternary",children:[t(U,{size:"small",shape:"round",onClick:()=>at(p(),d),children:"Today"}),t(F,{size:"small",options:Fn,defaultValue:m,onChange:D=>h(D),style:{minWidth:"80px"},className:"ml-2 select-style"}),i&&t(F,{size:"small",options:Yn,defaultValue:"simple",onChange:D=>C(D),style:{minWidth:"110px"},className:"ml-2 select-style"})]}),t(Vn,{data:S,ref:u,mode:w,view:m,uniqueId:d,foldedGroups:x,showSidebar:a,onFoldChange:k})]})},Kn="_content_16805_1",Zn="_stats_16805_4",Xn="_statsRight_16805_7",er="_amount_16805_10",tr="_project_16805_15",or="_projectContent_16805_18",ar="_milestone_16805_22",nr="_timeline_16805_26",rr="_showTimeline_16805_26",sr="_option_16805_39",lr="_rightSide_16805_43",ir="_taskLine_16805_49",dr="_module_16805_52",cr="_task_16805_49",ur="_taskDone_16805_66",mr="_taskActive_16805_69",pr="_time_16805_26",hr="_overdue_16805_92",gr="_sub_16805_95";var L={content:Kn,stats:Zn,statsRight:Xn,amount:er,project:tr,projectContent:or,milestone:ar,timeline:nr,showTimeline:rr,option:sr,rightSide:lr,taskLine:ir,module:dr,task:cr,taskDone:ur,taskActive:mr,time:pr,overdue:hr,sub:gr};function fr(e){const{milestones:o=[]}=e;if(o?.length===0)return null;const a=o.filter(n=>p(n.start).isSameOrAfter(p(),"day"));return a.length===0?null:a.sort((n,r)=>p(n.start).diff(p(r.start)))?.[0]}const yr=({data:e})=>{let[o]=P(De);if(e.title!=="Journal"){const[y]=P(Te);o=y.get(e.title)}const[a,n]=v.exports.useState(!1),r=ce(),s=Nt(),i=fr(e),l=o?.tasks?.withTime.concat(o?.tasks?.noTime),{todo:d,doing:c,done:u,waiting:m,canceled:h}=ge(l),w=c.length,C=d.length,S=u.length,I=m.length,x=h.length,q=w+C+S+I,k=q===0?0:S/q,D=async y=>{const{id:T,originalName:O}=y?.raw?.page||{};let E=O;E||(E=(await de({id:T}))?.originalName),logseq.Editor.scrollToBlockInPage(E,y?.raw?.uuid),logseq.hideMainUI()},b=async()=>{const y=e.id;s(`/project/${encodeURIComponent(y)}`)};return g("div",{className:M(L.project),children:[g("div",{className:M("flex flex-col flex-1 w-0",L.projectContent,{[L.expand]:a}),children:[g("div",{className:"flex justify-between items-center h-24 p-3",children:[g("div",{className:"h-full flex items-center cursor-pointer",onClick:b,children:[t("div",{className:"w-8 h-8 rounded-full bg-gray-300 flex items-center justify-center text-lg font-medium",style:{backgroundColor:e?.style?.bgColor,color:e?.style?.color},children:Array.from(e.title)?.[0]?.toUpperCase()}),g("div",{className:"ml-3",children:[t("div",{className:"text-lg title-text",children:e.title}),t("div",{className:"mt-1 description-text",children:`doing: ${w} todo: ${C} done: ${S} waiting: ${I} canceled: ${x}`})]})]}),g("div",{className:"h-full flex items-center",children:[t("div",{style:{width:"4.375rem"},children:t(uo,{progress:parseInt(""+k*100),uniqueId:e.id,height:70,type:"normal"})}),i&&g("div",{className:M("flex flex-col items-center justify-center d h-full pl-3 pr-1 ml-3 cursor-pointer",L.milestone),onClick:()=>D(i),children:[g("div",{className:"text-center",children:[t("span",{className:"text-3xl title-text",children:p(i.start).format("DD")}),t("span",{className:"text-xs description-text ml-1",children:p(i.start).format("MMM")})]}),g("span",{className:"text-xs description-text",children:["days left: ",p(i.start).diff(p(),"day"),"d"]}),t("span",{className:"text-xs description-text ellipsis w-full text-center",title:i.title,children:i.title})]})]})]}),t(Uo,{children:a&&t(Wo.div,{className:M(L.timeline,{[L.showTimeline]:a}),initial:{opacity:0,height:0},animate:{opacity:1,height:"auto",marginTop:"0.5rem",padding:"0.75rem"},exit:{opacity:0,height:0,marginTop:0,padding:0},transition:{ease:"easeInOut",duration:.2},children:t(nt,{data:[e],weekStartDay:0,showOptions:!1,showSidebar:!1,defaultView:"week",theme:r,uniqueId:e?.id})})})]}),t("div",{className:M(L.option,"text w-10 h-10 rounded-full flex justify-center items-center shadow-sm text-lg ml-3 cursor-pointer"),onClick:()=>n(!a),children:t("div",{className:"flex items-center",children:a?t(Go,{}):t(zo,{})})})]})};function wr(e,o=!1){const a=e?.addOns.start,n=e?.addOns.end,r=p(a),s=p(n),i=r.isSame(s,"day");return o?e.addOns.allDay?i?{start:r.format("MM-DD")}:{start:r.format("MM-DD"),end:s.format("MM-DD")}:i&&r.isSame(p(),"day")?{start:r.format("HH:mm"),end:s.format("HH:mm")}:i?{start:r.format("MM-DD")}:{start:r.format("MM-DD"),end:s.format("MM-DD")}:i?e.addOns.allDay?{start:"all-day"}:{start:r.format("HH:mm"),end:s.format("HH:mm")}:{start:r.format("MM-DD"),end:s.format("MM-DD")}}const Dt=({task:e,showTimeDot:o=!1,type:a="allDay"})=>{const n=p(e.addOns.start),r=p(e.addOns.end),s=a!=="overdue"&&p().isBetween(n,r),i=e?.addOns.status==="done",l=e.addOns.calendarConfig,{start:d,end:c}=wr(e,a==="overdue");return g("div",{className:M(L.task,{[L.taskActive]:s,[L.taskDone]:i},L?.[a],"flex pl-5 pr-4 py-2 items-center justify-between"),children:[o&&t("div",{className:M(L.time),children:t("span",{children:n?.format("HH:mm")})}),t("div",{className:"w-7 h-7 rounded-full flex items-center justify-center",style:{backgroundColor:l?.bgColor,color:l?.textColor},title:l?.id,children:Array.from(l?.id)?.[0]?.toUpperCase()}),g("div",{className:"flex flex-col flex-1 ellipsis mx-4",children:[t("span",{className:"ellipsis text",children:e.addOns.showTitle}),g("div",{className:M(L.sub,"text-xs flex justify-between"),children:[t("span",{className:"description-text",children:c?`${d} - ${c}`:d}),t("span",{className:"ml-2 ellipsis #6b531a",title:l?.id,children:l?.id})]})]}),t("div",{className:"w-5 h-5 cursor-pointer text",onClick:async()=>{const{id:u,originalName:m}=e?.page||{};let h=m;h||(h=(await de({id:u}))?.originalName),logseq.Editor.scrollToBlockInPage(h,e.uuid),logseq.hideMainUI()},children:t(qt,{})})]})},xo=V([]),rt=V([]),Co=V(e=>e(rt).filter(a=>{const n=p(a.start),r=p(a.end);return p().isBetween(n,r,"day","[]")}).sort((a,n)=>p(a.start).diff(p(n.start))));function br(e){const o=e?.start,a=e?.end,n=p(o),r=p(a);return n.isSame(r,"day")?e.isAllDay?{start:"all-day"}:{start:n.format("HH:mm"),end:r.format("HH:mm")}:{start:n.format("MM-DD"),end:r.format("MM-DD")}}const Do=({subscription:e,showTimeDot:o=!1,type:a="allDay"})=>{const n=p(e.start),r=p(e.end),s=a!=="overdue"&&p().isBetween(n,r),{start:i,end:l}=br(e);return g("div",{className:M(L.task,{[L.taskActive]:s},L?.[a],"flex pl-5 pr-4 py-2 items-center justify-between"),children:[o&&t("div",{className:M(L.time),children:t("span",{children:n?.format("HH:mm")})}),t("div",{className:"w-7 h-7 rounded-full flex items-center justify-center",style:{backgroundColor:e?.bgColor,color:e?.color},title:e.calendarId,children:Array.from(e.calendarId)?.[0]?.toUpperCase()}),g("div",{className:"flex flex-col flex-1 ellipsis mx-4",children:[t("span",{className:"ellipsis text",children:e.title}),g("div",{className:M(L.sub,"text-xs flex justify-between"),children:[t("span",{className:"description-text",children:l?`${i} - ${l}`:i}),t("span",{className:"ml-2 ellipsis #6b531a",title:e.calendarId,children:e.calendarId})]})]})]})},kr=()=>{const[e]=P(Co),{allDaySubscriptions:o,timeSubscriptions:a}=ao(e),[n]=P(et),{overdueTasks:r,allDayTasks:s,timeTasks:i}=oo(n);return g("div",{className:L.taskLine,children:[r.length>0&&g("div",{className:L.module,children:[t("span",{children:"Overdue"}),r.map(l=>t(Dt,{task:l,type:"overdue"},l.id))]}),(s.length>0||o.length>0)&&g("div",{className:L.module,children:[t("span",{children:"All Day"}),o.map(l=>t(Do,{subscription:l,type:"allDay"},l.id)),s.map(l=>t(Dt,{task:l,type:"allDay"},l.id))]}),(i.length>0||a.length>0)&&g("div",{className:L.module,children:[t("span",{children:"Time"}),a.map(l=>t(Do,{subscription:l,type:"time",showTimeDot:!0},l.id)),i.map(l=>t(Dt,{task:l,type:"time",showTimeDot:!0},l.id))]})]})};function vr(){const[e]=P(Ln),o=rn(ge(e)?.done),a=p().subtract(13,"day").startOf("day"),n=[a];for(let r=1;r<14;r++)n.push(a.add(r,"day"));return n.map(r=>{const s=o.get(r.format());return{date:r.format(),value:s?.length||0}})}const xr=()=>{const e=vr(),[o]=P(tt),a=o||[],[n]=P(et),r=ge(n),s=r?.todo?.length+r?.doing?.length,i=r?.done?.length,l=s+i,d=l===0?0:parseInt(i/l*100+""),c=async()=>{const{preferredDateFormat:u}=await logseq.App.getUserConfigs(),m=X(te(p().format("YYYY-MM-DD"),qe,new Date),u);logseq.App.pushState("page",{name:m}),logseq.hideMainUI()};return g("div",{className:"page-container flex",children:[g("div",{className:M(L.content,"flex flex-col flex-1 p-8"),children:[t("h1",{className:"title-text",children:"Dashboard"}),g("div",{className:"flex-1 overflow-auto",children:[g("div",{className:M(L.stats,"flex"),children:[t("div",{className:"flex-1",children:t(En,{data:e})}),g("div",{style:{width:"160px"},className:M("h-full rounded-xl shadow-sm cursor-pointer",L.statsRight),onClick:c,children:[t(uo,{progress:d}),g("div",{className:"flex justify-between px-6",children:[g("div",{className:M("flex flex-col rounded-lg text-center py-1 shadow-sm",L.amount),children:[t("span",{className:"text-3xl title-text",children:s}),t("span",{className:"text",children:"Todo"})]}),g("div",{className:M("flex flex-col rounded-lg text-center py-1 shadow-sm",L.amount),children:[t("span",{className:"text-3xl title-text",children:i}),t("span",{className:"text",children:"Done"})]})]})]})]}),t("div",{className:"mt-8",children:a.map(u=>t(yr,{data:u},u.id))})]})]}),t("div",{className:L.rightSide,children:t(kr,{})})]})},To=({visible:e,initialValues:o,onCancel:a,onSave:n,type:r="create",calendar:s,showKeepRef:i})=>{const[l,d]=v.exports.useState(!o?.isAllDay),{defaultDuration:c,projectList:u=[],journal:m}=j(),h=o?.calendarId==="Journal";let C=!u.some(({id:k})=>k===o?.calendarId)&&!h&&r==="update"?[m,{id:o?.calendarId,...Ke},...u]:[m,...u];const[S]=f.useForm();return t(se,{title:"Modify Schedule",visible:e,onOk:()=>{S.validateFields().then(async k=>{const{title:D,start:b,end:y,isAllDay:T,calendarId:O}=k,E=p(b).format("HH:mm"),N=p(y).format("HH:mm"),B=j();let _=C.find(({id:R})=>R===O.value)?.id==="Journal"?"journal":"project";const z=_==="journal";if(p(b).isAfter(p(y),T?"day":void 0))return logseq.UI.showMsg("Start time cannot be later than end time","error");if(z&&!p(b).isSame(p(y),"day"))return logseq.UI.showMsg("Journal schedule cannot span multiple days","error");const Se=o?.raw?.format==="markdown"?We:Ge;let Y=r==="update"&&o?.raw?.addOns.pomodoros?.length?`${D} ${o?.raw?.content.match(Se)?.[0]}`:D;_==="journal"?(r==="create"&&(Y=T?`TODO ${Y}`:`TODO ${E}-${N} ${Y}`),r==="update"&&(Y=T?Ve(o?.raw,Y):Ve(o?.raw,nn(Y,E,N)))):_==="project"&&(r==="create"?Y="TODO "+gt(Y,{start:b,end:y,allDay:T}):r==="update"&&(Y=Ve(o?.raw,gt(Y,{start:b,end:y,allDay:T})))),o?.raw?.addOns.type==="milestone"&&(Y+=" #milestone");const G={},{preferredDateFormat:ye}=await logseq.App.getUserConfigs();let Ae=o?.calendarId;if(z){const R=o?.start;R&&(Ae=X(R?.valueOf(),ye))}let ee=O.value;if(z){const R=X(b.valueOf(),ye),H=await logseq.Editor.createPage(R,{},{journal:!0});H&&(ee=H.originalName)}if(r==="create"){const R=logseq.settings?.logKey;let H;if(z?H=R?.enabled?await so(ee,`[[${R?.id}]]`,Y,G):await logseq.Editor.insertBlock(ee,Y,{isPageBlock:!0,sibling:!0,properties:G}):_==="project"&&(H=await so(ee,Wt,Y)),!H)return logseq.UI.showMsg("Create block failed","error");const me=await logseq.Editor.getBlock(H.uuid),pe=await oe(me,B),we=pe?.addOns?.type==="milestone"?Xe(pe):Ze(pe);s?.createSchedules([we])}else if(ee!==Ae){let R;const H=logseq.settings?.logKey;if(z?R=H?.enabled?await ft(o?.id,ee,`[[${H?.id}]]`):await ro(o?.id,ee):_==="project"&&(R=await ft(o?.id,ee,Wt)),await no(R.uuid,Y,G),Object.keys(G).length===0&&(await logseq.Editor.removeBlockProperty(R.uuid,"start"),await logseq.Editor.removeBlockProperty(R.uuid,"end")),R&&o?.calendarId){const me=await logseq.Editor.getBlock(R.uuid);s?.deleteSchedule(o?.id,o.calendarId);const pe=await oe(me,B),we=o?.raw?.addOns.type==="milestone"?Xe(pe):Ze(pe);s?.createSchedules([we])}}else{await no(o?.id,Y);const R=await logseq.Editor.getBlock(o?.id),H=await oe(R,B),me=o?.raw?.addOns.type==="task"?Ze(H):Xe(H);s?.updateSchedule(o?.id,o?.calendarId,me)}n?.()})},onCancel:()=>{a?.()},children:g(f,{form:S,onValuesChange:(k,D)=>{k.isAllDay!==void 0&&d(!k.isAllDay),k.start!==void 0&&S.setFieldsValue({end:k.start?.clone().add(c.value,c.unit)})},initialValues:{isAllDay:!0,...o,calendarId:o?.calendarId?{value:o?.calendarId}:void 0},children:[t(f.Item,{name:"calendarId",label:"Project",rules:[{required:!0}],children:t(F,{labelInValue:!0,children:C.map(k=>g(F.Option,{value:k?.id,children:[t("span",{style:{width:"12px",height:"12px",display:"inline-block",backgroundColor:k?.bgColor,verticalAlign:"middle",marginRight:"5px",borderRadius:"4px"}}),k?.id]},k?.id))})}),t(f.Item,{name:"title",label:"Schedule Title",rules:[{required:!0}],children:t(K,{})}),t(f.Item,{name:"start",label:"Start",rules:[{required:!0}],children:t(Re,{showTime:l?{format:"HH:mm",minuteStep:5}:!1,format:l?"YYYY-MM-DD HH:mm":"YYYY-MM-DD"})}),t(f.Item,{name:"end",label:"End",rules:[{required:!0}],children:t(Re,{showTime:l?{format:"HH:mm",minuteStep:5}:!1,format:l?"YYYY-MM-DD HH:mm":"YYYY-MM-DD"})}),t(f.Item,{name:"isAllDay",label:"All Day",rules:[{required:!0}],children:g(W.Group,{children:[t(W,{value:!0,children:"Yes"}),t(W,{value:!1,children:"No"})]})})]})})},Tt=({checked:e,color:o,indeterminate:a,onChange:n,children:r,...s})=>g("div",{onClick:()=>n?.(!e),...s,children:[t("span",{className:`check-box mr-2 ${e?"checked":""}`,style:{backgroundColor:o}}),r]}),Cr=({onShowCalendarChange:e,calendarList:o=[],subscriptionList:a=[]})=>{const[n,r]=v.exports.useState(["calendar","subscription"]),[s,i]=v.exports.useState(o.map(u=>u.id)?.concat(a?.map(u=>u.id))),l=(u,m)=>{let h=s.filter(w=>w!==u);m&&(h=s.concat(u)),i(h),e?.(h)},d=u=>{let m=[];u&&(m=o.map(h=>h.id)?.concat(a?.map(h=>h.id))),i(m),e?.(m)},c=u=>t("span",{className:"text text-xs",children:u});return g("div",{className:"sidebar pt-2 bg-quaternary",children:[g(le,{ghost:!0,expandIconPosition:"right",activeKey:n,expandIcon:({isActive:u})=>t("span",{className:"opacity-50",children:t(Qo,{rotate:u?0:-90})}),onChange:u=>r(typeof u=="string"?[u]:u),children:[t(le.Panel,{header:c("Project"),children:o.map(u=>t(Tt,{className:"mb-1 cursor-pointer flex items-center",color:u.bgColor,checked:s?.includes(u.id),onChange:m=>l(u.id,m),children:t(Ie,{title:u.id,placement:"right",children:t("span",{className:"singlge-line-ellipsis flex-1",children:u.id})})},u.id))},"calendar"),a?.length>0&&t(le.Panel,{header:c("Subscription"),className:"mt-3",children:a.map(u=>t(Tt,{className:"mb-1 cursor-pointer flex items-center",color:u.bgColor,checked:s?.includes(u.id),onChange:m=>l(u.id,m),children:t(Ie,{title:u.id,placement:"right",children:t("span",{className:"singlge-line-ellipsis flex-1",children:u.id})})},u.id))},"subscription")]}),t(Pt,{className:"my-2"}),t("div",{style:{padding:"0 10px"},children:t(Tt,{color:"#047857",checked:s?.length===o.length+a?.length,onChange:u=>d(u),children:t("span",{className:"cursor-pointer",children:"Check All"})})})]})},St=({schedules:e,isProjectCalendar:o=!0,isDailyLogCalendar:a=!1})=>{const{subscriptionList:n,logKey:r,projectList:s=[],journal:i}=j(),[l,d]=v.exports.useState(),[c,u]=v.exports.useState(!0),[m,h]=v.exports.useState(()=>a?"week":logseq.settings?.defaultView||"month"),w=[i,...s],C=n?n?.filter(N=>N?.enabled):[],[S,I]=v.exports.useState({visible:!1,type:"create"}),x=v.exports.useRef(),q=()=>{if(x.current){const N=x.current.getDateRangeStart().getTime(),B=x.current.getDateRangeEnd().getTime();ea(N,B)?d(X(N,qe)):d(X(N,qe)+" ~ "+X(B,qe))}},k=N=>{h(N),N==="2week"?(x.current?.changeView("month"),x.current?.setOptions({month:{visibleWeeksCount:2}})):N==="month"?(x.current?.changeView("month"),x.current?.setOptions({month:{visibleWeeksCount:void 0}})):x.current?.changeView(N),q()},D=N=>{(w.concat(C)?.map(A=>A.id)).forEach(A=>{N.includes(A)?x.current?.toggleSchedules(A,!1):x.current?.toggleSchedules(A,!0)})},b=()=>u(N=>!N),y=()=>{x.current?.today(),q()},T=()=>{x.current?.prev(),q()},O=()=>{x.current?.next(),q()},E=async()=>{if(m==="day"&&l){const{preferredDateFormat:N}=await logseq.App.getUserConfigs(),B=X(te(l,qe,new Date),N);logseq.App.pushState("page",{name:B}),logseq.hideMainUI()}};return v.exports.useEffect(()=>{x.current&&(x.current.clear(),x.current.createSchedules(e))},[e,x.current]),v.exports.useEffect(()=>{window.requestAnimationFrame(async()=>{let N=await pn();a&&(N=hn(N)),x.current=new Jo("#calendar",{...N}),q(),x.current.on("clickDayname",function(B){const A=x.current;A?.getViewName()==="week"&&(A.setDate(new Date(B.date)),A.changeView("day",!0),q(),h("day"))}),x.current.on("clickSchedule",function(B){document.querySelector("#faiz-nav-detail")?.addEventListener("click",async A=>{const _=B.schedule.raw||{},{id:z,originalName:Se}=_?.page||{};let Y=Se;Y||(Y=(await logseq.Editor.getPage(z))?.originalName);const{uuid:G}=await logseq.Editor.getBlock(_.id)||{uuid:""};logseq.Editor.scrollToBlockInPage(Y,G),logseq.hideMainUI()},{once:!0})}),x.current.on("beforeCreateSchedule",function(B){I({visible:!0,type:"create",values:{start:p(B.start),end:p(B.end),isAllDay:B.triggerEventName==="dblclick"}})}),x.current.on("beforeUpdateSchedule",async function(B){const{schedule:A,changes:_,triggerEventName:z,start:Se,end:Y}=B;if(z==="click")I({visible:!0,type:"update",values:{id:A.id,start:p(A.start),end:p(A.end),isAllDay:A?.raw?.category!=="time",calendarId:A.calendarId,title:A.title,raw:A.raw}});else if(_){if(A.calendarId==="journal"&&!p(Se).isSame(p(Y),"day"))return logseq.UI.showMsg("Journal schedule cannot span multiple days","error");const G=A.raw,ye=A.calendarId==="Journal"?"journal":"project",Ae=_?.start?_.start:G.rawTime?.start,ee=_?.end?_.end:G.rawTime?.end;if(ye==="journal"&&_.start){x.current?.updateSchedule(A.id,A.calendarId,_);const{preferredDateFormat:R}=await logseq.App.getUserConfigs();let H=G.content;if(G.rawTime?.timeFrom==="customLink"&&(H=to(H.trim())),G.rawTime?.timeFrom==="refs"){const _o=X(p(G.rawTime.start).valueOf(),R);H=H.replace(`[[${_o}]]`,"")?.trim()}const me=X(Ae.valueOf(),R),we=(await logseq.Editor.createPage(me,{},{journal:!0})).originalName;await logseq.Editor.updateBlock(A.id,H),r?.enabled?await ft(A?.id,we,`[[${r?.id}]]`):await ro(A?.id,we)}else if(ye==="project"){x.current?.updateSchedule(A.id,A.calendarId,_);const R=Ve(G,gt(G.addOns.contentWithoutTime,{start:p(Ae),end:p(ee),allDay:G.addOns.allDay}))?.split(`
`)?.[0];await logseq.Editor.updateBlock(A.id,R)}}}),x.current.on("beforeDeleteSchedule",function(B){const{schedule:A}=B;se.confirm({title:"Are you sure delete this schedule?",content:t("div",{className:"whitespace-pre-line",children:A.raw?.content}),onOk:async()=>{const _=await logseq.Editor.getBlock(A.raw?.id);if(!_)return logseq.UI.showMsg("Block not found","error");logseq.Editor.removeBlock(_?.uuid),x.current?.deleteSchedule(A.id,A.calendarId)}})})})},[]),g("div",{className:"flex flex-col w-full h-full",children:[g("div",{className:"mb-2 flex items-center justify-between",children:[g("div",{className:"flex items-center",children:[!o&&!a&&t(U,{className:"mr-2",onClick:b,icon:c?t(Vo,{}):t(Ko,{})}),t(U,{className:"ml-2",shape:"circle",icon:t(Zo,{}),onClick:T}),t(U,{className:"ml-1",shape:"circle",icon:t(Xo,{}),onClick:O}),t(U,{className:"ml-2",shape:"round",onClick:y,children:"Today"}),t(Ie,{title:m==="day"?"Navigate to this journal note":"",children:t("span",{className:`ml-4 text-xl h-full items-center inline-block title-text ${m==="day"?"cursor-pointer":"cursor-auto"}`,style:{height:"34px",lineHeight:"34px"},onClick:E,children:l})})]}),t("div",{children:t(W.Group,{options:$t,value:m,defaultValue:logseq.settings?.defaultView||"month",onChange:N=>k(N.target.value),optionType:"button",buttonStyle:"solid"})})]}),g("div",{className:"flex flex-1",children:[t("div",{className:`transition-all overflow-hidden bg-quaternary title-text mr-2 ${c?"w-0 mr-0":"w-40"}`,children:t(Cr,{onShowCalendarChange:D,calendarList:w,subscriptionList:C})}),t("div",{className:"flex-1 w-0",children:t("div",{id:"calendar",className:"h-full title-text"})})]}),S.visible?t(To,{visible:S.visible,type:S.type,initialValues:S.values,calendar:x.current,onCancel:()=>{I({visible:!1}),x.current?.render()},onSave:()=>{I({visible:!1})}}):null]})},Dr="_container_1ypzn_1",Tr="_sideBar_1ypzn_5";var Sr={container:Dr,sideBar:Tr};const Ar=()=>{const[e]=P(xt),[o]=P(rt),[a,n]=v.exports.useState([]);return v.exports.useEffect(()=>{tn().then(r=>{n(r)})},[]),t("div",{className:"page-container flex",children:g("div",{className:M(Sr.content,"flex flex-1 flex-col overflow-hidden p-8"),style:{maxWidth:"1800px"},children:[t("h1",{className:"title-text",children:"Calendar"}),t("div",{className:"bg-quaternary flex flex-col flex-1 rounded-2xl box-border p-6",children:t(St,{schedules:[...o,...e,...a],isProjectCalendar:!1})})]})})},Ir="_contentWrapper_42y1q_1",Or="_timelineWrapper_42y1q_7";var So={contentWrapper:Ir,timelineWrapper:Or};const Nr=({projects:e})=>{const o=ce();return t("div",{className:M(So.timelineWrapper,"h-full p-6"),children:t(nt,{data:e,weekStartDay:logseq.settings?.weekStartDay||0,theme:o,defaultMode:"advanced",uniqueId:mt()})})},Mr=()=>{const[e]=P(tt),o=e||[];return g("div",{className:"page-container p-8 flex flex-col",children:[t("h1",{className:"title-text",children:"Gantt"}),t("div",{className:M(So.contentWrapper,"shadow rounded-2xl"),children:t(Nr,{projects:o})})]})},Er="_contentWrapper_42y1q_1",qr="_timelineWrapper_42y1q_7";var Ao={contentWrapper:Er,timelineWrapper:qr};const Pr=({projects:e})=>{const o=ce();return t("div",{className:M(Ao.timelineWrapper,"h-full p-6"),children:t(nt,{data:e,weekStartDay:logseq.settings?.weekStartDay||0,theme:o,uniqueId:mt()})})},jr=()=>{const[e]=P(tt),o=e||[];return g("div",{className:"page-container p-8 flex flex-col",children:[t("h1",{className:"title-text",children:"Timeline"}),t("div",{className:M(Ao.contentWrapper,"shadow rounded-2xl"),children:t(Pr,{projects:o})})]})},Q=({value:e,onChange:o,text:a})=>{const[n,r]=v.exports.useState(!1);return g("div",{children:[t("span",{style:{backgroundColor:e},className:"px-2 py-1 rounded cursor-pointer shadow-md",onClick:()=>r(!0),children:a}),n&&g(re,{children:[t("div",{className:"bg-transparent fixed top-0 left-0 w-screen h-screen",onClick:()=>r(!1)}),t("div",{className:"fixed z-10 mt-2",children:t(ta,{color:e,onChange:i=>{const l=i.rgb,d=`rgba(${l.r}, ${l.g}, ${l.b}, ${l.a})`;o?.(d)}})})]})]})},Br=({visible:e,calendarId:o,initialValues:a,onCancel:n,onOk:r,...s})=>{const[i]=f.useForm(),l=()=>{const c=i.getFieldsValue(!0);r?.(c?.query)},d=async c=>{const u=i.getFieldsValue(!0)?.query[c];if(u){console.log(""),ve(`[faiz:] === start exec your query:
`,"blue"),console.log(u?.script);try{let m;u?.queryType==="simple"?m=await logseq.DB.q(u?.script):m=await logseq.DB.datascriptQuery(u.script),ve(`[faiz:] === exec your query success:
`,"green"),console.log(m)}catch(m){ve(`[faiz:] === exec your query failed:
`,"red"),console.error(m)}console.log("")}};return t(se,{...s,width:980,title:"Calendar Queries (saved searches)",visible:e,onCancel:n,onOk:l,children:t("div",{className:"overflow-y-auto overflow-x-hidden",style:{maxHeight:"500px"},children:t(f,{initialValues:{query:a},form:i,size:"small",children:t(f.List,{name:"query",children:(c,{add:u,remove:m})=>g(re,{children:[c.map((h,w)=>g("div",{className:"rounded border-dashed border-gray-200 px-4 pt-4 mb-3 relative",children:[t(f.Item,{label:`Query ${w+1}`,children:g(jt,{gutter:16,children:[t(it,{span:12,children:t(f.Item,{label:"script",name:[h.name,"script"],labelCol:{span:4},children:t(K.TextArea,{rows:10})})}),g(it,{span:12,children:[t(f.Item,{label:"Query Type",name:[h.name,"queryType"],labelCol:{span:7},children:g(W.Group,{children:[t(W,{value:"simple",children:"Simple Query"}),t(W,{value:"advanced",children:"Advanced Query"})]})}),t(f.Item,{label:"Schedule Start",name:[h.name,"scheduleStart"],labelCol:{span:7},children:t(K,{})}),t(f.Item,{label:"Schedule End",name:[h.name,"scheduleEnd"],labelCol:{span:7},children:t(K,{})}),t(f.Item,{label:"Date Formatter",name:[h.name,"dateFormatter"],labelCol:{span:7},children:t(K,{})}),t(f.Item,{label:"Is Milestone",name:[h.name,"isMilestone"],labelCol:{span:7},children:g(W.Group,{children:[t(W,{value:!0,children:"Yes"}),t(W,{value:!1,children:"No"})]})})]})]})}),g("div",{className:"absolute bottom-4 right-4",children:[t(Ie,{title:"Execute this query in DevTools",children:t(oa,{onClick:()=>d(w)})}),w!==0&&t(Ye,{className:"ml-2",onClick:()=>m(h.name)})]})]},w)),t(f.Item,{children:t(U,{type:"dashed",size:"small",onClick:()=>u(),block:!0,icon:t(Oe,{}),children:"Add Schedule Query"})})]})})})})})},Io=({value:e,onChange:o,calendarId:a})=>{const[n,r]=v.exports.useState(!1);return g("div",{children:[t(Ie,{title:"Edit Calendar Queries",children:t(U,{type:"link",icon:t(aa,{}),onClick:()=>r(!0)})}),t(Br,{visible:n,calendarId:a,initialValues:e,onCancel:()=>r(!1),onOk:s=>{o?.(s),r(!1)}})]})},Lr=({visible:e,onCancel:o,onSave:a})=>{const[n]=f.useForm(),r=async s=>await de({originalName:s})?(logseq.UI.showMsg(`The page with the same name already exists
Please add properties to the page manually
agenda:: true`,"error"),{success:!0}):(await logseq.Editor.createPage(s,{agenda:!0}),{success:!0});return t(se,{title:"Create Calendar",visible:e,onOk:()=>{n.validateFields().then(async s=>{const i=s.calendarId.trim();if(s.agenda){const{success:l}=await r(i);if(!l)return}a({name:i,agenda:Boolean(s.agenda)})})},onCancel:o,children:g(f,{form:n,children:[t(f.Item,{name:"calendarId",label:"Calendar ID",rules:[{required:!0}],children:t(K,{})}),t(f.Item,{name:"agenda",label:"Control By Agenda",tooltip:"Checking means that the plugin may modify this document",extra:"Not recommended, please use project instead",children:g(W.Group,{children:[t(W,{value:!0,children:"Yes"}),t(W,{value:!1,children:"No"})]})})]})})},_r=V(j()),Oo=async(e,o)=>{if(!Array.isArray(e))return[];const a=e?.filter(l=>l?.enabled);if(!a?.length)return[];const r=(await Promise.allSettled(a.map(l=>na.get(l.url,{headers:{accept:"text/calendar"}})))).map(async(l,d)=>{if(l.status==="rejected")return logseq.UI.showMsg(`Get Calendar ${a[d].id} data error
${l.reason}`,"error"),[];try{const c=ra.parse(l.value.data),{events:u}=Rr(c),m=u.map(async h=>{const{dtstart:w,dtend:C,summary:S,description:I}=h,x=w.type==="date-time";let q=C?.value||w.value;if(!x){const k=p(q).subtract(1,"day").endOf("day");k.isSameOrAfter(p(w?.value),"day")&&(q=k.format())}return await ht({blockData:{id:new Date().valueOf(),content:`${S?.value||"no summary"}
${I?.value||""}`,subscription:!0},category:x?"time":"allday",start:w.value,end:q,calendarConfig:a[d],defaultDuration:o,isAllDay:!x})});return Promise.all(m)}catch(c){return logseq.UI.showMsg(`Parse Calendar ${a[d].id} data error
${c}`,"error"),console.error("[faiz:] === Parse Calendar error",c),[]}});return(await Promise.allSettled(r)).filter(l=>l?.status==="fulfilled").map(l=>l?.value)?.flat()},Rr=e=>{function o(i){return i.reduce((l,d)=>({...l,[d[0]]:{type:d[2],value:d[3]}}),{})}const[a,n,r]=e,s=r.filter(i=>i[0]==="vevent").map(i=>{const[l,d]=i;return o(d)});return{type:a,info:o(n),events:s}},Yr="_title_8pzto_1",Fr="_content_8pzto_4",Hr="_formBlock_8pzto_8",$r="_show_8pzto_14",Ur="_tabs_8pzto_19",Wr="_tab_8pzto_19",Gr="_active_8pzto_27";var $={title:Yr,content:Fr,formBlock:Hr,show:$r,tabs:Ur,tab:Wr,active:Gr};const zr=({value:e,tabs:o,onChange:a})=>{const n=e;return t("div",{className:$.tabs,children:o.map(({value:r,label:s})=>t("div",{className:M($.tab,{[$.active]:n===r}),onClick:()=>a?.(r),children:s},r))})},Be={4:"A",3:"B",2:"C",1:void 0};let J=null;const At=e=>{if(J&&!e)return J;if(e)return J=new Bt.TodoistApi(e);const{todoist:o}=j();if(o?.token)return J=new Bt.TodoistApi(o.token)},Qr=async()=>{if(ve(`
=== Start synchronizing tasks from todoist ... ===
`,"#d27e24"),!J)return logseq.UI.showMsg("Please check your todoist configuration","error");const e=j(),{preferredDateFormat:o}=await logseq.App.getUserConfigs(),{todoist:a}=e;let n=[];a?.sync===1?(a.project||logseq.UI.showMsg("Missing project, cannot sync using the project sync option","error"),n=await J.getTasks({projectId:a.project})):a?.sync===2&&a.filter?(a.filter||logseq.UI.showMsg("Missing filter, cannot sync using the filter sync option","error"),n=await J.getTasks({filter:a.filter})):n=await J.getTasks();const r=await es();let s=await Promise.all(r?.map(m=>oe(m,e))||[]);s=s.map(Mo),console.info("[faiz: pull totoist] === todoist active tasks:",n),console.info("[faiz: pull totoist] === exists logseq events:",s);let i=[],l=[];n.forEach(m=>{const h=s.find(w=>w.todoistId===m.id);if(!h)return l.push(m);if(ts(h,m))return i.push({...h,todoistTask:m})});const d=s.filter(m=>m.addOns.status!=="done").filter(m=>!n.find(h=>h.id===m?.todoistId)).map(async m=>({...m,todoistTask:await J?.getTask(m?.todoistId)})),u=(await Promise.allSettled(d)).map(m=>m.status==="rejected"?null:m.value).filter(Boolean);i=[...i,...u],l.forEach(m=>os(m,o)),i.forEach(m=>No(m,m.todoistTask)),logseq.UI.showMsg(`Get todoist data successfully:
${l.length} new tasks created
${i.length} tasks updated`),ve(`
=== Synchronizing tasks from todoist success ===
`,"green")},Jr=(e,o)=>J?.updateTask(e,o),Vr=e=>J?.getTask(e),Kr=e=>J?.closeTask(e),Zr=e=>J?.reopenTask(e),Xr=e=>J?.addTask(e),es=async()=>{const e="(and (task todo doing done waiting canceled later now) (property todoist-id))";return logseq.DB.q(e)},ts=(e,o)=>{const a=e.addOns.status==="done",n=e.rawTime?p(e.rawTime?.start).valueOf():void 0,r=e.addOns.contentWithoutTime?.split(`
`)[0],s=e.properties?.todoistDesc||"",i=e.priority,{completed:l,due:d,content:c,priority:u,description:m=""}=o;let h=d?d?.datetime?p(d?.datetime).valueOf():p(d.date).valueOf():void 0;return a!==l||r!==c||s!==m||n!==h||i!==Be[u]},os=async(e,o)=>{const{todoist:a}=j(),n=e.due?.datetime||e.due?.date,{preferredFormat:r}=await logseq.App.getUserConfigs();let s;if(a?.position)s=await logseq.Editor.getPage(a.position);else{const u=X(p().valueOf(),o);s=await logseq.Editor.createPage(u,{},{journal:!0})}let i=e.content;const l=Be[e.priority];if(l&&(i=`[#${l}] ${i}`),i=`TODO ${i}`,n){const u=e.due?.datetime?"YYYY-MM-DD ddd HH:mm":"YYYY-MM-DD ddd";i+=`
SCHEDULED: <${p(n).format(u)}>`}const d=e?.description?.split(`
`)[0]||"",c=Kt(e.id+"",e.url,r);return logseq.Editor.insertBlock(s.originalName,i,{isPageBlock:!0,sibling:!0,properties:d?{"todoist-id":c,"todoist-desc":d}:{"todoist-id":c}})},No=async(e,o)=>{if(!o)return;const{preferredFormat:a}=await logseq.App.getUserConfigs();let n=o.content;const r=Be[o.priority];r&&(n=`[#${r}] ${n}`),n=`${o.completed?"DONE":"TODO"} ${n}`;const s=o.due?.datetime||o.due?.date;if(s){const c=o.due?.datetime?"YYYY-MM-DD ddd HH:mm":"YYYY-MM-DD ddd";n+=`
SCHEDULED: <${p(s).format(c)}>`}const i=o?.description?.split(`
`)[0]||"";await logseq.Editor.updateBlock(e.uuid,n),i&&await logseq.Editor.upsertBlockProperty(e.uuid,"todoist-desc",i),await logseq.Editor.upsertBlockProperty(e.uuid,"todoist-id",Kt(o.id+"",o.url,a));const{content:l,propertiesTextValues:d}=e;if(d){const c=l?.split(`
`)?.filter(Boolean)?.slice(1);Object.keys(d)?.filter(u=>!["todoistId","todoistDesc"].includes(u))?.forEach(u=>{let m=u;c?.find(h=>h?.startsWith(`${u}::`))||(m=u.replace(/([A-Z])/g,"-$1").toLowerCase()),logseq.Editor.upsertBlockProperty(e.uuid,m,d[u])})}},Mo=e=>{let o=e.properties?.todoistId;const a=e.properties?.todoistId,n=e.format==="markdown"?Ua:Wa,r=a?.match?.(n)?.[1];return r&&(o=new URL(r).searchParams.get("id")),{...e,todoistId:Number(o)}},Eo=[{value:"basis",label:"Basis"},{value:"projects",label:"Project"},{value:"customCalendar",label:"Custom Calendar"},{value:"subscription",label:"Subscription"},{value:"calendarView",label:"Calendar View"},{value:"pomodoro",label:"Pomodoro"},{value:"todoist",label:"Todoist"}],as=({...e})=>{const[o]=sa.useForm(),[a,n]=v.exports.useState(Eo[0].value),[r,s]=v.exports.useState([]),[i,l]=v.exports.useState([]),[d,c]=v.exports.useState([]),[u,m]=v.exports.useState(!1),h=j({filterInvalideProject:!1}),[,w]=P(rt),[,C]=P(_r),S=k=>{n(k)},I=({name:k,agenda:D=!1})=>{const b=[...o.getFieldValue("calendarList"),D?fn(k):gn(k)];o.setFieldsValue({calendarList:b}),m(!1),x({calendarList:b},o.getFieldsValue(!0))},x=(k,D)=>{if(k.todoist?.token?.length===40){const b=At(k.todoist?.token);q(b)}C(D),logseq.updateSettings({calendarList:1,subscriptionList:1,projectList:1}),logseq.updateSettings({subscriptionList:[],projectList:[],...D,ignoreTag:D.ignoreTag||null}),typeof k.weekStartDay=="number"&&p.updateLocale("en",{weekStart:k.weekStartDay}),setTimeout(async()=>{if((k?.lightThemeType||k.theme)&&Qt(),k?.calendarList,k?.subscriptionList){const{subscriptionList:b}=await j();w(await Oo(b))}},500)},q=k=>{!k||(k?.getProjects().then(D=>{l(D?.map(b=>({value:b.id,label:b.name})))}),k?.getLabels().then(D=>{c(D?.map(b=>({value:b.id,label:b.name})))}))};return v.exports.useEffect(()=>{logseq.Editor.getAllPages().then(D=>{s(D?.filter(b=>!b?.["journal?"])?.map(b=>({value:b.originalName,label:b.originalName})))});const k=At();q(k)},[]),g("div",{className:"page-container p-8 flex flex-col items-center",children:[t("h1",{className:M($.title,"title-text"),children:"Settings"}),g("div",{className:M($.content,"rounded-2xl flex"),children:[g("div",{className:"flex flex-col justify-between pr-5",children:[t(zr,{value:a,tabs:Eo,onChange:S}),t(la,{title:g("span",{children:["Are you sure you want to restore default settings?",t("br",{}),"This is an irreversible operation."]}),onConfirm:()=>{o.setFieldsValue(Z),x(Z,Z)},children:t(U,{className:"text-left",type:"link",style:{color:"var(--ls-tertiary-background-color)"},children:"Restore Defaults"})})]}),g(f,{initialValues:h,labelCol:{span:4},preserve:!0,form:o,style:{maxWidth:"800px",width:"80%"},onValuesChange:x,className:"relative h-full",children:[g("div",{id:"basis",className:M($.formBlock,{[$.show]:a==="basis"}),children:[t(f.Item,{label:"Theme",name:"theme",children:t(F,{options:Ga})}),t(f.Item,{label:"Light Theme Type",name:"lightThemeType",children:t(F,{options:za})}),t(f.Item,{label:"Home Page",name:"homePage",children:t(F,{options:st})}),t(f.Item,{label:"Ignore Tag",name:"ignoreTag",children:t(F,{showSearch:!0,allowClear:!0,placeholder:"Project ID (Page Name)",optionFilterProp:"label",style:{width:"300px"},options:r,filterOption:(k,D)=>D?.label?.toLowerCase()?.includes(k?.toLowerCase())})}),t(f.Item,{label:"Default Duration",name:["defaultDuration","value"],children:t(ae,{addonAfter:t(f.Item,{name:["defaultDuration","unit"],noStyle:!0,children:t(F,{style:{width:80},options:Ja})})})}),t(f.Item,{label:"Log Key",tooltip:"Interstitial Journal",children:g("div",{className:"flex items-center justify-between",children:[t(f.Item,{noStyle:!0,name:["logKey","id"],rules:[{required:!0}],children:t(F,{style:{width:"240px"},options:r,showSearch:!0,optionFilterProp:"label",filterOption:(k,D)=>D?.label?.toLowerCase()?.includes(k?.toLowerCase())})}),t(f.Item,{name:["logKey","bgColor"],noStyle:!0,rules:[{required:!0}],children:t(Q,{text:"background"})}),t(f.Item,{name:["logKey","textColor"],noStyle:!0,rules:[{required:!0}],children:t(Q,{text:"text"})}),t(f.Item,{name:["logKey","borderColor"],noStyle:!0,rules:[{required:!0}],children:t(Q,{text:"border"})}),t(f.Item,{name:["logKey","enabled"],noStyle:!0,valuePropName:"checked",children:t(Ne,{})})]})}),t(f.Item,{label:"Journal",required:!0,children:g("div",{className:"flex items-center justify-between",children:[t(f.Item,{noStyle:!0,name:["journal","id"],rules:[{required:!0}],children:t(K,{style:{width:"240px"},disabled:!0})}),t(f.Item,{name:["journal","bgColor"],noStyle:!0,rules:[{required:!0}],children:t(Q,{text:"background"})}),t(f.Item,{name:["journal","textColor"],noStyle:!0,rules:[{required:!0}],children:t(Q,{text:"text"})}),t(f.Item,{name:["journal","borderColor"],noStyle:!0,rules:[{required:!0}],children:t(Q,{text:"border"})}),t(f.Item,{name:["journal","query"],rules:[{required:!0}],style:{display:"none"},children:t(Io,{calendarId:"query"})}),t(f.Item,{name:["journal","enabled"],noStyle:!0,valuePropName:"checked",children:t(Ne,{})})]})})]}),t("div",{id:"projects",className:M($.formBlock,{[$.show]:a==="projects"}),children:t(f.List,{name:"projectList",children:(k,{add:D,remove:b,move:y})=>t(re,{children:t(Lt,{onDragEnd:T=>{T?.destination&&y(T.source.index,T.destination.index)},children:t(_t,{droppableId:"droppable-projects",children:(T,O)=>g("div",{ref:T.innerRef,children:[k.map((E,N)=>t(Rt,{draggableId:`drag ${N}`,index:N,children:(B,A)=>t("div",{ref:B.innerRef,...B.draggableProps,...B.dragHandleProps,children:t(f.Item,{children:g("div",{className:"flex items-center justify-between",children:[t(f.Item,{name:[E.name,"id"],noStyle:!0,rules:[{required:!0}],children:t(F,{showSearch:!0,placeholder:"Project ID (Page Name)",optionFilterProp:"label",style:{width:"300px"},options:r,filterOption:(_,z)=>z?.label?.toLowerCase()?.includes(_?.toLowerCase())})}),t(f.Item,{name:[E.name,"bgColor"],noStyle:!0,rules:[{required:!0}],children:t(Q,{text:"background"})}),t(f.Item,{name:[E.name,"textColor"],noStyle:!0,rules:[{required:!0}],children:t(Q,{text:"text"})}),t(f.Item,{name:[E.name,"borderColor"],noStyle:!0,rules:[{required:!0}],children:t(Q,{text:"border"})}),t(f.Item,{name:[E.name,"enabled"],noStyle:!0,valuePropName:"checked",children:t(Ne,{})}),t(Ye,{onClick:()=>b(E.name)})]})})})},N)),t(f.Item,{children:t(U,{type:"dashed",onClick:()=>D(zt),block:!0,icon:t(Oe,{}),children:"Add Project"})})]})})})})})}),g("div",{id:"customCalendar",className:M($.formBlock,{[$.show]:a==="customCalendar"}),children:[t(Fe,{message:"Do not use this setting unless you need to write your own Query to get the calendar.",type:"warning",className:"mb-6"}),t(f.List,{name:"calendarList",children:(k,{add:D,remove:b,move:y})=>t(re,{children:t(Lt,{onDragEnd:T=>{T?.destination?.index===0||T?.source?.index===0||T?.destination&&y(T.source.index,T.destination.index)},children:t(_t,{droppableId:"droppable-1",children:(T,O)=>g("div",{ref:T.innerRef,children:[k.map((E,N)=>t(Rt,{draggableId:`drag ${N}`,index:N,children:(B,A)=>t("div",{ref:B.innerRef,...B.draggableProps,...B.dragHandleProps,children:t(f.Item,{children:g("div",{className:"flex items-center justify-between",children:[t(f.Item,{name:[E.name,"id"],noStyle:!0,rules:[{required:!0}],children:t(K,{placeholder:"Calendar ID",style:{width:"300px"}})}),t(f.Item,{name:[E.name,"bgColor"],noStyle:!0,rules:[{required:!0}],children:t(Q,{text:"background"})}),t(f.Item,{name:[E.name,"textColor"],noStyle:!0,rules:[{required:!0}],children:t(Q,{text:"text"})}),t(f.Item,{name:[E.name,"borderColor"],noStyle:!0,rules:[{required:!0}],children:t(Q,{text:"border"})}),t(f.Item,{name:[E.name,"query"],noStyle:!0,rules:[{required:!0}],children:t(Io,{calendarId:"query"})}),t(f.Item,{name:[E.name,"enabled"],noStyle:!0,valuePropName:"checked",children:t(Ne,{})}),t(Ye,{onClick:()=>b(E.name)})]})})})},N)),t(f.Item,{children:t(U,{type:"dashed",onClick:()=>m(!0),block:!0,icon:t(Oe,{}),children:"Add Custom Calendar"})})]})})})})})]}),t("div",{id:"subscription",className:M($.formBlock,{[$.show]:a==="subscription"}),children:t(f.List,{name:"subscriptionList",children:(k,{add:D,remove:b})=>g(re,{children:[k.map((y,T)=>t(f.Item,{label:T===0?"Subscription":"",...T===0?{}:{wrapperCol:{offset:4}},children:g("div",{className:"flex items-center justify-between",children:[t(f.Item,{name:[y.name,"id"],noStyle:!0,rules:[{required:!0}],children:t(K,{placeholder:"Calendar ID",style:{width:"160px"}})}),t(f.Item,{name:[y.name,"url"],noStyle:!0,rules:[{required:!0}],children:t(K,{placeholder:"Url",style:{width:"100px"}})}),t(f.Item,{name:[y.name,"bgColor"],noStyle:!0,rules:[{required:!0}],children:t(Q,{text:"background"})}),t(f.Item,{name:[y.name,"textColor"],noStyle:!0,rules:[{required:!0}],children:t(Q,{text:"text"})}),t(f.Item,{name:[y.name,"borderColor"],noStyle:!0,rules:[{required:!0}],children:t(Q,{text:"border"})}),t(f.Item,{name:[y.name,"enabled"],noStyle:!0,valuePropName:"checked",children:t(Ne,{})}),t(Ye,{onClick:()=>b(y.name)})]})})),t(f.Item,{wrapperCol:{offset:4},children:t(U,{type:"dashed",onClick:()=>D(),block:!0,icon:t(Oe,{}),children:"Add Subscription"})})]})})}),g("div",{id:"calendar",className:M($.formBlock,{[$.show]:a==="calendarView"}),children:[t(f.Item,{label:"Default View",name:"defaultView",rules:[{required:!0}],children:t(F,{options:$t})}),t(f.Item,{label:"Week Start Day",name:"weekStartDay",rules:[{required:!0}],children:g(F,{children:[t(F.Option,{value:0,children:"Sunday"}),t(F.Option,{value:1,children:"Monday"})]})}),t(f.Item,{label:"Time Grid",children:g("div",{className:"flex items-center",children:[t(f.Item,{noStyle:!0,name:"weekHourStart",children:t(ae,{min:0,max:24})}),t("span",{className:"px-2",children:"-"}),t(f.Item,{noStyle:!0,name:"weekHourEnd",children:t(ae,{min:0,max:24})})]})})]}),g("div",{id:"pomodoro",className:M($.formBlock,{[$.show]:a==="pomodoro"}),children:[t(f.Item,{label:"Pomodoro Length",name:["pomodoro","pomodoro"],rules:[{required:!0}],labelCol:{span:5},children:t(ae,{min:3,precision:0,addonAfter:"min"})}),t(f.Item,{label:"Short Break Length",name:["pomodoro","shortBreak"],rules:[{required:!0}],labelCol:{span:5},children:t(ae,{min:1,precision:0,addonAfter:"min"})}),t(f.Item,{label:"Long Break Length",name:["pomodoro","longBreak"],rules:[{required:!0}],labelCol:{span:5},children:t(ae,{min:1,precision:0,addonAfter:"min"})}),t(f.Item,{label:"Long Break Interval",name:["pomodoro","longBreakInterval"],rules:[{required:!0}],labelCol:{span:5},children:t(ae,{min:1,precision:0})}),[...new Array(5).keys()].map(k=>t(f.Item,{name:["pomodoro","commonPomodoros",k],label:k===0?"Common Pomodoro":"",labelCol:{span:5},...k===0?{}:{wrapperCol:{offset:5}},children:t(ae,{min:1,addonAfter:"min"})}))]}),g("div",{id:"todoist",className:M($.formBlock,{[$.show]:a==="todoist"}),children:[t(Fe,{message:"Restart logseq after modifying the configuration, and the synchronization icon will appear in toolbar.",type:"info",className:"mb-6"}),t(f.Item,{label:"API Token",name:["todoist","token"],labelCol:{span:8},tooltip:t(U,{type:"link",onClick:()=>logseq.App.openExternalLink("https://todoist.com/app/settings/integrations"),children:"Paste your todoist api token here"}),children:t(K,{placeholder:"Please input todoist api token"})}),t(f.Item,{label:"Sync",name:["todoist","sync"],labelCol:{span:8},children:t(F,{placeholder:"Please select",options:[{label:"All Todoist Projects",value:0},{label:"A Specific Todoist Project",value:1},{label:"A Specific Todoist Filter",value:2}]})}),t(f.Item,{noStyle:!0,shouldUpdate:(k,D)=>k.todoist?.sync!==D.todoist?.sync,children:({getFieldValue:k})=>{const D=k(["todoist","sync"]);return t(f.Item,{hidden:D!==2,label:"Todoist filter",name:["todoist","filter"],labelCol:{span:8},tooltip:t(U,{type:"link",onClick:()=>logseq.App.openExternalLink("https://todoist.com/help/articles/205248842"),children:"Define a filter for sync"}),required:D==2,rules:[{required:D==2,message:"Please enter a filter string"}],children:t(K,{placeholder:"Please input a todoist filter string"})})}}),t(f.Item,{noStyle:!0,shouldUpdate:(k,D)=>k.todoist?.sync!==D.todoist?.sync,children:({getFieldValue:k})=>{const D=k(["todoist","sync"]);return t(f.Item,{label:D===0?"Todoist project":"Todoist project for new logseq events",name:["todoist","project"],labelCol:{span:8},children:t(F,{placeholder:"Please select a todoist project",options:i,showSearch:!0,allowClear:!0,filterOption:(b,y)=>y?.label?.toLowerCase()?.includes(b?.toLowerCase())})})}}),t(f.Item,{label:"Todoist label for new logseq events",name:["todoist","label"],labelCol:{span:8},children:t(F,{placeholder:"Please select todoist label",options:d,showSearch:!0,allowClear:!0,filterOption:(k,D)=>D?.label?.toLowerCase()?.includes(k?.toLowerCase())})}),t(f.Item,{label:"Logseq block position",name:["todoist","position"],labelCol:{span:8},children:t(F,{placeholder:"Please select position page",options:r,allowClear:!0,showSearch:!0,optionFilterProp:"label",filterOption:(k,D)=>D?.label?.toLowerCase()?.includes(k?.toLowerCase())})})]})]})]}),t(Lr,{visible:u,onSave:I,onCancel:()=>m(!1)})]})},ns=[{value:"todo",label:"todo"},{value:"doing",label:"doing"},{value:"done",label:"done"},{value:"waiting",label:"waiting"},{value:"canceled",label:"canceled"}],rs=({onSearch:e,initialValues:o})=>{const[a]=f.useForm();j();const[n,r]=v.exports.useState([]),s=()=>{a.validateFields().then(i=>{e(i)})};return v.exports.useEffect(()=>{logseq.Editor.getAllPages().then(i=>{const l=i?.filter(d=>!d?.["journal?"])?.map(d=>({value:d.originalName,label:d.originalName}));r([{value:"journal",label:"Journal"}].concat(l||[]))})},[]),g(f,{form:a,initialValues:o,layout:"inline",className:"mb-6",children:[t(f.Item,{label:"Timeframe",name:"timeframe",children:t(Re.RangePicker,{allowClear:!0,ranges:{Today:[p(),p()],"This Week":[p().weekday(0),p().weekday(6)],"Last Week":[p().weekday(-7),p().weekday(-1)],"This Month":[p().startOf("month"),p().endOf("month")],"Last Month":[p().subtract(1,"month").startOf("month"),p().subtract(1,"month").endOf("month")]}})}),t(f.Item,{label:"Status",name:"status",children:t(F,{options:ns,mode:"multiple",placeholder:"Please select",style:{minWidth:"100px"},allowClear:!0})}),t(f.Item,{label:"Project",name:"project",children:t(F,{showSearch:!0,allowClear:!0,mode:"multiple",placeholder:"Project ID (Page Name)",optionFilterProp:"label",style:{minWidth:"240px"},options:n,filterOption:(i,l)=>l?.label?.toLowerCase()?.includes(i?.toLowerCase())})}),t(f.Item,{children:t(U,{type:"primary",onClick:()=>s(),children:"Review"})})]})},ss=({data:e})=>{const o=v.exports.useRef(),a=ce();return v.exports.useEffect(()=>{const n=document.getElementById("mix-line-bar");async function r(){if(!n||!a)return;const s={tooltip:{trigger:"axis",axisPointer:{type:"cross",crossStyle:{color:"#999"}}},toolbox:{feature:{dataView:{show:!0,readOnly:!0},magicType:{show:!0,type:["line","bar"]},restore:{show:!0},saveAsImage:{show:!0}}},legend:{data:["Evaporation","Precipitation","Temperature"]},xAxis:[{type:"category",data:e.map(l=>{const d=p(l.date).format("DD");return d==="01"?p(l.date).format("MM.DD"):d}),axisPointer:{type:"shadow"}}],yAxis:[{type:"value",name:"Pomodoro Amount",interval:1,axisLabel:{formatter:"{value}"}},{type:"value",name:"Pomodoro Length",interval:20,axisLabel:{formatter:"{value} min"}}],series:[{name:"Pomodoro Amount",type:"bar",tooltip:{valueFormatter:function(l){return l}},data:e.map(l=>l?.pomodoros?.length)},{name:"Interruption Amount",type:"bar",tooltip:{valueFormatter:function(l){return l}},data:e.map(l=>l?.pomodoros?.reduce((d,c)=>d+(c.interruptions?.length||0),0))},{name:"Pomodoro Length",type:"line",yAxisIndex:1,tooltip:{valueFormatter:function(l){return l+" min"}},data:e.map(l=>Math.ceil(l?.pomodoros?.reduce((d,c)=>d+c.length,0)/60))}]},i=a==="dark"?"dark":"light";window.requestAnimationFrame(()=>{const l=_e(n,i);o.current=l,l.setOption(s)})}return r(),()=>{o.current&&o.current.dispose()}},[e,a]),t("div",{id:"mix-line-bar",style:{height:"400px",width:"100%"}})},ls=({data:e})=>{const o=v.exports.useRef(),a=ce();return v.exports.useEffect(()=>{const n=document.getElementById("treemap"),r=ia;async function s(){if(!n||!a)return;const i={title:{text:"Project Time",left:"center"},toolbox:{feature:{dataView:{show:!0,readOnly:!0},saveAsImage:{show:!0}}},tooltip:{formatter:function(d){for(var c=d.value,u=d.treePathInfo,m=[],h=1;h<u.length;h++)m.push(u[h].name);return['<div class="tooltip-title">'+r.encodeHTML(m.join("/"))+"</div>","Pomodoro Length: "+r.addCommas(c)+" min"].join("")}},series:[{name:"Project Time",type:"treemap",visibleMin:300,data:e,label:{show:!0,formatter:"{b}"},upperLabel:{show:!0,height:30},itemStyle:{borderColor:"#fff"},levels:[{itemStyle:{borderColor:"#777",borderWidth:0,gapWidth:1},upperLabel:{show:!1}},{itemStyle:{borderColor:"#555",borderWidth:5,gapWidth:1},emphasis:{itemStyle:{borderColor:"#ddd"}}},{colorSaturation:[.35,.5],itemStyle:{borderWidth:5,gapWidth:1,borderColorSaturation:.6}}]}]},l=a==="dark"?"dark":"light";window.requestAnimationFrame(()=>{const d=_e(n,l);o.current=d,d.setOption(i)})}return s(),()=>{o.current&&o.current.dispose()}},[e,a]),t("div",{id:"treemap",style:{height:"600px",width:"100%"}})},is=(e,o)=>{let a=e;if(o.project?.length){const n=o.project?.some(r=>r==="journal");a=a.filter(r=>n&&r.addOns.isJournal||o.project?.some(s=>s===r.addOns.project))}if(o.status?.length){const n=ge(a);a=o.status.reduce((r,s)=>r.concat(n?.[s]||[]),[])}if(o.timeframe?.length){const[n,r]=o.timeframe;a=a.filter(s=>{if(!s.rawTime)return!1;const i=p(s.addOns.start),l=s.addOns.end?p(s.addOns.end):i;return i.isSameOrBefore(r,"day")&&l.isSameOrAfter(n,"day")})}return a.sort((n,r)=>p(n.addOns.start).diff(p(r.addOns.start)))},ds=(e,o)=>{const a=e.map(c=>c.addOns.pomodoros).filter(Boolean)?.flat(),n=new Map;a?.forEach(c=>{if(!c)return;const u=p(c.start).startOf("day").valueOf();n.has(u)||n.set(u,[]),n.get(u)?.push(c)});const r=Math.min(...Array.from(n.keys())),s=Math.max(...Array.from(n.keys())),[i,l]=o||[p(r),p(s)];return Xa(i,l).map(c=>{const u=c?.startOf("day").valueOf();return{date:u,pomodoros:n.get(u)||[]}})},cs=e=>{const o=new Map;e.forEach(n=>{const r=n.addOns.project;o.has(r)||o.set(r,[]),o.get(r)?.push(n)});let a=[];return o.forEach((n,r)=>{a.push({name:r,value:Math.ceil(n.reduce((s,i)=>s+fo(i),0)/60),children:n.map(s=>({name:s.addOns.showTitle,value:Math.ceil(fo(s)/60)}))})}),a},qo=e=>e.rawTime?p(e.addOns.start).valueOf():0,us=()=>{const[e]=P(fe),[o,a]=v.exports.useState({timeframe:[p().weekday(0),p().weekday(6)]}),n=is(e.tasks.withTime.concat(e.tasks.noTime),o),r=ds(n,o?.timeframe),s=cs(n),i=l=>{a(l)};return t("div",{className:"page-container flex",children:g("div",{className:M("flex flex-1 flex-col overflow-hidden p-8"),children:[t("h1",{className:"title-text",children:"Review"}),g("div",{className:"bg-quaternary flex-1 rounded-2xl box-border p-6 overflow-auto",children:[t(rs,{onSearch:i,initialValues:o}),t(ie,{dataSource:n,title:()=>t("div",{className:"flex justify-end",children:t(U,{size:"small",type:"link",onClick:()=>{Va(n.map(l=>l.addOns.showTitle).join(`
`)),da.success(`\u{1F973} ${n.length} pieces of data have been copied to clipboard!`)},children:"Export"})}),columns:[{title:"Title",dataIndex:["addOns","showTitle"],width:"240px",ellipsis:!0},{title:"Project",dataIndex:["page","original-name"],render:(l,d)=>d.addOns.isJournal?"Journal":l},{title:"Date",dataIndex:["addOns","start"],width:"240px",render:(l,d)=>d.rawTime?`${p(l).format("YYYY-MM-DD")} - ${p(d.addOns.end).format("YYYY-MM-DD")}`:"-",defaultSortOrder:"descend",sorter:(l,d)=>qo(l)-qo(d),filters:[{text:"Scheduled",value:"scheduled"},{text:"No Schedule",value:"noSchedule"}],onFilter:(l,d)=>l==="noSchedule"?!Boolean(d.rawTime):l==="scheduled"?Boolean(d.rawTime):!0},{title:"Status",dataIndex:["addOns","status"]},{title:"Pomodoro Amount",dataIndex:["addOns","pomodoros"],render:l=>l?.length},{title:"Pomodoro Length",dataIndex:["addOns","pomodoros"],render:l=>`${Math.ceil(l?.reduce((d,c)=>d+c.length,0)/60)} min`}]}),t(ss,{data:r}),t(ls,{data:s})]})]})})},ms=()=>{const[e,o]=v.exports.useState([]);return v.exports.useEffect(()=>{on().then(a=>{o(a)})},[]),t("div",{className:"page-container flex",children:g("div",{className:M("flex flex-1 flex-col overflow-hidden p-8"),children:[t("h1",{className:"title-text",children:"Daily Log"}),t("div",{className:"bg-quaternary flex flex-col flex-1 rounded-2xl box-border p-6",children:t(St,{schedules:e,isProjectCalendar:!1,isDailyLogCalendar:!0})})]})})},st=[{label:"Dashboard",value:"dashboard",icon:t(ca,{}),path:"/dashboard",element:t(xr,{})},{label:"Calendar",value:"calendar",icon:t(ua,{}),path:"/calendar",element:t(Ar,{})},{label:"Gantt",value:"gantt",icon:t(ma,{}),path:"/gantt",element:t(Mr,{})},{label:"Timeline",value:"timeline",icon:t(pa,{}),path:"/timeline",element:t(jr,{})},{label:"Daily Log",value:"dailyLogCalendar",icon:t(ha,{}),path:"/dailyLogCalendar",element:t(ms,{})},{label:"Review",value:"review",icon:t(ga,{}),path:"/review",element:t(us,{})},{label:"Settings",value:"settings",icon:t(fa,{}),path:"/settings",element:t(as,{})}],Po=({projectId:e,mode:o,showSidebar:a=!0})=>{const[n]=P(tt),r=n?.find(i=>i.id===e),s=ce();return r?t(nt,{data:[r],weekStartDay:logseq.settings?.weekStartDay||0,theme:s,defaultMode:o,uniqueId:mt(),showSidebar:a}):null},ps="_page_1ia39_1",hs="_border_1ia39_9",gs="_linkText_1ia39_12";var It={page:ps,border:hs,linkText:gs};const fs=({upcomingList:e,waitingList:o,doneList:a,canceledList:n,onSelect:r,value:s})=>{const i=l=>t(Me.Item,{onClick:()=>r(l),className:M("cursor-pointer px-2 rounded",{"bg-quinary":l.id+""===s}),children:g("div",{className:"flex justify-between w-full",children:[t("span",{children:l.addOns.showTitle}),l.rawTime&&t("span",{className:M(It.linkText,"whitespace-nowrap"),children:p(l.addOns.start).format("MM-DD")})]})});return t("div",{className:"w-full h-full",children:g(le,{ghost:!0,defaultActiveKey:["upcoming","waiting"],children:[t(le.Panel,{header:g("span",{children:[t("b",{children:"Upcoming"}),t("span",{className:"ml-2 description-text",children:e.length})]}),children:t(Me,{dataSource:e,renderItem:i})},"upcoming"),t(le.Panel,{header:g("span",{children:[t("b",{children:"Waiting"}),t("span",{className:"ml-2 description-text",children:o.length})]}),children:t(Me,{dataSource:o,renderItem:i})},"upcoming"),t(le.Panel,{header:g("span",{children:[t("b",{children:"Done"}),t("span",{className:"ml-2 description-text",children:a.length})]}),children:t(Me,{dataSource:a,renderItem:i})},"done"),t(le.Panel,{header:g("span",{children:[t("b",{children:"Canceled"}),t("span",{className:"ml-2 description-text",children:n.length})]}),children:t(Me,{dataSource:n,renderItem:i})},"canceled")]})})},ys=({projectId:e})=>{const[o,a]=v.exports.useState(),[n]=P(De),[r]=P(Te),s=e==="Journal"?n:r.get(e),i=ge(s?.tasks?.noTime||[]),l=ge(s?.tasks?.withTime||[]),d=[...l.doing,...l.todo,...i.doing,...i.todo],c=[...l.done,...i.done],u=[...l.canceled,...i.canceled],m=[...l.waiting,...i.waiting],h=async(w,C)=>{logseq.Editor.scrollToBlockInPage(w,C),logseq.hideMainUI()};return g("div",{className:"w-full h-full flex",children:[t("div",{className:M("w-1/2 overflow-auto",It.border),children:t(fs,{waitingList:m,upcomingList:d,doneList:c,canceledList:u,onSelect:a,value:o?.id+""})}),t("div",{className:"w-1/2 overflow-auto",children:o&&g("div",{className:"pl-4",children:[t("h3",{children:o.addOns.showTitle}),t("p",{className:"whitespace-pre-line",children:o.content}),t(U,{type:"link",className:"px-0",onClick:()=>h(o.page.originalName,o.uuid),children:"Navigate To Block"})]})})]})},ws=()=>{const{projectId:e=""}=ya(),o=decodeURIComponent(e),[a]=P(jn),[n]=P(Bn),r=o==="Journal"?a?.schedules:n.find(s=>s?.calendarConfig?.id===o)?.schedules||[];return g("div",{className:M(It.page,"page-container p-8 flex flex-col items-center"),children:[t("h1",{className:"title-text w-full",children:o}),t("div",{className:"rounded-2xl flex w-full h-full p-6 bg-quaternary",children:o&&g(Ee,{className:"w-full",tabPosition:"left",children:[t(Ee.TabPane,{tab:"List",children:t(ys,{projectId:o})},"list"),t(Ee.TabPane,{tab:"Calendar",children:t(St,{schedules:r,isProjectCalendar:!0})},"calendar"),t(Ee.TabPane,{tab:"Gantt",children:t(Po,{projectId:o,mode:"advanced"})},"gantt"),t(Ee.TabPane,{tab:"Timeline",children:t(Po,{projectId:o,mode:"simple",showSidebar:!1})},"timeline")]})})]})},bs=({defaultRoute:e})=>{const[,o]=P(rt),[,a]=P(fe),[,n]=P(De),[,r]=P(Te),{homePage:s=Z.homePage,logKey:i}=j(),l=st.find(c=>c.value===s)?.element,d=i?.enabled?st:st.filter(c=>c.value!=="dailyLogCalendar");return v.exports.useEffect(()=>{async function c(){const u=await vt();if(u){const{fullEvents:h,journalEvents:w,projectEventsMap:C}=u;a(h),n(w),r(C)}const{subscriptionList:m}=j();o(await Oo(m))}c()},[]),t("main",{className:"w-screen h-screen flex",prefix:"custom",children:g(wa,{children:[t(In,{defaultRoute:e,menus:d}),g(ba,{children:[t(dt,{path:"/",element:l}),d.map(c=>t(dt,{path:c.path,element:c.element},c.value)),t(dt,{path:"/project/:projectId",element:t(ws,{})})]})]})})};const ks=({visible:e,uuid:o,onSave:a,onCancel:n})=>{const[r,s]=v.exports.useState(!1),[i]=P(et),l=i.map(h=>({label:h.addOns.showTitle,value:h.uuid})),[d,c]=v.exports.useState([]),u=()=>{l.length===d.length?c([]):c(l.map(h=>h.value))},m=async()=>{let h=[];for(let w=0;w<d.length;w++){const C=await xe({uuid:d[w]});h.push(C)}logseq.Editor.insertBatchBlock(o,h.map(w=>({content:`((${w?.uuid}))`})),{before:!1,sibling:!0}),a()};return v.exports.useEffect(()=>{d?.length>0&&d.length<l.length?s(!0):s(!1)},[d?.length,l?.length]),g(se,{visible:e,title:"Insert Today Task",onCancel:n,onOk:m,children:[t(Fe,{className:"mb-2",message:"It is not recommended to use this feature for the time being, as it may cause some block refs to be lost after reindex, unless you ensure that all embed blocks generate id.",type:"warning"}),t(Fe,{className:"mb-2",message:"You can jump to the corresponding block by clicking the task from the sidebar and then copy the block ref.",type:"warning"}),t(ct.Group,{value:d,onChange:h=>c(h),children:l.map((h,w)=>t(jt,{children:t(it,{span:24,children:t(ct,{value:h.value,children:h.label},h.value)})}))}),t(Pt,{}),t(ct,{indeterminate:r,checked:l.length===d.length,onClick:u,children:"Check All"})]})},vs=({visible:e,onCancel:o,onOk:a,data:n})=>{const[r]=f.useForm();return v.exports.useEffect(()=>{n&&r.setFieldsValue({...n,start:n.start?p(n.start):p(),length:Math.ceil(n.length/60)||1,interruptions:n.interruptions?.map(s=>({...s,time:s.time?p(s.time):p()}))||[]})},[n?.start]),t(se,{title:"Modify Pomodoro",visible:e,onCancel:o,onOk:async()=>{const s=await r.validateFields();a({...s,start:s.start.valueOf(),length:s.length*60,interruptions:s.interruptions?.map(i=>({...i,time:i.time.valueOf()}))})},children:g(f,{form:r,children:[t(f.Item,{name:"isFull",label:"Is Full",rules:[{required:!0}],children:g(W.Group,{children:[t(W,{value:!0,children:"Full Tomato"}),t(W,{value:!1,children:"Half Tomato"})]})}),t(f.Item,{name:"start",label:"Start Time",rules:[{required:!0}],children:t(Re,{showTime:{format:"HH:mm"},format:"YYYY-MM-DD HH:mm"})}),t(f.Item,{name:"length",label:"Length",rules:[{required:!0}],children:t(ae,{min:1,addonAfter:"min"})})]})})},xs=({data:e,onCancel:o,onOk:a,visible:n})=>{const[r,s]=v.exports.useState(e.addOns.pomodoros||[]),[i,l]=v.exports.useState({visible:!1}),d=()=>{const{pomodoro:c}=j();s([...r,{start:p().valueOf(),length:c.pomodoro*60,isFull:!0}])};return v.exports.useEffect(()=>{s(e.addOns.pomodoros||[])},[e.uuid]),g(se,{title:"Pomodoro",okText:"Save",width:"800px",visible:n,onCancel:o,onOk:async()=>{const c=await kt(e.uuid,r,"update");c&&logseq.Editor.updateBlock(e.uuid,c),o()},children:[t(U,{type:"primary",onClick:d,className:"mb-4",icon:t(Oe,{}),children:"Add New Pomodoro"}),t(ie,{pagination:!1,dataSource:r,id:"start",columns:[{title:"Full Tomato",dataIndex:"isFull",render(c,u,m){return c?"\u2705":"\u274C"}},{title:"Length",dataIndex:"length",render:c=>`${Math.ceil(c/60)} min`},{title:"Start",dataIndex:"start",width:"200px",render:c=>p(c).format("YYYY-MM-DD HH:mm")},ie.EXPAND_COLUMN,{title:"Interruption",dataIndex:"interruptions",render:(c,u,m)=>c?.length||0},{title:"Action",dataIndex:"operation",render:(c,u,m)=>t(U,{type:"link",onClick:()=>l({visible:!0,data:u}),children:"Edit"})}],expandable:{rowExpandable:c=>Boolean(c?.interruptions?.length),expandedRowRender:c=>t(ie,{size:"small",dataSource:c.interruptions,pagination:!1,columns:[{title:"Type",dataIndex:"type",render:u=>u===1?t(Yt,{color:"green",children:"Internal"}):t(Yt,{color:"magenta",children:"External"})},{title:"Time",dataIndex:"time",render:u=>p(u).format("YYYY-MM-DD HH:mm")},{title:"Remark",dataIndex:"remark"}]})},summary:c=>c?.length?t(re,{children:g(ie.Summary.Row,{children:[t(ie.Summary.Cell,{index:0,children:"Total"}),g(ie.Summary.Cell,{index:1,colSpan:3,children:[Math.ceil(c.reduce((u,m)=>u+m.length,0)/60)," min"]}),t(ie.Summary.Cell,{index:4,colSpan:2,children:c.reduce((u,m)=>u+(m.interruptions?.length||0),0)})]})}):null}),t(vs,{visible:i.visible,data:i.data,onCancel:()=>l({visible:!1}),onOk:c=>{i?.data?.start&&(s(r.map(u=>u.start===i.data?.start?{...u,...c}:u)),l({visible:!1}))}})]})},Cs=e=>{P(xo);const[,o]=P(fe),[,a]=P(De),[,n]=P(Te),r=e.type,s=()=>{logseq.hideMainUI()},i=()=>{logseq.hideMainUI()};return v.exports.useEffect(()=>{async function l(){const d=await vt();if(d){const{fullEvents:c,journalEvents:u,projectEventsMap:m}=d;o(c),a(u),n(m)}}r==="insertTodaySchedule"&&l()},[r]),g("div",{className:"w-screen h-screen",children:[r==="editSchedule"&&t(To,{visible:!0,showKeepRef:e.showKeepRef,type:e.data.type,initialValues:e.data.initialValues,onSave:s,onCancel:i}),r==="insertTodaySchedule"&&t(ks,{visible:!0,uuid:e.data.uuid,onSave:s,onCancel:i}),r==="pomodoro"&&t(xs,{visible:!0,data:e.data,onOk:s,onCancel:i})]})};function Ds(e,o=!1){const a=e?.addOns.start,n=e?.addOns.end,r=p(a),s=p(n),i=r.isSame(s,"day");return o?e.addOns.allDay?i?{start:r.format("MM-DD")}:{start:r.format("MM-DD"),end:s.format("MM-DD")}:i&&r.isSame(p(),"day")?{start:r.format("HH:mm"),end:s.format("HH:mm")}:i?{start:r.format("MM-DD")}:{start:r.format("MM-DD"),end:s.format("MM-DD")}:i?e.addOns.allDay?{start:"all-day"}:{start:r.format("HH:mm"),end:s.format("HH:mm")}:{start:r.format("MM-DD"),end:s.format("MM-DD")}}const Ot=({task:e,type:o="allDay"})=>{const a=p(e.addOns.start),n=p(e.addOns.end),r=o==="time"&&p().isBetween(a,n),s=e.addOns.status==="done",i=e.addOns.calendarConfig,{start:l,end:d}=Ds(e,o==="overdue");return g("div",{className:"agenda-sidebar-task flex cursor-pointer",style:{margin:"10px 0",opacity:s?.4:.9},onClick:async()=>{const{id:u,originalName:m}=e?.page||{};let h=m;h||(h=(await de({id:u}))?.originalName),logseq.Editor.scrollToBlockInPage(h,e.uuid)},children:[g("div",{className:"flex flex-col justify-between text-right",style:{color:o==="overdue"?"#ed4245":"var(--ls-icon-color)",fontSize:"0.8em",width:"44px"},children:[t("div",{className:"w-full",children:l}),d&&t("div",{className:"w-full",style:{opacity:.6},children:d})]}),t("div",{style:{width:"3px",backgroundColor:i?.bgColor,borderRadius:"2px",margin:"0 6px"}}),g("div",{style:{width:"calc(100% - 90px)",paddingBottom:"24px",position:"relative"},children:[t("div",{style:{color:"var(--ls-icon-color)",fontSize:"0.8em",opacity:.6},children:i?.id}),t("div",{className:"agenda-sidebar-task__title",style:{marginBottom:"-0.2em",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",position:"absolute",bottom:0,width:"calc(100% - 30px)"},title:e.addOns.showTitle,children:e.addOns.showTitle}),r&&t("span",{className:"ui__button bg-indigo-600",style:{fontSize:"0.5em",position:"absolute",right:0,bottom:0,padding:"0 3px",borderRadius:"3px"},children:"NOW"})]})]})};function Ts(e){const o=e.start,a=e.end,n=p(o),r=p(a);return n.isSame(r,"day")?e.isAllDay?{start:"all-day"}:{start:n.format("HH:mm"),end:r.format("HH:mm")}:{start:n.format("MM-DD"),end:r.format("MM-DD")}}const jo=({subscription:e,type:o="allDay"})=>{const a=p(e.start),n=p(e.end),r=o==="time"&&p().isBetween(a,n),{start:s,end:i}=Ts(e);return g("div",{className:"agenda-sidebar-task flex cursor-pointer",style:{margin:"10px 0",opacity:.9},children:[g("div",{className:"flex flex-col justify-between text-right",style:{color:"var(--ls-icon-color)",fontSize:"0.8em",width:"44px"},children:[t("div",{className:"w-full",children:s}),i&&t("div",{className:"w-full",style:{opacity:.6},children:i})]}),t("div",{style:{width:"3px",backgroundColor:e.bgColor,borderRadius:"2px",margin:"0 6px"}}),g("div",{style:{width:"calc(100% - 90px)",paddingBottom:"24px",position:"relative"},children:[t("div",{style:{color:"var(--ls-icon-color)",fontSize:"0.8em",opacity:.6},children:e?.calendarId}),t("div",{className:"agenda-sidebar-task__title",style:{marginBottom:"-0.2em",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",position:"absolute",bottom:0,width:"calc(100% - 30px)"},title:e.title,children:e.title}),r&&t("span",{className:"ui__button bg-indigo-600",style:{fontSize:"0.5em",position:"absolute",right:0,bottom:0,padding:"0 3px",borderRadius:"3px"},children:"NOW"})]})]})},Ss=({containerId:e})=>{P(xo);const[o]=P(Co),{allDaySubscriptions:a,timeSubscriptions:n}=ao(o),[r]=P(et),{overdueTasks:s,allDayTasks:i,timeTasks:l}=oo(r),[,d]=P(fe),[,c]=P(De),[,u]=P(Te);return v.exports.useEffect(()=>{async function m(){const h=await vt();if(h){const{fullEvents:w,journalEvents:C,projectEventsMap:S}=h;d(w),c(C),u(S)}}m(),logseq.DB.onChanged(({blocks:h,txData:w,txMeta:C})=>{w?.some(S=>S?.[1]==="marker")&&parent.document.querySelector("#"+e)&&m()})},[]),g("main",{children:[s?.length===0&&i?.length===0&&l?.length===0&&t("div",{children:"Agenda: No Task Today"}),s.length>0&&t("div",{style:{margin:"8px 0"},children:s.map(m=>t(Ot,{task:m,type:"overdue"},m.id))}),(i.length>0||a.length>0)&&g("div",{children:[a.map(m=>t(jo,{subscription:m,type:"allDay"},m.id)),i.map(m=>t(Ot,{task:m,type:"allDay"},m.id))]}),(l.length>0||n.length>0)&&g("div",{children:[n.map(m=>t(jo,{subscription:m,type:"time"},m.id)),l.map(m=>t(Ot,{task:m,type:"time"},m.id))]})]})},As=({visible:e,pomodoroId:o,uuid:a,onCancel:n,onOk:r})=>{const[s]=f.useForm();return t(se,{title:"Record Inerruption",visible:e,onCancel:n,onOk:async()=>{const i=await s.validateFields(),l=window.interruptionMap.get(o)||[];window.interruptionMap.set(o,l.concat({type:i.type,remark:i.remark,time:p().valueOf()})),n()},children:g(f,{form:s,labelCol:{span:4},children:[t(f.Item,{name:"type",label:"Type",initialValue:1,rules:[{required:!0}],children:t(W.Group,{optionType:"button",buttonStyle:"solid",options:[{label:"Internal",value:1},{label:"External",value:2}]})}),t(f.Item,{name:"remark",label:"Remark",rules:[{required:!0}],children:t(K,{maxLength:50,showCount:!0})})]})})},Le=({label:e,onClick:o,classNames:a=""})=>t("button",{onClick:o,className:`border-transparent font-medium shadow-sm px-3 py-2 text-sm leading-4 rounded-md bg-red-600 hover:bg-red-500 text-white uppercase cursor-pointer ${a}`,children:e}),Is=({label:e,onClick:o,classNames:a=""})=>t("button",{onClick:o,className:`border-transparent bg-transparent font-medium shadow-sm w-12 h-5 text-xs leading-4 rounded-md border border-solid cursor-pointer description-text ${a}`,children:e}),Os=({uuid:e})=>{const o=v.exports.useMemo(()=>{const{pomodoro:y}=j();return{...y,pomodoro:y.pomodoro*60,shortBreak:y.shortBreak*60,longBreak:y.longBreak*60,notificationConfig:{type:"every",time:5}}},[e]),{state:a,start:n,stop:r,reset:s,goPomodoro:i,goShortBreak:l,goLongBreak:d,changeConfig:c}=ka(o),{pomodoro:u}=j(),[m,h]=v.exports.useState(),w=a.type==="pomodoro",C=v.exports.useRef(),[S,I]=v.exports.useState(!1),x=y=>{c({...a.config,pomodoro:y*60})},q=async()=>{if(!m)return;const{id:y,originalName:T}=m?.page||{};let O=T;O||(O=(await de({id:y}))?.originalName),logseq.Editor.scrollToBlockInPage(O,m.uuid)},k=()=>{n();const y=p().valueOf();C.current=y,window.interruptionMap.set(y,[])},D=async()=>{const y=a.config.pomodoro,T=a.timer;s();const O=await kt(e,{isFull:!1,start:C.current,length:y-T,interruptions:window.interruptionMap.get(C.current)||[]});O&&logseq.Editor.updateBlock(e,O)},b=()=>{const{progress:y}=a;return w?y===0?t(Le,{label:"start",onClick:k}):[t(Le,{label:"stop",onClick:s},"stop"),t(Le,{label:"finish",onClick:D,classNames:"ml-2"},"finish")]:y===0?t(Le,{label:"start",onClick:n,classNames:"bg-green-600 hover:bg-green-500"}):t(Le,{label:"skip",onClick:i,classNames:"bg-green-600 hover:bg-green-500"})};return v.exports.useEffect(()=>{logseq.App.registerUIItem("toolbar",{key:"logseq-plugin-agenda-pomodoro",template:po(e,a.formattedTimer,a.progress,a.type!=="pomodoro")}),window.currentPomodoro={uuid:e,state:{paused:a.paused}}},[a.formattedTimer,a.type,a.paused,e]),v.exports.useEffect(()=>{if(!!e){if(!a.paused)return logseq.UI.showMsg("Pomodoro is running, please stop it first.","error");logseq.Editor.getBlock(e).then(async y=>{if(!y)return;const T=await oe(y,j());h(T)})}},[e]),v.exports.useEffect(()=>{w&&a.progress===1&&e&&(kt(e,{isFull:!0,start:C.current,length:a.config.pomodoro,interruptions:window.interruptionMap.get(C.current)||[]}).then(y=>logseq.Editor.updateBlock(e,y)),en("Pomodoro is finished!"))},[w,a.progress,e]),g(re,{children:[t("div",{className:"fixed top-0 left-0 w-screen h-screen",onClick:()=>logseq.hideMainUI()}),g("div",{className:"fixed right-10 shadow-md px-4 py-6 rounded-md bg-quaternary flex",style:{top:"48px",minWidth:"300px"},children:[g("div",{className:"flex-1",children:[g("div",{className:"singlge-line-ellipsis cursor-pointer description-text flex items-center",style:{maxWidth:"220px"},onClick:q,title:m?.addOns.showTitle,children:[m?.addOns.showTitle,t(qt,{})]}),g("div",{children:[t("p",{className:"text-center text-4xl mt-6 mb-6",children:a.formattedTimer}),t("div",{className:"flex flex-row justify-center",children:b()})]})]}),t("div",{className:"flex flex-col w-12 justify-between pt-2",children:u?.commonPomodoros?.map(y=>t(Is,{label:y+"min",onClick:()=>x(y)},y))}),g("div",{className:"absolute right-5 top-1 opacity-60",children:[t(va,{className:"cursor-pointer",onClick:()=>I(!0)}),t(Mt,{className:"ml-2 cursor-pointer",onClick:()=>{logseq.hideMainUI(),window?.unmountPomodoroApp(),window.currentPomodoro={},window.interruptionMap.delete(C.current),logseq.App.registerUIItem("toolbar",{key:"logseq-plugin-agenda-pomodoro",template:'<div class="agenda-toolbar-pompdoro hide"></div>'})}})]})]}),t(As,{pomodoroId:C.current,visible:S,onCancel:()=>I(!1)})]})};p.extend(xa);p.extend(Ca);p.extend(Da);p.extend(Ta);p.extend(Sa);p.extend(Aa);p.extend(Ia);p.extend(Oa);Na([Ma,Ea,qa,Pa,ja,Ba,La,_a,Ra,Ya]);ve("=== logseq-plugin-agenda loaded ==="),logseq.ready(()=>{mn();const{weekStartDay:e,todoist:o}=j();p.updateLocale("en",{weekStart:e}),Qt(),Notification.requestPermission(),logseq.App.getUserConfigs().then(n=>{window.logseqAppUserConfigs=n}),Ka(()=>logseq.hideMainUI()),logseq.App.onThemeModeChanged(({mode:n})=>{ze(n)}),logseq.on("ui:visible:changed",n=>{!n.visible&&window.currentApp!=="pomodoro"&&be.unmountComponentAtNode(document.getElementById("root"))}),logseq.provideModel({show(){Bo(),logseq.showMainUI()},showPomodoro(n){const r=n.dataset.uuid;if(!r)return logseq.UI.showMsg("uuid is required");Lo(r),logseq.showMainUI()},pullTodoistTasks(){Qr()}}),logseq.App.registerUIItem("toolbar",{key:"logseq-plugin-agenda",template:'<a data-on-click="show" class="button"><i class="ti ti-comet"></i></a>'}),o?.token&&(logseq.App.registerUIItem("toolbar",{key:"plugin-agenda-todoist",template:'<a data-on-click="pullTodoistTasks" class="button"><i class="ti ti-chevrons-down"></i></a>'}),At(),logseq.DB.onChanged(({blocks:n,txData:r,txMeta:s})=>{un(async l=>{const d=await logseq.Editor.getBlock(l),c=await oe(d,j()),u=Mo(c)?.todoistId;try{const m=await Vr(u),h=Ft(Be,C=>C===c.priority);let w={content:c.addOns.contentWithoutTime?.split(`
`)?.[0],description:d?.properties?.todoistDesc,priority:h};if(c.addOns.allDay===!0&&(w.dueDate=p(c.addOns.start).format("YYYY-MM-DD")),c.addOns.allDay===!1&&(w.dueDatetime=p.utc(c.addOns.start).format()),c.rawTime||(w.dueString="no due date"),c.addOns.status==="done"&&m?.completed===!1)return Kr(u);if(c.addOns.status!=="done"&&m?.completed===!0)return Zr(u);Jr(u,w)}catch(m){if(m.httpStatusCode===404)return logseq.UI.showMsg(`Sync Error
message: ${m?.responseData}
Please check whether the task has been deleted or whether the todoist-id is correct`,"error")}})?.({blocks:n,txData:r,txMeta:s})}),logseq.Editor.registerBlockContextMenuItem("Agenda: Upload to todoist",async({uuid:n})=>{const r=j(),{todoist:s}=r,i=await logseq.Editor.getBlock(n);if(!i?.marker)return logseq.UI.showMsg("This block is not a task","error");if(i?.properties?.todoistId)return logseq.UI.showMsg(`This task has already been uploaded,
please do not upload it again`,"error");const l=await oe(i,r),d=Ft(Be,u=>u===l.priority);let c={content:l.addOns.contentWithoutTime?.split(`
`)?.[0],description:i?.properties?.todoistDesc,priority:d};l.addOns.allDay===!0&&(c.dueDate=p(l.addOns.start).format("YYYY-MM-DD")),l.addOns.allDay===!1&&(c.dueDatetime=p.utc(l.addOns.start).format()),s?.project&&(c.projectId=s.project),s?.label&&(c.labelIds=[s.label]),Xr(c)?.then(async u=>(await No(l,u),logseq.UI.showMsg("Upload task to todoist success"))).catch(u=>{logseq.UI.showMsg("Upload task to todoist failed","error"),console.error("[faiz:] === Upload task to todoist failed",u)})})),logseq.App.registerCommandPalette({key:"logseq-plugin-agenda:show",label:"Show Agenda",keybinding:{binding:"ctrl+shift+a"}},n=>{Bo(),logseq.showMainUI()}),window.unmountPomodoroApp=()=>be.unmountComponentAtNode(document.getElementById("pomodoro-root")),window.interruptionMap=new Map;const a=async n=>{let r=await logseq.Editor.getBlock(n.uuid);const s=await Promise.all(r.refs?.map(l=>logseq.Editor.getPage(l.id)));r.refs=s;const i=await oe(r,j());lt({type:"editSchedule",data:{type:"update",initialValues:{id:i.uuid,start:p(i.addOns.start),end:p(i.addOns.end),isAllDay:i.addOns.allDay,calendarId:i.addOns.calendarConfig?.id,title:i.addOns.showTitle,raw:i}},showKeepRef:!0}),logseq.showMainUI()};logseq.App.registerPageMenuItem("Agenda: Add this page to agenda project",async({page:n})=>{const r=await logseq.Editor.getPage(n);if(!r)return logseq.UI.showMsg("Page not found","error");const s=logseq.settings?.projectList||[],i=r.originalName;if(s.find(d=>d.id===i))return logseq.UI.showMsg("This Page is already in agenda project","warning");const l={...zt,id:i};logseq.updateSettings({projectList:1}),logseq.updateSettings({...logseq.settings,projectList:s.concat(l)}),logseq.UI.showMsg("Successfully added")}),logseq.Editor.registerBlockContextMenuItem("Agenda: Modify Schedule",a),logseq.Editor.registerBlockContextMenuItem("Agenda: Start Pomodoro Timer",async({uuid:n})=>{if(logseq.App.registerUIItem("toolbar",{key:"logseq-plugin-agenda-pomodoro",template:po(n,"--:--",0)}),window?.currentPomodoro?.uuid!==n&&window?.currentPomodoro?.state?.paused===!1)return logseq.UI.showMsg("Another block is running pomodoro timer, please finish it first","error");setTimeout(()=>{Lo(n),logseq.showMainUI()},0)}),logseq.Editor.registerSlashCommand("Agenda: Modify Schedule",a),logseq.Editor.registerSlashCommand("Agenda: Insert Today's Task",n=>(lt({type:"insertTodaySchedule",data:{uuid:n.uuid}}),logseq.showMainUI(),Promise.resolve())),logseq.Editor.registerSlashCommand("Agenda: Insert Task List",async()=>{logseq.Editor.insertAtEditingCursor("{{renderer agenda, task-list}}")}),logseq.App.onMacroRendererSlotted(async({slot:n,payload:{arguments:r,uuid:s}})=>{if(r?.[0]==="agenda"){if(r?.[1]==="task-list"){if(parent.document.getElementById(n)?.childElementCount)return;const l=`agenda-task-list-${n}`;logseq.provideUI({key:`agenda-${n}`,slot:n,reset:!0,template:`<div id="${l}"></div>`}),logseq.provideStyle(`${mo}
          #block-content-${s} .lsp-hook-ui-slot {
            width: 100%;
          }
          #block-content-${s} .lsp-hook-ui-slot > div {
            width: 100%;
          }
          #block-content-${s} .lsp-hook-ui-slot > div > div {
            width: 100%;
          }
        `),setTimeout(()=>{be.render(t(He.StrictMode,{children:t(Ss,{containerId:l})}),parent.document.getElementById(l))},0)}else if(r?.[1]==="pomodoro-timer"){const i=`agenda-pomodoro-timer-${n}`;logseq.provideUI({key:`agenda-${n}`,slot:n,reset:!0,template:`<div id="${i}"></div>`})}}}),logseq.setMainUIInlineStyle({zIndex:1e3}),logseq.provideStyle(mo),top&&top.document.addEventListener("click",async n=>{const r=n.composedPath(),s=r[0];if(s.tagName==="A"&&s.className.includes("external-link")&&s.getAttribute("href")?.startsWith("#agenda")){let i="agenda";s.getAttribute("href")?.startsWith("#agenda-pomo://")&&(i="pomodoro");const l=cn(r);if(!l)return;const d=await logseq.Editor.getBlock(l),c=await logseq.Editor.getPage(d.page?.id),u=await oe(d,j());i==="agenda"?lt({type:"editSchedule",data:{type:"update",initialValues:{id:l,title:u.addOns.showTitle,calendarId:c?.originalName,keepRef:!1,start:p(u.addOns.start),end:p(u.addOns.end),isAllDay:u.addOns.allDay,raw:u}}}):i==="pomodoro"&&lt({type:"pomodoro",data:u}),logseq.showMainUI()}})});async function Bo(){window.currentApp="app",bt(!1),ut(!1);let e="";const o=await logseq.Editor.getCurrentPage(),{projectList:a=[]}=j();a.some(n=>Boolean(n.id)&&n.id===o?.originalName)&&(e=`project/${encodeURIComponent(o?.originalName)}`),be.render(t(He.StrictMode,{children:t(bs,{defaultRoute:e})}),document.getElementById("root"))}function lt(e){window.currentApp="modal",bt(!1);const{type:o,data:a}=e;ut(!0),be.render(t(He.StrictMode,{children:t(Cs,{type:o,data:a,showKeepRef:e.showKeepRef})}),document.getElementById("root"))}function Lo(e){window.currentApp="pomodoro",bt(!0),ut(!0),be.render(t(He.StrictMode,{children:t(Os,{uuid:e})}),document.getElementById("pomodoro-root"))}
