import{d as p,l as he,f as ne,p as te,e as _o,r as x,j as g,a as t,u as Mt,F as It,i as _e,L as Ro,b as X,c as J,P as Et,g as re,I as qt,h as Pt,k as N,B as U,S as H,m as E,A as Yo,n as Ho,R as jt,o as f,M as se,q as V,D as Re,s as W,C as le,t as Fo,T as Oe,v as Bt,w as $o,x as Uo,y as Wo,z as Go,E as zo,G as Qo,H as Jo,J as Lt,K as it,N as Vo,O as Ye,Q as Ne,U as Ko,V as Zo,W as Xo,X as _t,Y as ea,Z as ta,_ as ae,$ as Me,a0 as Rt,a1 as Yt,a2 as Ht,a3 as He,a4 as oa,a5 as ie,a6 as aa,a7 as na,a8 as ra,a9 as sa,aa as la,ab as ia,ac as da,ad as ca,ae as Ie,af as ua,ag as Ee,ah as ma,ai as pa,aj as dt,ak as ct,al as Ft,am as ha,an as ga,ao as fa,ap as ya,aq as wa,ar as ba,as as ka,at as va,au as xa,av as Ca,aw as Da,ax as be,ay as $t,az as Fe,aA as Ta,aB as Aa,aC as Sa,aD as Oa,aE as Na,aF as Ma,aG as Ia,aH as Ea,aI as qa,aJ as Pa}from"./vendor.e0599e92.js";const ja=function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function a(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerpolicy&&(s.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?s.credentials="include":r.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=a(r);fetch(r.href,s)}};ja();const qe="yyyy-MM-dd",Ba="yyyy-MM-dd EEE",La="Daily Log",ke=/^((?:[0-9]|0[0-9]|1[0-9]|2[0-3]):[0-5][0-9])(-(?:[0-9]|0[0-9]|1[0-9]|2[0-3]):[0-5][0-9])*/,$e=/>\[[\d -:]+\]\(#(agenda:\/\/[^\n\r ]+)\)/,Ue=/>\[\[#(agenda:\/\/[^\n\r ]+)\]\[[\d -:]+\]\]/,We=/>\[[🍅 0-9min]+\]\(#(agenda-pomo:\/\/[^\n\r ]+)\)/,Ge=/>\[\[#(agenda-pomo:\/\/[^\n\r ]+)\]\[[🍅 0-9min]+\]\]/,Ut=[{value:"day",label:"Daily"},{value:"week",label:"Weekly"},{value:"2week",label:"2 Weeks"},{value:"month",label:"Monthly"}],_a=[{value:"light",label:"Light"},{value:"dark",label:"Dark"},{value:"auto",label:"Auto"}],Ra=[{value:"green",label:"Green"},{value:"purple",label:"Purple"}],K={theme:"auto",lightThemeType:"green",homePage:"dashboard",defaultView:"month",weekStartDay:0,weekHourStart:0,weekHourEnd:24,defaultDuration:{value:.5,unit:"h"},logKey:{id:La,bgColor:"#047857",textColor:"#fff",borderColor:"#047857",enabled:!0},journal:{id:"Journal",bgColor:"#047857",textColor:"#fff",borderColor:"#047857",enabled:!0,query:[{script:`
[:find (pull ?block [*])
:where
[?block :block/marker ?marker]
[(missing? $ ?block :block/deadline)]
(not [(missing? $ ?block :block/scheduled)])
[(contains? #{"TODO" "DOING" "NOW" "LATER" "WAITING" "DONE"} ?marker)]]
        `,scheduleStart:"scheduled",dateFormatter:"yyyyMMdd",queryType:"advanced",isMilestone:!1},{script:`
[:find (pull ?block [*])
:where
[?block :block/marker ?marker]
[(missing? $ ?block :block/scheduled)]
(not [(missing? $ ?block :block/deadline)])
[(contains? #{"TODO" "DOING" "NOW" "LATER" "WAITING" "DONE"} ?marker)]]
        `,scheduleStart:"deadline",dateFormatter:"yyyyMMdd",queryType:"advanced",isMilestone:!1},{script:`
[:find (pull
?block
[:block/uuid
  :db/id
  :block/parent
  :block/left
  :block/collapsed?
  :block/format
  :block/_refs
  :block/path-refs
  :block/tags
  :block/content
  :block/marker
  :block/priority
  :block/properties
  :block/pre-block?
  :block/scheduled
  :block/deadline
  :block/repeated?
  :block/created-at
  :block/updated-at
  :block/file
  :block/heading-level
  {:block/page
  [:db/id :block/name :block/original-name :block/journal-day :block/journal?]}])
:where
[?block :block/page ?page]
[?page :block/journal? true]
[?block :block/marker ?marker]
[(contains? #{"TODO" "DOING" "NOW" "LATER" "WAITING" "DONE"} ?marker)]
[(missing? $ ?block :block/scheduled)]
[(missing? $ ?block :block/deadline)]]
        `,scheduleStart:"page.journal-day",dateFormatter:"yyyyMMdd",isMilestone:!1,queryType:"advanced"},{script:`
[:find (pull
  ?block
  [:block/uuid
    :block/parent
    :db/id
    :block/left
    :block/collapsed?
    :block/format
    :block/_refs
    :block/path-refs
    :block/tags
    :block/content
    :block/marker
    :block/priority
    :block/properties
    :block/pre-block?
    :block/scheduled
    :block/deadline
    :block/repeated?
    :block/created-at
    :block/updated-at
    :block/file
    :block/heading-level
    {:block/page
      [:db/id :block/name :block/original-name :block/journal-day :block/journal?]}
    {:block/refs
      [:block/journal-day]}])
  :where
  [?block :block/marker ?marker]
  [?rp :block/journal? true]
  [?block :block/refs ?rp]
  [(contains? #{"TODO" "DOING" "NOW" "LATER" "WAITING" "DONE"} ?marker)]]
        `,scheduleStart:"refs[0].journal-day",dateFormatter:"yyyyMMdd",isMilestone:!1,queryType:"advanced"},{script:`
[:find (pull ?block [*])
:where
[?rp :block/name "milestone"]
[?block :block/scheduled]
[?block :block/refs ?rp]]
        `,scheduleStart:"scheduled",dateFormatter:"yyyyMMdd",isMilestone:!0,queryType:"advanced"}]},projectList:[],calendarList:[],subscriptionList:[],pomodoro:{pomodoro:25,shortBreak:5,longBreak:15,autoStartBreaks:!1,autoStartPomodoros:!1,longBreakInterval:4,commonPomodoros:[10,15,20,25,40]}},Ya={light:{"month.holidayExceptThisMonth.color":"#f3acac","month.dayExceptThisMonth.color":"#bbb","month.weekend.backgroundColor":"#fafafa","month.day.fontSize":"16px","week.daygrid.borderRight":"1px solid #ddd","week.daygrid.backgroundColor":"inherit","week.daygridLeft.width":"77px","week.daygridLeft.backgroundColor":"#a8def74d","week.daygridLeft.paddingRight":"5px","week.daygridLeft.borderRight":"1px solid #ddd","week.today.backgroundColor":"#b857d81f","week.weekend.backgroundColor":"#fafafa","week.timegridLeft.width":"77px","week.timegridLeft.backgroundColor":"#03a9f44d","week.timegridLeft.borderRight":"1px solid #ddd","week.timegridLeft.fontSize":"12px","week.timegridLeftTimezoneLabel.height":"51px","week.timegridLeftAdditionalTimezone.backgroundColor":"#fdfdfd","week.timegridOneHour.height":"48px","week.timegridHalfHour.height":"24px","week.timegridHalfHour.borderBottom":"1px dotted #f9f9f9","week.timegridHorizontalLine.borderBottom":"1px solid #eee","week.timegrid.paddingRight":"10px","week.timegrid.borderRight":"1px solid #ddd","week.timegridSchedule.borderRadius":"0","week.timegridSchedule.paddingLeft":"0","week.currentTime.color":"#135de6","week.currentTime.fontSize":"12px","week.currentTime.fontWeight":"bold","week.pastTime.color":"#808080","week.pastTime.fontWeight":"normal","week.futureTime.color":"#333","week.futureTime.fontWeight":"normal","week.currentTimeLinePast.border":"1px solid rgba(19, 93, 230, 0.3)","week.currentTimeLineBullet.backgroundColor":"#135de6","week.currentTimeLineToday.border":"1px solid #135de6","week.currentTimeLineFuture.border":"1px solid #135de6"},dark:{"common.backgroundColor":"#32373d","common.saturday.color":"#babec4","common.dayname.color":"#babec4","common.border":"1px solid #58595c","common.creationGuide.backgroundColor":"#32373d","month.dayname.borderLeft":"1px solid #58595c","month.holidayExceptThisMonth.color":"#f3acac","month.dayExceptThisMonth.color":"#bbb","month.weekend.backgroundColor":"#282c31","month.day.fontSize":"16px","week.vpanelSplitter.border":"1px solid #58595c","week.today.color":"#fff","week.pastDay.color":"#8f9296","week.dayname.borderTop":"1px solid #58595c","week.dayname.borderBottom":"1px solid #58595c","week.daygrid.borderRight":"1px solid #58595c","week.daygrid.backgroundColor":"inherit","week.daygridLeft.width":"77px","week.daygridLeft.backgroundColor":"rgba(252, 183, 20, 0.3)","week.daygridLeft.paddingRight":"5px","week.daygridLeft.borderRight":"1px solid #58595c","week.today.backgroundColor":"#b857d81f","week.weekend.backgroundColor":"#282c31","week.timegridLeft.width":"77px","week.timegridLeft.backgroundColor":"rgba(252, 183, 20, 0.4)","week.timegridLeft.borderRight":"1px solid #58595c","week.timegridLeft.fontSize":"12px","week.timegridLeftTimezoneLabel.height":"51px","week.timegridLeftAdditionalTimezone.backgroundColor":"#fdfdfd","week.timegridOneHour.height":"48px","week.timegridHalfHour.height":"24px","week.timegridHalfHour.borderBottom":"1px dotted #3d3e40","week.timegridHorizontalLine.borderBottom":"1px solid #58595c","week.timegrid.paddingRight":"10px","week.timegrid.borderRight":"1px solid #58595c","week.timegridSchedule.borderRadius":"0","week.timegridSchedule.paddingLeft":"0","week.currentTime.color":"#fcb714","week.currentTime.fontSize":"12px","week.currentTime.fontWeight":"bold","week.pastTime.color":"#bababd","week.pastTime.fontWeight":"normal","week.futureTime.color":"#dadade","week.futureTime.fontWeight":"normal","week.currentTimeLinePast.border":"1px solid rgba(252, 183, 20, 0.4)","week.currentTimeLineBullet.backgroundColor":"#fcb714","week.currentTimeLineToday.border":"1px solid #fcb714","week.currentTimeLineFuture.border":"1px solid #fcb714"}},Wt="yyyyMMdd",Ha=[{value:"m",label:"minute"},{value:"h",label:"hour"}],Gt="Agenda",zt="|`~|",Qt={id:void 0,bgColor:"#b8e986",textColor:"#4a4a4a",borderColor:"#047857",enabled:!0},ve=(e,o="blue")=>console.log(`%c${e}`,`color:${o}`),ze=e=>{const o=document.querySelector("html"),a=logseq.settings?.lightThemeType||K.lightThemeType,n=a==="green"?"purple":"green";e==="dark"?(o?.classList.add("dark"),o?.classList.remove(a),Vt("./antd.dark.min.css")):(o?.classList.remove("dark",n),o?.classList.add(a),Vt("./antd.min.css"))},Jt=async()=>{const{theme:e}=logseq.settings;if(e==="dark")return ze("dark");if(e==="light")return ze("light");const o=await logseq.App.getStateFromStore("ui/theme");ze(o)},Fa=e=>{const o=document.createElement("textarea");o.value=e,document.body.appendChild(o),o.select(),document.execCommand("copy"),document.body.removeChild(o)},$a=e=>{document.addEventListener("keyup",o=>{o.key==="Escape"&&e()})},Ua=()=>{const e=navigator.userAgent,o=e.indexOf("Windows")>-1,a=e.indexOf("Macintosh")>-1,n=e.indexOf("Linux")>-1;return o?"windows":a?"mac":n?"linux":"unknown"},Vt=e=>{const o=document.createElement("link");o.rel="stylesheet",o.href=e,o.className="antd-css";const a=document.head||document.getElementsByTagName("head")[0],n=a.childNodes[0];n?a.insertBefore(o,n):a.appendChild(o);const r=a.querySelectorAll(".antd-css");Array.from(r)?.slice(1)?.forEach(s=>{a.removeChild(s)})},ut=e=>{const o=document.querySelector("html"),a=document.querySelector("body");e?(o?.classList.add("modal-app"),a?.classList.add("modal-app")):(o?.classList.remove("modal-app"),a?.classList.remove("modal-app"))},Wa=(e,o)=>{const a=[];let n=e;for(;n.isSameOrBefore(o);)a.push(n.clone()),n=n.add(1,"day");return a},mt=(e=6)=>{const o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let a="";for(let n=0;n<e;n++)a+=o.charAt(Math.floor(Math.random()*o.length));return a},Kt=e=>{const o=new URL(e).searchParams;let a={};return o.forEach((n,r)=>a[r]=n),a},Ga=e=>{const o=new Notification(e);o.onclick=()=>{o.close()}},za=async()=>{let e=[];const o=j(),{calendarList:a=[]}=o,n=a.filter(d=>d?.enabled);let r=[];r=n.map(d=>d?.query?.filter(c=>c?.script?.length)?.map(c=>({calendarConfig:d,query:c}))).filter(Boolean).flat();const s=r.map(async d=>{const{query:c}=d,{script:m="",queryType:u}=c;let h=[];u==="simple"?h=await logseq.DB.q(m)||[]:h=await logseq.DB.datascriptQuery(m);const w=he.exports.flattenDeep(h).map(D=>Ja({block:D,queryWithCalendar:d,settings:o}));return Promise.all(w)}),i=await Promise.allSettled(s),l=[];return i.forEach((d,c)=>{if(d.status==="fulfilled")l.push(d.value);else{console.error("[faiz:] === scheduleRes error: ",r[c],d);const{calendarConfig:m,query:u}=r[c],h=`Query Exec Error:
calendar: ${m.id}
query: ${u.script}
message: ${d.reason.message}`;logseq.App.showMsg(h,"error")}}),e=he.exports.flattenDeep(e.concat(l)),e},Qa=async()=>{const{logKey:e,defaultDuration:o}=j();if(!e?.enabled)return[];const r=((await logseq.DB.q(`[[${e.id}]]`))?.filter(i=>i?.marker||!i?.page?.journalDay?!1:ke.test(i?.content))||[])?.map(async i=>{const l=i?.page?.journalDay,{start:d,end:c}=pt(i?.content.replace(new RegExp(`^${i.marker} `),"")),m=d||c;if(!!m)return await ht({blockData:i,category:m?"time":"allday",start:d?ne(te(l+" "+d,"yyyyMMdd HH:mm",new Date)):Qe(l),end:c?ne(te(l+" "+c,"yyyyMMdd HH:mm",new Date)):void 0,calendarConfig:e,defaultDuration:o,isAllDay:!m,isReadOnly:!0})});return(await Promise.all(r)).filter(Boolean)},Ja=async({block:e,queryWithCalendar:o,settings:a})=>{const{calendarConfig:n,query:r}=o,{script:s="",scheduleStart:i="",scheduleEnd:l="",dateFormatter:d,isMilestone:c,queryType:m}=r,{defaultDuration:u}=a,h=["scheduled","deadline"].includes(i||l)?Wt:d||Ba,w=he.exports.get(e,i,void 0),D=he.exports.get(e,l,void 0);let A=/[Hhm]+/.test(h||""),q,C;try{q=w&&Qe(w,h),C=D&&(A?Qe(D,h):ne(_o(te(D,h,new Date))))}catch(k){return console.warn("[faiz:] === parse calendar date error: ",k,e,r),[]}if(e?.page?.["journal-day"]){const{start:k,end:S}=pt(e?.content.replace(new RegExp(`^${e.marker} `),""));if(k||S){const L=e?.page?.["journal-day"];q=k?ne(te(L+" "+k,"yyyyMMdd HH:mm",new Date)):Qe(L),C=S?ne(te(L+" "+S,"yyyyMMdd HH:mm",new Date)):void 0,A=!0}}if(w&&["scheduled","deadline"].includes(i)){const k=e.content?.split(`
`)?.find(L=>L.startsWith(`${i.toUpperCase()}:`))?.trim(),S=/ (\d{2}:\d{2})[ >]/.exec(k)?.[1]||"";S&&(q=ne(te(`${w} ${S}`,"yyyyMMdd HH:mm",new Date)),A=!0)}if(D&&["scheduled","deadline"].includes(l)){const k=e.content?.split(`
`)?.find(L=>L.startsWith(`${l.toUpperCase()}:`))?.trim(),S=/ (\d{2}:\d{2})[ >]/.exec(k)?.[1]||"";S&&(C=ne(te(`${D} ${S}`,"yyyyMMdd HH:mm",new Date)),A=!0)}let v=A?"time":"allday";c&&(v="milestone");const y=v,b=Zt(e,C||q,!A);return!c&&b&&(v="task"),await ht({blockData:{...e,category:y,type:"project",rawStart:q,rawEnd:C,rawAllDay:!A,rawOverdue:b},category:v,start:q,end:C,calendarConfig:n,defaultDuration:u,isAllDay:!c&&!A&&!b,isReadOnly:!0})},Zt=(e,o,a)=>e.marker&&e.marker!=="DONE"&&e.marker!=="CANCELED"&&e.marker!=="WAITING"?a?p().isAfter(p(o),"day"):p().isAfter(p(o),"minute"):!1,pt=e=>{const o=e.match(ke);return o?{start:o[1],end:o[2]?.slice(1)}:{start:void 0,end:void 0}},Va=(e,o,a)=>{const n=`${o}${a?"-"+a:""}`;return e.match(ke)?e.replace(ke,n):n+" "+e},Xt=e=>e.replace(ke,""),eo=async e=>{const o=/\(\([0-9a-z\-]{30,}\)\)/;if(o.test(e)){const a=o.exec(e)?.[0]?.replace("((","")?.replace("))","");if(a){const n=await xe({uuid:a},!0);return e.replace(o,n?.content||"")}}return e};async function ht(e){const{id:o,blockData:a,category:n="time",start:r,end:s,calendarConfig:i,isAllDay:l,defaultDuration:d,isReadOnly:c}=e,m=typeof a?.uuid=="string"?a?.uuid:a?.uuid?.$uuid$;if(!a?.id){const y=await xe({uuid:m},!0);y&&(a.id=y.id)}let u=a?.page;he.exports.has(u,"id")&&he.exports.has(u,"name")&&he.exports.has(u,"original-name")&&(u={id:u.id,journalDay:u["journal-day"],journal:u["journal?"],name:u.name,originalName:u["original-name"]}),a.page=u,a.fullContent=await eo(a.content);const h=window.logseqAppUserConfigs?.preferredFormat==="org"?Ue:$e,w=a.fullContent.split(`
`)[0]?.replace(new RegExp(`^${a.marker} `),"")?.replace(ke,"")?.replace(h,"")?.replace(" #milestone","")?.trim?.(),D=a.marker==="DONE";function A(){return!!(a.page?.properties?.agenda===!0||a?.page?.["journal-day"]&&!a?.scheduled&&!a?.deadline)}const q=c===void 0?A():!c,C=d||j()?.defaultDuration;let v=s;return(n==="time"||a?.category==="time")&&!s&&r&&C&&(v=p(r).add(C.value,C.unit).format()),a?.category!=="time"&&!s&&(v=r),a.uuid=m,{id:o||m,calendarId:i.id,title:w,body:a.fullContent,category:n,dueDateClass:"",start:r,end:v,raw:a,color:i?.textColor,bgColor:i?.bgColor,borderColor:i?.borderColor,isAllDay:l,customStyle:D?"opacity: 0.6;":"",isReadOnly:!q}}const Qe=(e,o=Wt)=>ne(te(""+e,o,new Date)),ge=(e=[])=>({waiting:e.filter(o=>o?.addOns?.status==="waiting"),todo:e.filter(o=>o?.addOns?.status==="todo"),doing:e.filter(o=>o?.addOns?.status==="doing"),done:e.filter(o=>o?.addOns?.status==="done"),canceled:e.filter(o=>o?.addOns?.status==="canceled")}),Ka=e=>{const o=new Map;return e.forEach(a=>{const n=p(a.addOns.start).startOf("day").format();o.has(n)||o.set(n,[]),o.get(n)?.push(a)}),o},Za=({start:e,end:o,allDay:a})=>{const n=new URL("agenda://");n.searchParams.append("start",""+e.valueOf()),n.searchParams.append("end",""+o.valueOf()),a===!1&&n.searchParams.append("allDay","false");const r=a?e.format("YYYY-MM-DD"):e.format("YYYY-MM-DD HH:mm");let s=a?o.format("YYYY-MM-DD"):o.format("YYYY-MM-DD HH:mm");const i=e.isSame(o,"day");i&&a&&(s=""),i&&!a&&(s=o.format("HH:mm"));const l=r+(s?` - ${s}`:"");return window.logseqAppUserConfigs?.preferredFormat==="org"?`>[[#${n.toString()}][${l}]]`:`>[${l}](#${n.toString()})`},Xa=e=>{const o=window.logseqAppUserConfigs?.preferredFormat==="org"?Ue:$e,a=e.match(o);return!a||!a?.[1]?null:Kt(a[1])},to=e=>{const o=window.logseqAppUserConfigs?.preferredFormat==="org"?Ue:$e;return e.replace(o,"")},gt=(e,o)=>{const a=window.logseqAppUserConfigs?.preferredFormat==="org"?Ue:$e,n=Za(o),r=Xt(e)?.trim();return a.test(r)?r.replace(a,n):r?.split(`
`).map((s,i)=>i===0?s+" "+n:s).join(`
`)};function oo(e){let o=[],a=[],n=[];return e.forEach(r=>{r.addOns.isOverdue?o.push(r):r.addOns.allDay?a.push(r):n.push(r)}),{overdueTasks:o,allDayTasks:a,timeTasks:n}}function ao(e){let o=[],a=[];return e.forEach(n=>{n.isAllDay?o.push(n):a.push(n)}),{allDaySubscriptions:o,timeSubscriptions:a}}const en=e=>/ #milestone/.test(e.content)||/ #\[\[milestone\]\]/.test(e.content),no=async(e,o,a)=>{const n=await logseq.Editor.getBlock(e);if(!n)return logseq.App.showMsg("Block not found","error"),Promise.reject(new Error("Block not found"));o&&await logseq.Editor.updateBlock(n.uuid,o);const r=Object.keys(a||{}).map(s=>logseq.Editor.upsertBlockProperty(n.uuid,s,a?.[s]));return Promise.allSettled(r)},ro=async(e,o)=>{const a=await logseq.Editor.createPage(o);return a?(await logseq.Editor.moveBlock(e,a.uuid),await xe({uuid:e})):logseq.App.showMsg("Create page failed","error")},ft=async(e,o,a)=>{const r=await xe(typeof e=="number"?{id:e}:{uuid:e});if(!r)return logseq.App.showMsg("moveBlockToSpecificBlock: Block not found","error");let s=await de({originalName:o});s||(s=await logseq.Editor.createPage(o));let i=await io(o,a);return i||(i=await logseq.Editor.insertBlock(o,a,{before:!0,isPageBlock:!0})),i&&await logseq.Editor.moveBlock(r.uuid,i.uuid,{children:!0}),await xe({uuid:r.uuid})},so=async(e,o,a,n={})=>{let r=await de({originalName:e});r||(r=await logseq.Editor.createPage(e));let s=await io(e,o);return s||(s=await logseq.Editor.insertBlock(e,o,{before:!0,isPageBlock:!0})),await logseq.Editor.insertBlock(s.uuid,a,{isPageBlock:!1,properties:n,sibling:!1,before:!1})},Je=new Map,xe=async(e,o=!1)=>{const{id:a,uuid:n}=e,r=a||n;if(!r)return Promise.reject(new Error("getBlockData: id or uuid is required"));if(o&&Je.has(r))return Je.get(r);const s=await logseq.Editor.getBlock(r);if(!s)return null;const{id:i,uuid:l}=s;return Je.set(i,s),Je.set(l,s),s},Pe=new Map,de=async(e,o,a=!1)=>{const{id:n,uuid:r,originalName:s}=e,i=n||r||s;if(!i)return Promise.reject(new Error("getPageData: id, uuid or pageOriginalName is required"));if(a&&Pe.has(i))return Pe.get(i);const l=await logseq.Editor.getPage(i,o);if(!l)return null;const{id:d,uuid:c,originalName:m}=l;return Pe.set(d,l),Pe.set(c,l),Pe.set(m,l),l},lo=async()=>{const e=await logseq.App.getStateFromStore("ui/theme"),o=logseq.settings?.theme==="auto"?e:logseq.settings?.theme,a=logseq.settings?.lightThemeType||"green";return o==="dark"?"dark":a},io=async(e,o)=>(await logseq.Editor.getPageBlocksTree(e)).find(r=>r.content===o)||null,tn=e=>{let o=null;for(let a=0;a<e.length;a++){const n=e[a],r=n.getAttribute("blockid");if(n?.className?.includes("block-content")&&r){o=r;break}a++}return o},co=(e,o)=>{const a=e.marker,n=e.priority;return(o||e.content)?.replace(a,"").trim().replace(`[#${n}]`,"").trim()},Ve=(e,o)=>{const a=e.marker,n=e.priority;let r=o;return n&&(r=`[#${n}] `+r),a&&(r=a+" "+r),r};let yt=new Map;const on=(e,o=2e3)=>({blocks:a,txData:n,txMeta:r})=>{const{marker:s,properties:i,uuid:l}=a[0];if(!s||!i?.todoistId||!l)return;const d=yt.get(l);d&&clearInterval(d),yt.set(l,window.setInterval(async()=>{if(await logseq.Editor.checkEditing()!==l){const m=yt.get(l);clearInterval(m),e(l)}},o))},j=(e={filterInvalideProject:!0})=>{const{filterInvalideProject:o}=e;let a=K.logKey;const n=logseq.settings?.logKey;n&&(a=n,typeof n=="string"&&K.logKey&&(a={...K.logKey,id:n}));const r=logseq.settings?.projectList||K.projectList;return{...K,...logseq.settings,logKey:a,projectList:o?r?.filter(s=>Boolean(s.id)):r}},an=()=>{if(!logseq.settings?.initialized){const o=j();logseq.updateSettings({...o,initialized:!0})}},nn=async()=>{const o=await lo()==="dark"?"dark":"light";let a=logseq.settings?.defaultView||"month";return logseq.settings?.defaultView==="2week"&&(a="month"),{defaultView:a,taskView:!0,scheduleView:!0,useDetailPopup:!0,isReadOnly:!1,disableClick:!0,theme:Ya[o],usageStatistics:!1,week:{startDayOfWeek:logseq.settings?.weekStartDay||0,hourStart:logseq.settings?.weekHourStart||0,hourEnd:logseq.settings?.weekHourEnd||24},month:{startDayOfWeek:logseq.settings?.weekStartDay||0,scheduleFilter:n=>Boolean(n.isVisible),visibleWeeksCount:logseq.settings?.defaultView==="2week"?2:void 0},template:{taskTitle:()=>'<span class="tui-full-calendar-left-content">Overdue</span>',task:n=>"\u{1F525}"+n.title,timegridDisplayPrimayTime:function(n){return n.hour<10?"0"+n.hour+":00":n.hour+":00"},popupDetailBody:n=>{const r=`<br/><b>Calendar: ${n.calendarId}</b>`,s=n.raw?.subscription?"":'<br/><a id="faiz-nav-detail" href="javascript:void(0);">Navigate To Block</a>';return`
          <div class="calendar-popup-detail-content">
            ${n.body?.split(`
`).join("<br/>")}
          </div>
          ${r}
          ${s}
        `}}}},rn=e=>({...e,isReadOnly:!0,defaultView:"week",taskView:["time"]}),sn=e=>({id:e,bgColor:"#b8e986",textColor:"#4a4a4a",borderColor:"#047857",enabled:!0,query:[{script:`
[:find (pull ?block [*])
:where
[?block :block/marker ?marker]
[(missing? $ ?block :block/deadline)]
(not [(missing? $ ?block :block/scheduled)])
[?page :block/name ?pname]
[?block :block/page ?page]
[(contains? #{"${e}"} ?pname)]
[(contains? #{"TODO" "DOING" "NOW" "LATER" "WAITING" "DONE"} ?marker)]]
        `,scheduleStart:"scheduled",dateFormatter:"yyyyMMdd"},{script:`
[:find (pull ?block [*])
:where
[?block :block/marker ?marker]
[(missing? $ ?block :block/scheduled)]
[(get-else $ ?block :block/deadline "nil") ?d]
[(not= ?d "nil")]
[?page :block/name ?pname]
[?block :block/page ?page]
[(contains? #{"${e}"} ?pname)]
[(contains? #{"TODO" "DOING" "NOW" "LATER" "WAITING" "DONE"} ?marker)]]
        `,scheduleStart:"deadline",dateFormatter:"yyyyMMdd"},{script:`
[:find (pull ?block [*])
:where
[?page :block/name ?pname]
[?block :block/page ?page]
[(contains? #{"${e}"} ?pname)]
[?rp :block/name "milestone"]
[?block :block/refs ?rp]]
        `,scheduleStart:"scheduled",dateFormatter:"yyyyMMdd",isMilestone:!0}]}),ln=e=>({id:e,bgColor:"#b8e986",textColor:"#4a4a4a",borderColor:"#047857",enabled:!0,query:[{script:`(and (page "${e}") (task todo doing done later now waitting) (property end) (property start))`,scheduleStart:"properties.start",scheduleEnd:"properties.end",dateFormatter:"yyyy-MM-dd",queryType:"simple"},{script:`(and (page "${e}") (task todo doing done later now waitting) (property end) (property start))`,scheduleStart:"properties.start",scheduleEnd:"properties.end",dateFormatter:"yyyy-MM-dd HH:mm",queryType:"simple"},{script:`(and (page "${e}") [[milestone]] (property start))`,scheduleStart:"properties.start",dateFormatter:"yyyy-MM-dd",queryType:"simple",isMilestone:!0}]});var dn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAAAXNSR0IArs4c6QAADHpJREFUeF7tnXlwG9Udx797yJIsW7ZjTOwcTogdhyPN6Rx2m2CHkIZAuQkQjoEBWmC4WtrSdso9TMtAgULLDKTMdCg3JIGGAikYhyMk0NCSBGgwEJL4kC+k+JSsazsrx0U+tbvvPeHlPf3lsX6/3/u97++zvz20+1aC+HCtgMT17MXkIQDgHAIBgACAcwU4n77oAAIAzhXgfPqiAwgAOFeA8+mLDiAA4FwBzqcvOoAAgHMFOJ++6AACAM4V4Hz6ogMIADhXgPPpj7sOUPP2rgWejMwvli6d2cm6Nq/V7Lw8JssfnVy9YCfrsV6p2VkCOdq3pnppA+uxzMQfNwDUbt9zJWK4FRIKD0/gyervf+9CM5MxavvGu3tOVCQ8HIvFSoOhIGRF7jr5hCVeo/5m7F59Y8ecaFx7FsDRCT9J2u6IxU9ZvbrSbyYOK9txA8DWbXu2aUBl8kQlSVpXVTn7adqTHxgrFotBB0D/OBwZf1pdvfBa2mO9vGXHPZqk/Tw5rqbhoVN/WHEd7bGsxBs3ANRu26MNnUA8Hr/9hGVzb7MysbF8BsZKBkBV1a0nrVhUTXuszf/cXgugakjcrT9aVUF9LCu5CwAOdwABgBV8KPqIDkBRTBOhmHaAlvMqKqNxaZUErVyTUCLF0Txabp/d8OjQNoncj97cP3HrM/tNzMeQ6cBYybuArNaG6KSN67sNBTBhVH/6ZVnBwmI12cXdfDA69cXHRh1Lg6TIUrxRQfw9TcMTpRtr9N0Ikw8TAJrOqVinSfgZgIVGs667/tFhpvk7NiP//c1GQxi2GxhrEADN9Thy018NxzBq6DvtYgQnTRtk7m46gKKXHjcaAg4pUu+QwjcdteEt6gfE1AFoWLv0BQnSWYZnd9hQADC2YhI0ZMjh2tINNSvMajuWPVUAGtZW3C8BN1hJUABgTDWnHHq6dMOb64xZp7aiBkDL+UvmRGPyrtRDjmwhADCunCpFzpy18fVNxj1Gt6QGQNO5lQ9rmnaV1aQEAMaVU6R4w9EbX5tq3CMNADSurRh2IcdMggIA42rpxwPHbnqVysZLJciBc5YsVCWZ6AcVAYBxAHRLt9q3asbzNa+b8xpuTQWAxrUV5wN4iiQZAYA59dxK8M4ZL9TeYs5rHAPQeNp16Jk+e1CGk196EJ79H5POcZh/0ylXo7tkHpKvAxzx4TvwfrCV+liB8uUILDp+UNy8f72FvJ1vE431nQOgt/hYHJpThd4pZXC11cPdUMfkIpCuejR7Atorz0DHtNnoi0SQ0eFH4bOPEBVkNGfNkYH2ZasTF4PkSATu+i+R/x5x58Z3DgAm6qcI2pNThEh76NsYmnhMAQCxhEBUU9EdzaYQKf0hBAAUNBcAgM4SMTTOAijU03QIAYAAQOwCTG82IziIDkBDRXMxxDGAOb1GtBa7AEq7gPoLqi6UI31/o1CTtIawMwAuj3R3yRP/+BWpYFQuBTfd9Zs7tF21N5Mmk25/WwMwb/6rJbfetYZUMwGATa8DqGvOemzWFZddPv4AUB2kOaXNPxpT0B12p208mgOpZ1/651kXnHMNaUwqHaC+TatSFDC7c5V0kqP5J34MCvayCs80rqKqPy2ZlPkA6SACAAEAKUOA6ADkGpqNIDqAWcVGsBe7AFrXAcQxAAUczYUQHWAEveRIK5RQPeS+Buh/J3+iWfMRzZwFTfnm59+ROoAr8C7c/m1Qgr5B/pHsMkQ8MxHOno2os8hctRhYCwAOiyrFw8gIbIHTvwWOrg9SSh31zEE4dxlC+WcgKnkSZwFZjU/B43sFcncTEI2ljBHPKUKwaDU6p1yS0paVgQBAvzPWtz5ReKXvoHmdJQV9jsWQDrwPRMLm/XUPtwehomoEZvzCmj+BF9cA6Fu9p/5uOL8me3BU69MQaUm9xaeqUzx3ClrKn0xlRvV7bgFQe/ciZ+/FVMSkBUAiGVWBr+pNKnkZCcIlAEpoH3I/Pc+IPoZsqAKgj5jhgG/5G4bGJjXiDgAp2oncvRdCDo+6xoRpTakDoN9yXlCGtrnrTedi1oE7ALL3/RIZh+g+uMECAL2QkcL5aJ9NfJl+TCa4AiAjUIPsr35tdiNJac8KAMgS/OX3o887P2UOVg24AsBb9xM4uv9jVatR/ZgBkIZdATcAuNpfgufgXdSLrwdkCYB+w33HvJvRm7+SSe7cAJC97yZkHGJzqwFTAAD0FVfBX3a7AMCqAvoFn7zdKyHF2Ty/xxqAeO4ktJRTX9grIScXHcDR+QG8XxDf9fStHAMkBmV4XYALAPRr/Zk+dufUrDuAzkDzitehyRlWm+CofgIACpKmA4D2HzyOiGvwQpEUUudjF/Bd6ACBRfcilLOIRs0HxRAdgIKk6egAnXNvQk8B8fMbw2bLBQCutufhqb+HQqlHDpEOAAKL70PIa3jJZMNz5QIAR+d2eL+43rAoZg2ZA6DI8FWzuYbBBQBKaD9yP11rtq6G7VkDoGXno3nJRsP5mDHkAgD9QlDuJ6dDjrSb0cawLWsAWP4qyAUAeiVZngkwBUACAuV/QCin3DCQZgy5AUDf+vVbwFh0AZYAxPOmomXhE2ZqasqWGwBYdgGWAHQddxW6i+jdvjaUDq4AkMMtidvBpGiHqa0klTErADRvAZoXv5BqeKLvuQJAV8rT8ABcrUTrUQ8TnBUAXcddh+4i02/NMQUEdwAowc+R+98LTImUypgFAPEJ09CywPgLoVLlONr33AGgC+GtuxKO7n9b1SwtHaBn1iXonHoptRwFAEkK0D4lpN4BZAm+FXTvXBYAJCkw3h8MiecUomWR/qJw9h8udwG6rBP0W8SinVQUpt0BWN4DyPVpYPLkcz67FGrPJ+MSgJ5jLkPnZDrPLaaaILcdIGv/LXD6X0ulT8rvQ0euQ0/+2UDDFnia/g45UJ/SJ5UBq59+RxqXWwBoHAh2HfU7hPNO6H9n0OFVwoq2nwr0kF1o8q18KxUj1L7nFgBX6zPwNNxHJKR/bi00xTMIgIJdV0Btq7MeN41nAHqS3ALg9L+CrP23WS8UgK8X9C8lk9wBjvj4BjiaCR4/c6jwHV9DlJcZZ24ByOh4B9lf3mhGq2G2TABwuuBbtoUoLzPO3ALg6PoQ3s8tv6I4oTELALTMbDRXvmymhkS2AgAC+QQA34hnu7WCRQfoLx63HUDt/Qw5ey+yvP1rshP+ee8MOwjM3/tbZDT0/9/KR8vKQ/PSF624WvLhFgBdrQkfLbf8xHDMXYpDx/TfV5B8FuBp3Qzv7nstFSMR64iZaJ33F8v+Zh25BsD7+TWGVgUdSdRwbjW6Ztw9DAA5EsDEt08HNLOl6LcPFx+Pr8vusOZswYtrADIbH4S7xdoNl8GJF6N3cv8j50PXCi7atgYI9lgoB5Cu+wAGkuMaAP0ewZy6H0MOD17QOVXlop7Z6Cz94/8XjB4KQM7B9cisMw9WLK8YrQvT+9I0rgHQC2125TBNdqOz7NHEiuEDn5FWCy/YfTXUVhO/Nro9aKl4EXEGawCMBTT3AOjiuNo2wNX2HJTQV2Nu/FHPXAQLL0I4Z/kgu9FeGFGw51qobXuA+NgHBPoNIB0zb0Qod3Gq5kP9ewHAYUmlWE8CAr0jqKF9gBbt/0ZyIOouQTjvRAQnjnzaONYbQ1yHdsD71SNQOuuBSOSbAsoS4MxEcPJJODT9WuqFNRpQADCSUloUSugAICmIOacAkjqmnkZfGaOE2+Dq+BBRVxH6sucarRFTOwEABXmNAkBhKOohBAAUJBUAUHpplK9LO1aLwMShM4XqUQhhZwBk1Xlm6STnJlIZqPwYpGmayxdAkDSZdPvbGQCnlj1h2jQpQKoZFQD0JHx+7WMNOI40oXT62xUASZLDM6dmOWloRROAhzSA3bKeNGY7JIZdAVAV9f0ZkzOX0pCEGgB6Mk1+7QCAYhqJpSOGHQGQZbm9dEpWAS19qAJgt4NBOwJQVuylWjOqwRLHAj6tQHPiOQBVtChlFcdOAKiq48CMSe7ptLWgDsBAgo1+7ffQcKYkYSbtpGnFswMAsqz0Kor08lFFmefSmndyHGYADAzypV/LyYxjVlRDJosJkMQMR4LzSPxZ+iqytHt6oZv5iwiZA8BSJBGbXAEBALmGto4gALB1+ciTFwCQa2jrCAIAW5ePPHkBALmGto4gALB1+ciTFwCQa2jrCAIAW5ePPHkBALmGto4gALB1+ciTFwCQa2jrCAIAW5ePPHkBALmGto4gALB1+ciTFwCQa2jrCAIAW5ePPPn/AeXG+9voOJDHAAAAAElFTkSuQmCC";const cn="_container_1xwon_1",un="_buttonWrapper_1xwon_4",mn="_button_1xwon_4",pn="_active_1xwon_19",hn="_indicatorBack_1xwon_23",gn="_indicatorDot_1xwon_34";var Ce={container:cn,buttonWrapper:un,button:mn,active:pn,indicatorBack:hn,indicatorDot:gn};const fn=({initialValue:e,onChange:o,tabs:a})=>{const[n,r]=x.exports.useState(e||a?.[0]?.value),s=a.findIndex(({value:l})=>l===n)*100,i=l=>{r(l),o?.(l)};return g("div",{className:Ce.container,children:[a.map(({label:l,value:d,icon:c})=>t("div",{className:Ce.buttonWrapper,onClick:()=>i(d),children:t("div",{className:`${Ce.button} ${d===n?Ce.active:""}`,title:l,children:c})},d)),t("div",{className:Ce.indicatorBack,style:{transform:`translateX(60px) translateY(${s}%)`}}),t("div",{className:Ce.indicatorDot,style:{transform:`translateY(${s}%)`}})]})},yn="_container_1ph2e_1",wn="_logo_1ph2e_6",bn="_close_1ph2e_16";var wt={container:yn,logo:wn,close:bn};const kn=({defaultRoute:e,menus:o})=>{const a=Mt(),{homePage:n=K.homePage}=j(),r=s=>{const{path:i}=o.find(l=>l.value===s)||{path:"/"};a(i)};return x.exports.useEffect(()=>{e&&a(e)},[e]),g("div",{className:wt.container,children:[t("div",{className:wt.logo,children:t("img",{src:dn})}),t(fn,{tabs:o,onChange:r,initialValue:n}),t("div",{className:wt.close,onClick:()=>logseq.hideMainUI(),children:t(It,{})})]})};function ce(){const[e,o]=x.exports.useState(K.lightThemeType);return x.exports.useEffect(()=>{lo().then(a=>{o(a)})}),e}const vn={green:{lineColor:"#058f68",backColor:"rgba(5, 143, 104, 0.8)",backColorEnd:"rgba(255,255,255,0)"},purple:{lineColor:"#3a4de9",backColor:"rgba(58,77,233,0.8)",backColorEnd:"rgba(255,255,255,0)"},dark:{lineColor:"#d19811",backColor:"rgba(148, 108, 12, 0.8)",backColorEnd:"rgba(33, 37, 40, 0.8)"}},xn={green:{backColor:"#e9f2f0",lineColor:"#058f68",shadowColor:"rgba(5, 143, 104, 0.8)",colorPrimary:"#333",colorSecondary:"#777"},purple:{backColor:"#f2f6ff",lineColor:"#5146a0",shadowColor:"rgba(58,77,233,0.8)",colorPrimary:"#333",colorSecondary:"#777"},dark:{backColor:"#212528",lineColor:"#d19811",shadowColor:"rgba(33, 37, 40, 0.8)",colorPrimary:"#fafafe",colorSecondary:"#aaadb3"}},Cn=Ua(),uo=({progress:e=0,uniqueId:o="",height:a=160,type:n="primary"})=>{const r=x.exports.useRef(),s=ce();return x.exports.useEffect(()=>{const i=document.getElementById("gauge"+o);async function l(){if(!i||!s)return;const d=xn[s],c=n==="normal"?20:60,m=n==="normal"?4:7,u={series:[{type:"gauge",startAngle:90,endAngle:-270,min:0,max:100,splitNumber:12,grid:{left:"0",right:"0",bottom:"0",containLabel:!0},itemStyle:{color:d.lineColor,shadowColor:d.shadowColor,shadowBlur:n==="normal"?3:10,shadowOffsetX:n==="normal"?0:2,shadowOffsetY:n==="normal"?0:2},progress:{show:!0,roundCap:!0,width:m},pointer:{show:!1},axisLine:{roundCap:!0,lineStyle:{width:m,color:[[1,d.backColor]]}},axisTick:{show:!1},splitLine:{show:!1},axisLabel:{show:!1},title:{show:!1},detail:{show:!0,width:c,height:c,lineHeight:c+(Cn==="windows"?4:0),borderRadius:100,offsetCenter:[0,0],valueAnimation:!0,formatter:function(h){return"{value|"+h.toFixed(0)+"}{unit|%}"},rich:{value:{fontSize:n==="normal"?15:34,color:d.colorPrimary},unit:{fontSize:n==="normal"?10:15,color:d.colorSecondary,padding:n==="normal"?[0,0,-2,1]:[0,0,-8,2]}}},data:[{value:e}]}]};window.requestAnimationFrame(()=>{const h=_e(i);r.current=h,h.setOption(u)})}return l(),()=>{r.current&&r.current.dispose()}},[e,s]),t("div",{children:t("div",{id:"gauge"+o,style:{width:"100%",height:a+"px"}})})},Dn=({data:e})=>{const o=x.exports.useRef(),a=ce();return x.exports.useEffect(()=>{const n=document.getElementById("polygonal");async function r(){if(!n||!a)return;const s=vn[a],i={xAxis:{type:"category",data:e.map(l=>{const d=p(l.date).format("DD");return d==="01"?p(l.date).format("MM.DD"):d}),axisTick:{show:!1},axisLine:{show:!1}},yAxis:{type:"value",splitLine:{show:!1},minInterval:1},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},series:[{data:e.map(l=>l.value),type:"line",smooth:!0,emphasis:{focus:"series"},showSymbol:!1,itemStyle:{color:s.lineColor},areaStyle:{color:new Ro(0,0,0,1,[{offset:0,color:s.backColor},{offset:1,color:s.backColorEnd}])}}]};window.requestAnimationFrame(()=>{const l=_e(n);o.current=l,l.setOption(i)})}return r(),()=>{o.current&&o.current.dispose()}},[e,a]),t("div",{id:"polygonal",style:{height:"240px",width:"100%"}})},mo=`
  .external-link[href^="#agenda://"]::before {
    content: '\u{1F4C5}';
    margin: 0 4px;
  }
  .agenda-sidebar-task__add {
    display: none;
  }
  .agenda-sidebar-task:hover {
    opacity: 1;
  }
  .agenda-sidebar-task:hover .agenda-sidebar-task__add {
    display: flex;
  }
  .agenda-sidebar-task:hover .agenda-sidebar-task__title {
    color: var(--ls-link-text-color);
  }

  .external-link[href^="#agenda-pomo://"]::before {
    display: none;
  }
  .external-link[href^="#agenda-pomo://"] {
    font-weight: 600;
    border: 1px solid #0F9960;
    background: #defcf0;
    border-radius: 4px;
    padding: 1px 6px;
    color: #222;
    white-space: nowrap;
  }
  .dark .external-link[href^="#agenda-pomo://"] {
    background-color: #1a543b;
    color: #ddd;
  }

  .agenda-toolbar-pompdoro {
    height: 1.5rem;
    width: 62px;
    line-height: 1.5rem;
    font-size: 14px;
    font-weight: 600;
    border-radius: 0.3rem;
    margin: 0 0.125rem;
    color: #cd3838;
    border: 1px solid #cd3838;
    text-align: center;
    position: relative;
  }
  .agenda-toolbar-pompdoro .timer-progress-back {
    width: 0;
    height: 100%;
    background: #f6dbdb;
    position: absolute;
    z-index: -1;
    left: 0;
    top: 0;
    transition: width 0.5s;
  }
  .dark .agenda-toolbar-pompdoro .timer-progress-back {
    background-color: #a69494;
  }
  .agenda-toolbar-pompdoro.break {
    color: #0F9960;
    border-color: #0F9960;
  }
  .agenda-toolbar-pompdoro.break .timer-progress-back {
    background-color: #defcf0;
  }
  .dark .agenda-toolbar-pompdoro.break .timer-progress-back {
    background-color: #1a543b;
  }
  .agenda-toolbar-pompdoro.hide {
    display: none;
  }
`,Ke={bgColor:"#b8e986",textColor:"#4a4a4a",borderColor:"#047857"},po=(e,o,a,n=!1)=>`<div data-on-click="showPomodoro" class="agenda-toolbar-pompdoro ${n?"break":""}" data-uuid="${e}">
    ${o}
    <div class="timer-progress-back" style="width: ${a*100}%;"></div>
  </div>`,bt=(e=!0)=>{const o=document.querySelector("#pomodoro-root");o&&e&&o.classList.remove("hide"),o&&!e&&o.classList.add("hide")},ho=(e,o)=>{const a=o==="markdown"?We:Ge,n=e.match(a);if(!n||!n?.[1])return null;const s=Kt(n[1]).t;return s?s.split(",").map(l=>{const d=l.split("-"),[c,m,u,...h]=d,w=h.join("-"),D=h?.length>0?w.split(zt):[];return{isFull:c==="f",start:parseInt(m),length:parseInt(u),interruptions:D.map(A=>({type:Number(A?.[0]),time:Number(A.substring(1,14)),remark:A.substring(14)}))}}):null},kt=async(e,o,a="addon")=>{const n=await logseq.Editor.getBlock(e);if(!n)return;let r=[].concat(o);a==="addon"&&(r=(ho(n.content,n.format)||[]).concat(o));const s=r.map(A=>{const{isFull:q,start:C,length:v,interruptions:y}=A,b=q?"f":"p",T=y?.map(k=>{const{type:S,time:L,remark:I}=k;return`${S}${L}${I}`}).join(zt);return`${b}-${C}-${v}${T?`-${T}`:""}`}).join(","),i=new URL("agenda-pomo://");i.searchParams.append("t",s);const l=r.reduce((A,q)=>A+q.length,0),c=`${r.filter(A=>A.isFull)?.map(()=>"\u{1F345}")?.join("")||"\u{1F345}"} ${Math.ceil(l/60)}min`,m=n?.format==="org"?`>[[#${i.toString()}][${c}]]`:`>[${c}](#${i.toString()})`,[u,...h]=n.content?.split(`
`)||[];let w=u;const D=n.format==="markdown"?We:Ge;return D.test(n.content)?w=u.replace(D,m):w=`${u} ${m}`,`${w}
${h.join(`
`)}`},Tn=(e,o)=>{const a=o==="markdown"?We:Ge;return e.replace(a,"")?.trim()},Ze=e=>{const{journal:o,projectList:a=[]}=j();let n=e?.addOns?.allDay?"allday":"time";e?.addOns?.isOverdue&&(n="task");let r=e?.addOns?.isJournal?o:a.find(s=>s.id===e?.addOns?.project);return r||(r=Ke),{id:e.uuid,calendarId:e.addOns.isJournal?"Journal":e.addOns.project,title:e.addOns.showTitle,body:e.content,category:n,dueDateClass:"",start:e.addOns.start,end:e.addOns.end,raw:e,color:r?.textColor,bgColor:r?.bgColor,borderColor:r?.borderColor,isAllDay:!e?.addOns?.isOverdue&&e.addOns.allDay,customStyle:e.addOns.status==="done"?"opacity: 0.6;":"",isReadOnly:!1}},Xe=e=>{const{journal:o,projectList:a=[]}=j();let n=e?.addOns?.isJournal?o:a.find(r=>r.id===e?.addOns?.project);return n||(n=Ke),{id:e.uuid,calendarId:e.addOns.isJournal?"Journal":e.addOns.project,title:e.addOns.showTitle,body:e.content,category:"milestone",dueDateClass:"",start:e.addOns.start,end:e.addOns.end,raw:e,color:n?.textColor,bgColor:n?.bgColor,borderColor:n?.borderColor,isAllDay:!1,customStyle:e.addOns.status==="done"?"opacity: 0.6;":"",isReadOnly:!1}},go=e=>{const o=p(e.addOns.start),a=p(e.addOns.end);return{id:e.uuid,title:e.addOns.showTitle,start:o.format("YYYY-MM-DD"),end:a.format("YYYY-MM-DD"),raw:e,completed:e.addOns.status==="done",detailPopup:g("div",{className:"text-xs",children:[t("div",{className:"font-bold text-base my-2",children:e.addOns.showTitle}),t("div",{className:"my-2",children:`${o.format("YYYY.MM.DD hh:mm a")} - ${a.format("hh:mm a")}`}),t("p",{className:"whitespace-pre-line",children:e.content}),t("a",{onClick:async()=>{const{id:n,originalName:r}=e.page||{};let s=r;s||(s=(await de({id:n}))?.originalName),logseq.Editor.scrollToBlockInPage(s,e.uuid),logseq.hideMainUI()},children:"Navigate to block"})]})}},oe=async(e,o)=>{const{defaultDuration:a,journal:n,projectList:r}=o,s=e?.page?.originalName?e.page:await logseq.Editor.getPage(e.page.id);e.page=s;const i=An(e),l=ho(e.content,e.format),d=en(e),c=e.refs?.find(D=>D.originalName===e.properties?.project?.[0]),m=Boolean(c?c?.journalDay:s?.journalDay);let u=i?{...e,rawTime:i,addOns:{showTitle:"",project:"Journal",contentWithoutTime:"",end:"",status:"todo",isOverdue:!1,isJournal:!1,type:"task",...i}}:{...e,addOns:{showTitle:"",project:"Journal",contentWithoutTime:"",status:"todo",isOverdue:!1,isJournal:!1,type:"task"}},h=co(e);if(i?.timeFrom==="customLink"&&(h=to(h.trim())),i?.timeFrom==="journal"&&!i?.allDay&&(h=Xt(h.trim())),i?.timeFrom==="refs"){const{preferredDateFormat:D}=await logseq.App.getUserConfigs(),A=X(p(i.start).valueOf(),D);h=h.replace(`[[${A}]]`,"")?.trim()}u.addOns.contentWithoutTime=h,l&&(h=Tn(h,e.format)),u.addOns.showTitle=await eo(h?.split(`
`)?.[0]?.trim()),i&&!i.end&&(i.allDay?u.addOns.end=i.start:u.addOns.end=p(u.addOns.start).add(a.value,a.unit).format()),["DOING","NOW"].includes(e.marker)?u.addOns.status="doing":e.marker==="WAITING"?u.addOns.status="waiting":e.marker==="DONE"?u.addOns.status="done":e.marker==="CANCELED"&&(u.addOns.status="canceled"),i&&Zt(e,u.addOns.end,i?.allDay)&&(u.addOns.isOverdue=!0),m&&(u.addOns.isJournal=!0),d&&(u.addOns.type="milestone"),u.addOns.pomodoros=l||[],u.addOns.project=m?"Journal":c?.originalName||s?.originalName,u.addOns.projectPage=c||s;const w=r?.find(D=>D.id===u.addOns.project);return w?u.addOns.calendarConfig=w:m?u.addOns.calendarConfig=n:u.addOns.calendarConfig={id:u.addOns.project,enabled:!0,...Ke},u},An=e=>{const{start:o,end:a}=e.properties||{};if(o&&a)return o?.length>=16?{start:p(o,"YYYY-MM-DD HH:mm").format(),end:p(a,"YYYY-MM-DD HH:mm").format(),allDay:!1,timeFrom:"startProperty"}:{start:p(o,"YYYY-MM-DD").format(),end:p(a,"YYYY-MM-DD").format(),allDay:!0,timeFrom:"startProperty"};const n=Xa(e.content),r=n?.start?.length===13?Number(n.start):n?.start,s=n?.end?.length===13?Number(n.end):n?.end;if(n)return{start:p(r).format(),end:p(s).format(),allDay:n.allDay!=="false",timeFrom:"customLink"};if(e.scheduled){const d=e.content?.split(`
`)?.find(m=>m.startsWith("SCHEDULED:"))?.trim(),c=/ (\d{2}:\d{2})[ >]/.exec(d)?.[1]||"";return c?{start:p(`${e.scheduled} ${c}`,"YYYYMMDD HH:mm").format(),allDay:!1,timeFrom:"scheduledProperty"}:{start:p(""+e.scheduled,"YYYYMMDD").format(),allDay:!0,timeFrom:"scheduledProperty"}}if(e.deadline){const d=e.content?.split(`
`)?.find(m=>m.startsWith("DEADLINE:"))?.trim(),c=/ (\d{2}:\d{2})[ >]/.exec(d)?.[1]||"";return c?{start:p(`${e.deadline} ${c}`,"YYYYMMDD HH:mm").format(),allDay:!1,timeFrom:"deadlineProperty"}:{start:p(""+e.deadline,"YYYYMMDD").format(),allDay:!0,timeFrom:"deadlineProperty"}}const i=e.refs?.find(d=>Boolean(d?.journalDay));if(i)return{start:p(i?.journalDay+"","YYYYMMDD").format(),allDay:!0,timeFrom:"refs"};if(Boolean(e?.page?.journalDay)){const d=co(e),{start:c,end:m}=pt(d);return c&&m?{start:p(`${e?.page?.journalDay} ${c}`,"YYYYMMDD HH:mm").format(),end:p(`${e?.page?.journalDay} ${m}`,"YYYYMMDD HH:mm").format(),allDay:!1,timeFrom:"journal"}:c&&!m?{start:p(`${e?.page?.journalDay} ${c}`,"YYYYMMDD HH:mm").format(),allDay:!1,timeFrom:"journal"}:{start:p(e?.page?.journalDay+"","YYYYMMDD").format(),allDay:!0,timeFrom:"journal"}}return null},je=()=>({tasks:{withTime:[],noTime:[]},milestones:{withTime:[],noTime:[]}}),vt=async()=>{let e=await logseq.DB.datascriptQuery(`
  [:find (pull
    ?block
    [:block/uuid
      :block/parent
      :db/id
      :block/left
      :block/collapsed?
      :block/format
      :block/_refs
      :block/path-refs
      :block/tags
      :block/content
      :block/marker
      :block/priority
      :block/properties
      :block/pre-block?
      :block/scheduled
      :block/deadline
      :block/repeated?
      :block/created-at
      :block/updated-at
      :block/file
      :block/heading-level
      {:block/page
        [:db/id :block/name :block/original-name :block/journal-day :block/journal?]}
      {:block/refs
        [:db/id :block/name :block/original-name :block/journal-day :block/journal?]}])
    :where
    [?block :block/marker ?marker]
    [(contains? #{"TODO" "DOING" "NOW" "LATER" "WAITING" "DONE" "CANCELED"} ?marker)]]
  `);if(!e||e?.length===0)return null;const o=j();e=e.flat(),o.ignoreTag&&(e=e.filter(l=>!l.refs?.some(c=>c?.["original-name"]===o.ignoreTag)));let a=je(),n=je();const r=new Map,s=o?.projectList?.filter(l=>l?.enabled!==!0),i=e.map(async l=>{l={...l,uuid:typeof l.uuid=="string"?l.uuid:l.uuid?.$uuid$,page:{...l.page,originalName:l.page?.["original-name"],journalDay:l.page?.["journal-day"]},refs:l.refs?.map(h=>({...h,journalDay:h?.["journal-day"],originalName:h?.["original-name"]}))};const d=await oe(l,o),c=d.addOns.type==="milestone",m=d.rawTime,u=d.addOns.isJournal;if(!(u&&!o?.journal?.enabled)&&!s?.some(h=>h?.id===d?.addOns.project))if(c?m?a.milestones.withTime.push(d):a.milestones.noTime.push(d):m?a.tasks.withTime.push(d):a.tasks.noTime.push(d),u)c?m?n.milestones.withTime.push(d):n.milestones.noTime.push(d):m?n.tasks.withTime.push(d):n.tasks.noTime.push(d);else{const h=d.addOns.project,w=r.get(h)||je();c?m?w.milestones.withTime.push(d):w.milestones.noTime.push(d):m?w.tasks.withTime.push(d):w.tasks.noTime.push(d),r.set(h,w)}});return await Promise.all(i),{journalEvents:n,projectEventsMap:r,fullEvents:a}},fo=e=>e.addOns.pomodoros?.reduce((o,a)=>o+a.length,0)||0,fe=J(je()),De=J(je()),Te=J(new Map),xt=J(e=>{const o=e(fe),a=o.tasks.withTime.map(Ze),n=o.milestones.withTime.map(Xe);return a.concat(n)}),Sn=J(e=>{const{journal:o}=j(),a=e(xt);return{calendarConfig:o,schedules:a.filter(({calendarId:n})=>n==="Journal")}}),On=J(e=>{const{projectList:o=[]}=j(),a=e(xt);return o?.map(n=>({calendarConfig:n,schedules:a.filter(({calendarId:r})=>r===n.id)}))}),Nn=J(e=>{const o=e(fe),a=p().subtract(14,"day"),n=p();return o.tasks.withTime.filter(r=>p(r.start).isBetween(a,n,"day","(]"))}),et=J(e=>e(fe).tasks.withTime.filter(a=>{if(a.addOns.status==="canceled")return!1;if(a.addOns.isOverdue)return!0;const n=p(a.addOns.start),r=p(a.addOns.end);return p().isBetween(n,r,"day","[]")}).sort((a,n)=>p(a.addOns.start).diff(p(n.addOns.start)))),tt=J(e=>{const{projectList:o=[],journal:a}=j();return([a].concat(o)?.filter(s=>s?.enabled)).map(s=>{const i=s.id,l=s.id==="Journal"?e(De):e(Te).get(i),d=s.id==="Journal"?a:o.find(h=>h.id===i);if(!l)return{id:i,title:i,amount:{doing:0,todo:0,done:0},style:{bgColor:s.bgColor||"#fff",borderColor:s.borderColor||"#fff",color:s.textColor||"#000"},events:[],milestones:[]};const{doing:c,todo:m,done:u}=ge(l?.tasks?.withTime);return{id:i,title:i,amount:{doing:c?.length,todo:m?.length,done:u?.length},style:{bgColor:d?.bgColor||"#fff",borderColor:d?.borderColor||"#fff",color:d?.textColor||"#000"},events:l.tasks.withTime.map(go),milestones:l.milestones.withTime.map(go)}}).filter(function(s){return Boolean(s)})}),yo=36,ue=40,ot=30,Mn={day:108,week:44,month:20},In=[{value:"simple",label:"Simple"},{value:"advanced",label:"Advanced"}],En=[{value:"day",label:"Day"},{value:"week",label:"Week"},{value:"month",label:"Month"}],Ct=(e,o)=>{const a=[];let n=e;for(;n.isSameOrBefore(o);)a.push(n.clone()),n=n.add(1,"day");return a},wo=e=>e.day()===0||e.day()===6,qn=(e,o="simple")=>{let a=[];return e.forEach((n,r)=>{const s=a[r-1],{levelCount:i=0,events:l=[],milestones:d=[]}=s||{},c=o==="simple"?i:l.length,m=o==="simple"?d.length>0?1:0:d.length,u=r===0?0:s.coordinate.y+(c+m)*ue+yo+ot;a.push({...n,coordinate:{x:0,y:u}})}),a},bo=(e,o,a)=>o.diff(e,"day")*a,at=(e,o="")=>{document.getElementById(`date${o}${e.format("YYYYMMDD")}`)?.scrollIntoView({block:"nearest",inline:"center",behavior:"smooth"})},Pn=e=>e.map(o=>ko(o)),jn=e=>e.map(o=>Bn(o)),Bn=e=>{const{events:o,rangeStart:a,rangeEnd:n}=ko(e);let r=vo(o,[],p(a),p(n));return{...e,levelCount:r.length,events:r.map((s,i)=>s.map(l=>({...l,level:i}))).flat()}},ko=e=>{const{events:o,milestones:a}=e;o.sort((d,c)=>p(d.start).diff(p(c.start)));let n=new Map;o.forEach(d=>{const{start:c}=d;n.has(c)?n.get(c)?.push(d):n.set(c,[d])}),n.forEach(d=>{d.sort((c,m)=>{const u=p(c.end).diff(p(c.start),"day");return p(m.end).diff(p(m.start),"day")-u})});const r=Array.from(n.values()),s=r[0]?.[0]?.start,i=r[r.length-1]?.[0]?.end,l=r.flat();return{...e,events:l,milestones:a?.sort((d,c)=>p(d.start).diff(p(c.start))),rangeStart:s,rangeEnd:i}};function Ln(e,o){const a=new Map;return Ct(e,o).forEach(n=>{a.set(n.format("YYYY-MM-DD"),!1)}),a}function vo(e=[],o=[],a,n){const r=Ln(p(a),p(n)),s=[],i=[];return e.forEach(l=>{const{start:d,end:c}=l,m=p(d),u=p(c),h=Ct(m,u).map(w=>w.format("YYYY-MM-DD"));r.get(m.format("YYYY-MM-DD"))===!1?(h.forEach(w=>{r.set(w,!0)}),s.push(l)):i.push(l)}),o.push(s),i?.length===0?o:vo(i,o,a,n)}const _n=e=>{const o=e.map(r=>{const{events:s,milestones:i=[]}=r;return[...s,...i]}).flat();let a=p(),n=p();return o.forEach(r=>{const{start:s,end:i}=r;p(s).isBefore(a)&&(a=p(s)),p(i).isAfter(n)&&(n=p(i))}),{start:a,end:n}},Rn=({data:e,mode:o="simple",view:a="day",weekStartDay:n=0,uniqueId:r="",foldedGroups:s},i)=>{const l=p(),d=e.map(v=>s?.includes(v.id)?{...v,events:[],milestones:[],levelCount:0}:v),{start:c,end:m}=_n(d),u=c.subtract(1,"day"),h=m.add(9,"day"),w=Mn[a],D=Ct(u,h),q=qn(d,o).map((v,y)=>{const{events:b,milestones:T=[]}=v,k=o==="simple"?(v.levelCount||0)*ue:b.length*ue,S=o==="simple"?(T.length>0?1:0)*ue:T.length*ue,L=k+S+ot;return{...v,height:L,events:v.events.map((I,O)=>{const P=o==="simple"?I?.level||0:O;return{...I,coordinates:{x:bo(u,p(I.start),w),y:v.coordinate.y+P*ue},size:{width:w*(p(I.end).diff(p(I.start),"day")+1)-8,height:ue-4}}}),milestones:v.milestones?.map((I,O)=>{const P=o==="simple"?0:O;return{...I,coordinates:{x:bo(u,p(I.start),w),y:v.coordinate.y+k+P*ue}}})}}),C=q.reduce((v,y)=>v+y.height+yo,0);return x.exports.useEffect(()=>{document.getElementById(`date${r}${p().format("YYYYMMDD")}`)?.scrollIntoView({block:"nearest",inline:"center"})},[]),x.exports.useImperativeHandle(i,()=>({scrollToToday(){at(p(),r)}})),g("div",{className:"calendar h-fit w-fit",children:[t("div",{className:"w-fit whitespace-nowrap bg-quaternary sticky top-0 z-20 text",children:D.map(v=>{const b=v.format("DD")==="01"||v.isSame(u,"day")||v.isSame(h,"day");return t("div",{className:"inline",children:t("span",{className:"inline-block text-center sticky bg-quaternary overflow-visible box-content",style:{width:`${w}px`,left:0,lineHeight:"25px",paddingRight:"100px",marginRight:"-100px"},children:b?v.format("MMMM YYYY"):""})},"month"+v.valueOf())})}),t("div",{className:"calendar__header w-fit whitespace-nowrap bg-quaternary sticky z-20",style:{top:"25px"},children:D.map(v=>{const y=v.format("DD"),b=wo(v),T=v.isSame(l,"day");let k=!0;return a==="month"&&(k=v.day()===n||T),t("div",{className:`calendar__date inline-flex ${b?"weekend":""} ${T?"today":""}`,id:"date"+r+v.format("YYYYMMDD"),children:t("span",{className:`inline-block text-center ${k?"":"opacity-0"}`,style:{width:"108px"},children:y})},"date"+v.valueOf())})}),t("div",{className:"calendar__content relative",style:{height:C+"px"},children:q.map(v=>g("div",{className:"calendar__group w-fit",children:[t("div",{className:"flex",children:D.map((y,b)=>{const T=wo(y),k=y.isSame(l,"day");return t("div",{className:`calendar__content__back ${T?"weekend":""} ${k?"today":""}`,style:{height:v.height+"px"}})})}),v.events.map(y=>{const{coordinates:b,size:T,detailPopup:k,completed:S}=y;return t(Et,{content:k,trigger:"click",children:t("div",{className:`calendar__event absolute bg-quaternary rounded cursor-pointer single_ellipsis shadow ${S?"completed":""}`,style:{left:b.x,top:b.y+ot,width:T.width+"px",height:T.height+"px",zIndex:1},title:y.title,children:y.title},y.id)})}),v.milestones?.map(y=>{const{coordinates:b,detailPopup:T,completed:k}=y;return g(re,{children:[t("div",{className:"calendar__milestone__line absolute",style:{left:b.x+w/2,top:v.coordinate.y,height:v.height+16}},"milestone-line"+y.id),t(Et,{content:T,trigger:"click",children:g("div",{className:"calendar__milestone__text absolute flex items-center cursor-pointer",style:{left:b.x+2+w/2,top:b.y+ot},title:y.title,children:[k&&t("svg",{"data-v-651e2bfe":"",viewBox:"0 0 16 16",fill:"white",className:"milestone__mark",children:t("path",{"data-v-651e2bfe":"",d:"M5.536 11.175L2 7.639l1.497-1.497L7 9.642l6-6.28 1.497 1.497-7.464 7.814-1.497-1.497z"})}),t("span",{className:"single_ellipsis",style:{maxWidth:w-20},children:y.title})]},"milestone-text"+y.id)})]})})]},v.id))})]})};var Yn=x.exports.forwardRef(Rn);const Hn=({groupId:e,groupName:o,events:a,milestones:n=[],mode:r,levelCount:s=0,uniqueId:i="",foldedGroups:l,onFoldChange:d})=>{const c=l?.includes(e||""),m=u=>d?.(e||"",u);return g("div",{className:"group rounded-sm",children:[g("div",{className:"group__title font-medium sticky bg-quaternary title-text single_ellipsis",title:o,children:[c?t(qt,{onClick:()=>m?.(!1),className:"ml-2"}):t(Pt,{onClick:()=>m(!0),className:"ml-2"}),o]}),!c&&g("div",{className:"group__content",children:[r==="simple"?new Array(s).fill(0).map((u,h)=>t("div",{className:"group__event cursor-pointer"})):a.map(u=>t("div",{className:"group__event cursor-pointer single_ellipsis",onClick:()=>at(p(u.start),i),children:u?.title})),r==="simple"?n?.length>0?t("div",{className:"group__event cursor-pointer flex justify-between items-center"}):null:n?.map((u,h)=>t("div",{className:"group__event cursor-pointer single_ellipsis",onClick:()=>at(p(u.start),i),children:u?.title}))]})]})};const nt=({weekStartDay:e,data:o,showSidebar:a=!0,showOptions:n=!0,defaultView:r="day",defaultMode:s="simple",showModeSelector:i=!1,theme:l="light",uniqueId:d="",...c})=>{const m=x.exports.useRef(),[u,h]=x.exports.useState(r),[w,D]=x.exports.useState(s),[A,q]=x.exports.useState([]),[C,v]=x.exports.useState([]),y=(b,T)=>{v(T?[...C,b]:C.filter(k=>k!==b))};return x.exports.useEffect(()=>{const b=w==="simple"?jn(o):Pn(o);q(b)},[o,w]),g("div",{className:N(`w-full h-full relative gantt text view-${u}`,{dark:l==="dark"},{light:l!=="dark"}),...c,children:[a&&t("div",{className:"calendar__placeholder absolute bg-quaternary"}),n&&g("div",{className:"operation absolute right-0 top-0 z-30 bg-quaternary",children:[t(U,{size:"small",shape:"round",onClick:()=>at(p(),d),children:"Today"}),t(H,{size:"small",options:En,defaultValue:u,onChange:b=>h(b),style:{minWidth:"80px"},className:"ml-2 select-style"}),i&&t(H,{size:"small",options:In,defaultValue:"simple",onChange:b=>D(b),style:{minWidth:"110px"},className:"ml-2 select-style"})]}),g("div",{className:"flex h-full overflow-auto relative scroll-style",children:[a&&t("div",{className:"side-bar bg-quaternary sticky left-0 z-10 h-fit",children:A.map((b,T)=>t(Hn,{mode:w,groupId:b.id,groupName:b.title,events:b?.events,milestones:b?.milestones,levelCount:b.levelCount,uniqueId:d,foldedGroups:C,onFoldChange:y},b.id))}),t(Yn,{data:A,ref:m,mode:w,view:u,uniqueId:d,foldedGroups:C})]})]})},Fn="_content_16805_1",$n="_stats_16805_4",Un="_statsRight_16805_7",Wn="_amount_16805_10",Gn="_project_16805_15",zn="_projectContent_16805_18",Qn="_milestone_16805_22",Jn="_timeline_16805_26",Vn="_showTimeline_16805_26",Kn="_option_16805_39",Zn="_rightSide_16805_43",Xn="_taskLine_16805_49",er="_module_16805_52",tr="_task_16805_49",or="_taskDone_16805_66",ar="_taskActive_16805_69",nr="_time_16805_26",rr="_overdue_16805_92",sr="_sub_16805_95";var B={content:Fn,stats:$n,statsRight:Un,amount:Wn,project:Gn,projectContent:zn,milestone:Qn,timeline:Jn,showTimeline:Vn,option:Kn,rightSide:Zn,taskLine:Xn,module:er,task:tr,taskDone:or,taskActive:ar,time:nr,overdue:rr,sub:sr};function lr(e){const{milestones:o=[]}=e;if(o?.length===0)return null;const a=o.filter(n=>p(n.start).isSameOrAfter(p(),"day"));return a.length===0?null:a.sort((n,r)=>p(n.start).diff(p(r.start)))?.[0]}const ir=({data:e})=>{let[o]=E(De);if(e.title!=="Journal"){const[k]=E(Te);o=k.get(e.title)}const[a,n]=x.exports.useState(!1),r=ce(),s=Mt(),i=lr(e),l=o?.tasks?.withTime.concat(o?.tasks?.noTime),{todo:d,doing:c,done:m,waiting:u,canceled:h}=ge(l),w=c.length,D=d.length,A=m.length,q=u.length,C=h.length,v=w+D+A+q,y=v===0?0:A/v,b=async k=>{const{id:S,originalName:L}=k?.raw?.page||{};let I=L;I||(I=(await de({id:S}))?.originalName),logseq.Editor.scrollToBlockInPage(I,k?.raw?.uuid),logseq.hideMainUI()},T=async()=>{const k=e.id;s(`/project/${encodeURIComponent(k)}`)};return g("div",{className:N(B.project),children:[g("div",{className:N("flex flex-col flex-1 w-0",B.projectContent,{[B.expand]:a}),children:[g("div",{className:"flex justify-between items-center h-24 p-3",children:[g("div",{className:"h-full flex items-center cursor-pointer",onClick:T,children:[t("div",{className:"w-8 h-8 rounded-full bg-gray-300 flex items-center justify-center text-lg font-medium",style:{backgroundColor:e?.style?.bgColor,color:e?.style?.color},children:Array.from(e.title)?.[0]?.toUpperCase()}),g("div",{className:"ml-3",children:[t("div",{className:"text-lg title-text",children:e.title}),t("div",{className:"mt-1 description-text",children:`doing: ${w} todo: ${D} done: ${A} waiting: ${q} canceled: ${C}`})]})]}),g("div",{className:"h-full flex items-center",children:[t("div",{style:{width:"4.375rem"},children:t(uo,{progress:parseInt(""+y*100),uniqueId:e.id,height:70,type:"normal"})}),i&&g("div",{className:N("flex flex-col items-center justify-center d h-full pl-3 pr-1 ml-3 cursor-pointer",B.milestone),onClick:()=>b(i),children:[g("div",{className:"text-center",children:[t("span",{className:"text-3xl title-text",children:p(i.start).format("DD")}),t("span",{className:"text-xs description-text ml-1",children:p(i.start).format("MMM")})]}),g("span",{className:"text-xs description-text",children:["days left: ",p(i.start).diff(p(),"day"),"d"]}),t("span",{className:"text-xs description-text ellipsis w-full text-center",title:i.title,children:i.title})]})]})]}),t(Yo,{children:a&&t(Ho.div,{className:N(B.timeline,{[B.showTimeline]:a}),initial:{opacity:0,height:0},animate:{opacity:1,height:"auto",marginTop:"0.5rem",padding:"0.75rem"},exit:{opacity:0,height:0,marginTop:0,padding:0},transition:{ease:"easeInOut",duration:.2},children:t(nt,{data:[e],weekStartDay:0,showOptions:!1,showSidebar:!1,defaultView:"week",theme:r,uniqueId:e?.id})})})]}),t("div",{className:N(B.option,"text w-10 h-10 rounded-full flex justify-center items-center shadow-sm text-lg ml-3 cursor-pointer"),onClick:()=>n(!a),children:t("div",{className:"flex items-center",children:a?t(Pt,{}):t(qt,{})})})]})};function dr(e,o=!1){const a=e?.addOns.start,n=e?.addOns.end,r=p(a),s=p(n),i=r.isSame(s,"day");return o?e.addOns.allDay?i?{start:r.format("MM-DD")}:{start:r.format("MM-DD"),end:s.format("MM-DD")}:i&&r.isSame(p(),"day")?{start:r.format("HH:mm"),end:s.format("HH:mm")}:i?{start:r.format("MM-DD")}:{start:r.format("MM-DD"),end:s.format("MM-DD")}:i?e.addOns.allDay?{start:"all-day"}:{start:r.format("HH:mm"),end:s.format("HH:mm")}:{start:r.format("MM-DD"),end:s.format("MM-DD")}}const Dt=({task:e,showTimeDot:o=!1,type:a="allDay"})=>{const n=p(e.addOns.start),r=p(e.addOns.end),s=a!=="overdue"&&p().isBetween(n,r),i=e?.addOns.status==="done",l=e.addOns.calendarConfig,{start:d,end:c}=dr(e,a==="overdue");return g("div",{className:N(B.task,{[B.taskActive]:s,[B.taskDone]:i},B?.[a],"flex pl-5 pr-4 py-2 items-center justify-between"),children:[o&&t("div",{className:N(B.time),children:t("span",{children:n?.format("HH:mm")})}),t("div",{className:"w-7 h-7 rounded-full flex items-center justify-center",style:{backgroundColor:l?.bgColor,color:l?.textColor},title:l?.id,children:Array.from(l?.id)?.[0]?.toUpperCase()}),g("div",{className:"flex flex-col flex-1 ellipsis mx-4",children:[t("span",{className:"ellipsis text",children:e.addOns.showTitle}),g("div",{className:N(B.sub,"text-xs flex justify-between"),children:[t("span",{className:"description-text",children:c?`${d} - ${c}`:d}),t("span",{className:"ml-2 ellipsis #6b531a",title:l?.id,children:l?.id})]})]}),t("div",{className:"w-5 h-5 cursor-pointer text",onClick:async()=>{const{id:m,originalName:u}=e?.page||{};let h=u;h||(h=(await de({id:m}))?.originalName),logseq.Editor.scrollToBlockInPage(h,e.uuid),logseq.hideMainUI()},children:t(jt,{})})]})},xo=J([]),rt=J([]),Co=J(e=>e(rt).filter(a=>{const n=p(a.start),r=p(a.end);return p().isBetween(n,r,"day","[]")}).sort((a,n)=>p(a.start).diff(p(n.start))));function cr(e){const o=e?.start,a=e?.end,n=p(o),r=p(a);return n.isSame(r,"day")?e.isAllDay?{start:"all-day"}:{start:n.format("HH:mm"),end:r.format("HH:mm")}:{start:n.format("MM-DD"),end:r.format("MM-DD")}}const Do=({subscription:e,showTimeDot:o=!1,type:a="allDay"})=>{const n=p(e.start),r=p(e.end),s=a!=="overdue"&&p().isBetween(n,r),{start:i,end:l}=cr(e);return g("div",{className:N(B.task,{[B.taskActive]:s},B?.[a],"flex pl-5 pr-4 py-2 items-center justify-between"),children:[o&&t("div",{className:N(B.time),children:t("span",{children:n?.format("HH:mm")})}),t("div",{className:"w-7 h-7 rounded-full flex items-center justify-center",style:{backgroundColor:e?.bgColor,color:e?.color},title:e.calendarId,children:Array.from(e.calendarId)?.[0]?.toUpperCase()}),g("div",{className:"flex flex-col flex-1 ellipsis mx-4",children:[t("span",{className:"ellipsis text",children:e.title}),g("div",{className:N(B.sub,"text-xs flex justify-between"),children:[t("span",{className:"description-text",children:l?`${i} - ${l}`:i}),t("span",{className:"ml-2 ellipsis #6b531a",title:e.calendarId,children:e.calendarId})]})]})]})},ur=()=>{const[e]=E(Co),{allDaySubscriptions:o,timeSubscriptions:a}=ao(e),[n]=E(et),{overdueTasks:r,allDayTasks:s,timeTasks:i}=oo(n);return g("div",{className:B.taskLine,children:[r.length>0&&g("div",{className:B.module,children:[t("span",{children:"Overdue"}),r.map(l=>t(Dt,{task:l,type:"overdue"},l.id))]}),(s.length>0||o.length>0)&&g("div",{className:B.module,children:[t("span",{children:"All Day"}),o.map(l=>t(Do,{subscription:l,type:"allDay"},l.id)),s.map(l=>t(Dt,{task:l,type:"allDay"},l.id))]}),(i.length>0||a.length>0)&&g("div",{className:B.module,children:[t("span",{children:"Time"}),a.map(l=>t(Do,{subscription:l,type:"time",showTimeDot:!0},l.id)),i.map(l=>t(Dt,{task:l,type:"time",showTimeDot:!0},l.id))]})]})};function mr(){const[e]=E(Nn),o=Ka(ge(e)?.done),a=p().subtract(13,"day").startOf("day"),n=[a];for(let r=1;r<14;r++)n.push(a.add(r,"day"));return n.map(r=>{const s=o.get(r.format());return{date:r.format(),value:s?.length||0}})}const pr=()=>{const e=mr(),[o]=E(tt),a=o||[],[n]=E(et),r=ge(n),s=r?.todo?.length+r?.doing?.length,i=r?.done?.length,l=s+i,d=l===0?0:parseInt(i/l*100+""),c=async()=>{const{preferredDateFormat:m}=await logseq.App.getUserConfigs(),u=X(te(p().format("YYYY-MM-DD"),qe,new Date),m);logseq.App.pushState("page",{name:u}),logseq.hideMainUI()};return g("div",{className:"page-container flex",children:[g("div",{className:N(B.content,"flex flex-col flex-1 p-8"),children:[t("h1",{className:"title-text",children:"Dashboard"}),g("div",{className:"flex-1 overflow-auto",children:[g("div",{className:N(B.stats,"flex"),children:[t("div",{className:"flex-1",children:t(Dn,{data:e})}),g("div",{style:{width:"160px"},className:N("h-full rounded-xl shadow-sm cursor-pointer",B.statsRight),onClick:c,children:[t(uo,{progress:d}),g("div",{className:"flex justify-between px-6",children:[g("div",{className:N("flex flex-col rounded-lg text-center py-1 shadow-sm",B.amount),children:[t("span",{className:"text-3xl title-text",children:s}),t("span",{className:"text",children:"Todo"})]}),g("div",{className:N("flex flex-col rounded-lg text-center py-1 shadow-sm",B.amount),children:[t("span",{className:"text-3xl title-text",children:i}),t("span",{className:"text",children:"Done"})]})]})]})]}),t("div",{className:"mt-8",children:a.map(m=>t(ir,{data:m},m.id))})]})]}),t("div",{className:B.rightSide,children:t(ur,{})})]})},To=({visible:e,initialValues:o,onCancel:a,onSave:n,type:r="create",calendar:s,showKeepRef:i})=>{const[l,d]=x.exports.useState(!o?.isAllDay),{defaultDuration:c,projectList:m=[],journal:u}=j(),h=o?.calendarId==="Journal";let D=!m.some(({id:y})=>y===o?.calendarId)&&!h&&r==="update"?[u,{id:o?.calendarId,...Ke},...m]:[u,...m];const[A]=f.useForm();return t(se,{title:"Modify Schedule",visible:e,onOk:()=>{A.validateFields().then(async y=>{const{title:b,start:T,end:k,isAllDay:S,calendarId:L}=y,I=p(T).format("HH:mm"),O=p(k).format("HH:mm"),P=j();let R=D.find(({id:_})=>_===L.value)?.id==="Journal"?"journal":"project";const Z=R==="journal";if(p(T).isAfter(p(k),S?"day":void 0))return logseq.App.showMsg("Start time cannot be later than end time","error");if(Z&&!p(T).isSame(p(k),"day"))return logseq.App.showMsg("Journal schedule cannot span multiple days","error");const Ae=o?.raw?.format==="markdown"?We:Ge;let Y=r==="update"&&o?.raw?.addOns.pomodoros?.length?`${b} ${o?.raw?.content.match(Ae)?.[0]}`:b;R==="journal"?(r==="create"&&(Y=S?`TODO ${Y}`:`TODO ${I}-${O} ${Y}`),r==="update"&&(Y=S?Ve(o?.raw,Y):Ve(o?.raw,Va(Y,I,O)))):R==="project"&&(r==="create"?Y="TODO "+gt(Y,{start:T,end:k,allDay:S}):r==="update"&&(Y=Ve(o?.raw,gt(Y,{start:T,end:k,allDay:S}))));const G={},{preferredDateFormat:ye}=await logseq.App.getUserConfigs();let Se=o?.calendarId;if(Z){const _=o?.start;_&&(Se=X(_?.valueOf(),ye))}let ee=L.value;if(Z){const _=X(T.valueOf(),ye),F=await logseq.Editor.createPage(_,{},{journal:!0});F&&(ee=F.originalName)}if(r==="create"){const _=logseq.settings?.logKey;let F;if(Z?F=_?.enabled?await so(ee,`[[${_?.id}]]`,Y,G):await logseq.Editor.insertBlock(ee,Y,{isPageBlock:!0,sibling:!0,properties:G}):R==="project"&&(F=await so(ee,Gt,Y)),!F)return logseq.App.showMsg("Create block failed","error");const me=await logseq.Editor.getBlock(F.uuid),pe=await oe(me,P),we=pe?.addOns?.type==="milestone"?Xe(pe):Ze(pe);s?.createSchedules([we])}else if(ee!==Se){let _;const F=logseq.settings?.logKey;if(Z?_=F?.enabled?await ft(o?.id,ee,`[[${F?.id}]]`):await ro(o?.id,ee):R==="project"&&(_=await ft(o?.id,ee,Gt)),await no(_.uuid,Y,G),Object.keys(G).length===0&&(await logseq.Editor.removeBlockProperty(_.uuid,"start"),await logseq.Editor.removeBlockProperty(_.uuid,"end")),_&&o?.calendarId){const me=await logseq.Editor.getBlock(_.uuid);s?.deleteSchedule(o?.id,o.calendarId);const pe=await oe(me,P),we=o?.raw?.addOns.type==="milestone"?Xe(pe):Ze(pe);s?.createSchedules([we])}}else{await no(o?.id,Y);const _=await logseq.Editor.getBlock(o?.id),F=await oe(_,P),me=o?.raw?.addOns.type==="task"?Ze(F):Xe(F);s?.updateSchedule(o?.id,o?.calendarId,me)}n?.()})},onCancel:()=>{a?.()},children:g(f,{form:A,onValuesChange:(y,b)=>{y.isAllDay!==void 0&&d(!y.isAllDay),y.start!==void 0&&A.setFieldsValue({end:y.start?.clone().add(c.value,c.unit)})},initialValues:{isAllDay:!0,...o,calendarId:o?.calendarId?{value:o?.calendarId}:void 0},children:[t(f.Item,{name:"calendarId",label:"Project",rules:[{required:!0}],children:t(H,{labelInValue:!0,children:D.map(y=>g(H.Option,{value:y?.id,children:[t("span",{style:{width:"12px",height:"12px",display:"inline-block",backgroundColor:y?.bgColor,verticalAlign:"middle",marginRight:"5px",borderRadius:"4px"}}),y?.id]},y?.id))})}),t(f.Item,{name:"title",label:"Schedule Title",rules:[{required:!0}],children:t(V,{})}),t(f.Item,{name:"start",label:"Start",rules:[{required:!0}],children:t(Re,{showTime:l?{format:"HH:mm",minuteStep:5}:!1,format:l?"YYYY-MM-DD HH:mm":"YYYY-MM-DD"})}),t(f.Item,{name:"end",label:"End",rules:[{required:!0}],children:t(Re,{showTime:l?{format:"HH:mm",minuteStep:5}:!1,format:l?"YYYY-MM-DD HH:mm":"YYYY-MM-DD"})}),t(f.Item,{name:"isAllDay",label:"All Day",rules:[{required:!0}],children:g(W.Group,{children:[t(W,{value:!0,children:"Yes"}),t(W,{value:!1,children:"No"})]})})]})})},Tt=({checked:e,color:o,indeterminate:a,onChange:n,children:r,...s})=>g("div",{onClick:()=>n?.(!e),...s,children:[t("span",{className:`check-box mr-2 ${e?"checked":""}`,style:{backgroundColor:o}}),r]}),hr=({onShowCalendarChange:e,calendarList:o=[],subscriptionList:a=[]})=>{const[n,r]=x.exports.useState(["calendar","subscription"]),[s,i]=x.exports.useState(o.map(m=>m.id)?.concat(a?.map(m=>m.id))),l=(m,u)=>{let h=s.filter(w=>w!==m);u&&(h=s.concat(m)),i(h),e?.(h)},d=m=>{let u=[];m&&(u=o.map(h=>h.id)?.concat(a?.map(h=>h.id))),i(u),e?.(u)},c=m=>t("span",{className:"text text-xs",children:m});return g("div",{className:"sidebar pt-2 bg-quaternary",children:[g(le,{ghost:!0,expandIconPosition:"right",activeKey:n,expandIcon:({isActive:m})=>t("span",{className:"opacity-50",children:t(Fo,{rotate:m?0:-90})}),onChange:m=>r(typeof m=="string"?[m]:m),children:[t(le.Panel,{header:c("Project"),children:o.map(m=>t(Tt,{className:"mb-1 cursor-pointer flex items-center",color:m.bgColor,checked:s?.includes(m.id),onChange:u=>l(m.id,u),children:t(Oe,{title:m.id,placement:"right",children:t("span",{className:"singlge-line-ellipsis flex-1",children:m.id})})},m.id))},"calendar"),a?.length>0&&t(le.Panel,{header:c("Subscription"),className:"mt-3",children:a.map(m=>t(Tt,{className:"mb-1 cursor-pointer flex items-center",color:m.bgColor,checked:s?.includes(m.id),onChange:u=>l(m.id,u),children:t(Oe,{title:m.id,placement:"right",children:t("span",{className:"singlge-line-ellipsis flex-1",children:m.id})})},m.id))},"subscription")]}),t(Bt,{className:"my-2"}),t("div",{style:{padding:"0 10px"},children:t(Tt,{color:"#047857",checked:s?.length===o.length+a?.length,onChange:m=>d(m),children:t("span",{className:"cursor-pointer",children:"Check All"})})})]})},At=({schedules:e,isProjectCalendar:o=!0,isDailyLogCalendar:a=!1})=>{const{subscriptionList:n,logKey:r,projectList:s=[],journal:i}=j(),[l,d]=x.exports.useState(),[c,m]=x.exports.useState(!0),[u,h]=x.exports.useState(()=>a?"week":logseq.settings?.defaultView||"month"),w=[i,...s],D=n?n?.filter(O=>O?.enabled):[],[A,q]=x.exports.useState({visible:!1,type:"create"}),C=x.exports.useRef(),v=()=>{if(C.current){const O=C.current.getDateRangeStart().getTime(),P=C.current.getDateRangeEnd().getTime();Qo(O,P)?d(X(O,qe)):d(X(O,qe)+" ~ "+X(P,qe))}},y=O=>{h(O),O==="2week"?(C.current?.changeView("month"),C.current?.setOptions({month:{visibleWeeksCount:2}})):O==="month"?(C.current?.changeView("month"),C.current?.setOptions({month:{visibleWeeksCount:void 0}})):C.current?.changeView(O),v()},b=O=>{(w.concat(D)?.map(M=>M.id)).forEach(M=>{O.includes(M)?C.current?.toggleSchedules(M,!1):C.current?.toggleSchedules(M,!0)})},T=()=>m(O=>!O),k=()=>{C.current?.today(),v()},S=()=>{C.current?.prev(),v()},L=()=>{C.current?.next(),v()},I=async()=>{if(u==="day"&&l){const{preferredDateFormat:O}=await logseq.App.getUserConfigs(),P=X(te(l,qe,new Date),O);logseq.App.pushState("page",{name:P}),logseq.hideMainUI()}};return x.exports.useEffect(()=>{C.current&&(C.current.clear(),C.current.createSchedules(e))},[e,C.current]),x.exports.useEffect(()=>{window.requestAnimationFrame(async()=>{let O=await nn();a&&(O=rn(O)),C.current=new $o("#calendar",{...O}),v(),C.current.on("clickDayname",function(P){const M=C.current;M?.getViewName()==="week"&&(M.setDate(new Date(P.date)),M.changeView("day",!0),v(),h("day"))}),C.current.on("clickSchedule",function(P){document.querySelector("#faiz-nav-detail")?.addEventListener("click",async M=>{const R=P.schedule.raw||{},{id:Z,originalName:Ae}=R?.page||{};let Y=Ae;Y||(Y=(await logseq.Editor.getPage(Z))?.originalName);const{uuid:G}=await logseq.Editor.getBlock(R.id)||{uuid:""};logseq.Editor.scrollToBlockInPage(Y,G),logseq.hideMainUI()},{once:!0})}),C.current.on("beforeCreateSchedule",function(P){q({visible:!0,type:"create",values:{start:p(P.start),end:p(P.end),isAllDay:P.triggerEventName==="dblclick"}})}),C.current.on("beforeUpdateSchedule",async function(P){const{schedule:M,changes:R,triggerEventName:Z,start:Ae,end:Y}=P;if(Z==="click")q({visible:!0,type:"update",values:{id:M.id,start:p(M.start),end:p(M.end),isAllDay:M?.raw?.category!=="time",calendarId:M.calendarId,title:M.title,raw:M.raw}});else if(R){if(M.calendarId==="journal"&&!p(Ae).isSame(p(Y),"day"))return logseq.App.showMsg("Journal schedule cannot span multiple days","error");const G=M.raw,ye=M.calendarId==="Journal"?"journal":"project",Se=R?.start?R.start:G.rawTime?.start,ee=R?.end?R.end:G.rawTime?.end;if(ye==="journal"&&R.start){C.current?.updateSchedule(M.id,M.calendarId,R);const{preferredDateFormat:_}=await logseq.App.getUserConfigs();let F=G.content;if(G.rawTime?.timeFrom==="customLink"&&(F=to(F.trim())),G.rawTime?.timeFrom==="refs"){const Lo=X(p(G.rawTime.start).valueOf(),_);F=F.replace(`[[${Lo}]]`,"")?.trim()}const me=X(Se.valueOf(),_),we=(await logseq.Editor.createPage(me,{},{journal:!0})).originalName;await logseq.Editor.updateBlock(M.id,F),r?.enabled?await ft(M?.id,we,`[[${r?.id}]]`):await ro(M?.id,we)}else if(ye==="project"){C.current?.updateSchedule(M.id,M.calendarId,R);const _=Ve(G,gt(G.addOns.contentWithoutTime,{start:p(Se),end:p(ee),allDay:G.addOns.allDay}))?.split(`
`)?.[0];await logseq.Editor.updateBlock(M.id,_)}}}),C.current.on("beforeDeleteSchedule",function(P){const{schedule:M}=P;se.confirm({title:"Are you sure delete this schedule?",content:t("div",{className:"whitespace-pre-line",children:M.raw?.content}),onOk:async()=>{const R=await logseq.Editor.getBlock(M.raw?.id);if(!R)return logseq.App.showMsg("Block not found","error");logseq.Editor.removeBlock(R?.uuid),C.current?.deleteSchedule(M.id,M.calendarId)}})})})},[]),g("div",{className:"flex flex-col w-full h-full",children:[g("div",{className:"mb-2 flex items-center justify-between",children:[g("div",{className:"flex items-center",children:[!o&&!a&&t(U,{className:"mr-2",onClick:T,icon:c?t(Uo,{}):t(Wo,{})}),t(U,{className:"ml-2",shape:"circle",icon:t(Go,{}),onClick:S}),t(U,{className:"ml-1",shape:"circle",icon:t(zo,{}),onClick:L}),t(U,{className:"ml-2",shape:"round",onClick:k,children:"Today"}),t(Oe,{title:u==="day"?"Navigate to this journal note":"",children:t("span",{className:`ml-4 text-xl h-full items-center inline-block title-text ${u==="day"?"cursor-pointer":"cursor-auto"}`,style:{height:"34px",lineHeight:"34px"},onClick:I,children:l})})]}),t("div",{children:t(W.Group,{options:Ut,value:u,defaultValue:logseq.settings?.defaultView||"month",onChange:O=>y(O.target.value),optionType:"button",buttonStyle:"solid"})})]}),g("div",{className:"flex flex-1",children:[t("div",{className:`transition-all overflow-hidden bg-quaternary title-text mr-2 ${c?"w-0 mr-0":"w-40"}`,children:t(hr,{onShowCalendarChange:b,calendarList:w,subscriptionList:D})}),t("div",{className:"flex-1 w-0",children:t("div",{id:"calendar",className:"h-full title-text"})})]}),A.visible?t(To,{visible:A.visible,type:A.type,initialValues:A.values,calendar:C.current,onCancel:()=>{q({visible:!1}),C.current?.render()},onSave:()=>{q({visible:!1})}}):null]})},gr="_container_1ypzn_1",fr="_sideBar_1ypzn_5";var yr={container:gr,sideBar:fr};const wr=()=>{const[e]=E(xt),[o]=E(rt),[a,n]=x.exports.useState([]);return x.exports.useEffect(()=>{za().then(r=>{n(r)})},[]),t("div",{className:"page-container flex",children:g("div",{className:N(yr.content,"flex flex-1 flex-col overflow-hidden p-8"),style:{maxWidth:"1800px"},children:[t("h1",{className:"title-text",children:"Calendar"}),t("div",{className:"bg-quaternary flex flex-col flex-1 rounded-2xl box-border p-6",children:t(At,{schedules:[...o,...e,...a],isProjectCalendar:!1})})]})})},br="_contentWrapper_42y1q_1",kr="_timelineWrapper_42y1q_7";var Ao={contentWrapper:br,timelineWrapper:kr};const vr=({projects:e})=>{const o=ce();return t("div",{className:N(Ao.timelineWrapper,"h-full p-6"),children:t(nt,{data:e,weekStartDay:logseq.settings?.weekStartDay||0,theme:o,defaultMode:"advanced",uniqueId:mt()})})},xr=()=>{const[e]=E(tt),o=e||[];return g("div",{className:"page-container p-8 flex flex-col",children:[t("h1",{className:"title-text",children:"Gantt"}),t("div",{className:N(Ao.contentWrapper,"shadow rounded-2xl"),children:t(vr,{projects:o})})]})},Cr="_contentWrapper_42y1q_1",Dr="_timelineWrapper_42y1q_7";var So={contentWrapper:Cr,timelineWrapper:Dr};const Tr=({projects:e})=>{const o=ce();return t("div",{className:N(So.timelineWrapper,"h-full p-6"),children:t(nt,{data:e,weekStartDay:logseq.settings?.weekStartDay||0,theme:o,uniqueId:mt()})})},Ar=()=>{const[e]=E(tt),o=e||[];return g("div",{className:"page-container p-8 flex flex-col",children:[t("h1",{className:"title-text",children:"Timeline"}),t("div",{className:N(So.contentWrapper,"shadow rounded-2xl"),children:t(Tr,{projects:o})})]})},z=({value:e,onChange:o,text:a})=>{const[n,r]=x.exports.useState(!1);return g("div",{children:[t("span",{style:{backgroundColor:e},className:"px-2 py-1 rounded cursor-pointer shadow-md",onClick:()=>r(!0),children:a}),n&&g(re,{children:[t("div",{className:"bg-transparent fixed top-0 left-0 w-screen h-screen",onClick:()=>r(!1)}),t("div",{className:"fixed z-10 mt-2",children:t(Jo,{color:e,onChange:i=>{const l=i.rgb,d=`rgba(${l.r}, ${l.g}, ${l.b}, ${l.a})`;o?.(d)}})})]})]})},Sr=({visible:e,calendarId:o,initialValues:a,onCancel:n,onOk:r,...s})=>{const[i]=f.useForm(),l=()=>{const c=i.getFieldsValue(!0);r?.(c?.query)},d=async c=>{const m=i.getFieldsValue(!0)?.query[c];if(m){console.log(""),ve(`[faiz:] === start exec your query:
`,"blue"),console.log(m?.script);try{let u;m?.queryType==="simple"?u=await logseq.DB.q(m?.script):u=await logseq.DB.datascriptQuery(m.script),ve(`[faiz:] === exec your query success:
`,"green"),console.log(u)}catch(u){ve(`[faiz:] === exec your query failed:
`,"red"),console.error(u)}console.log("")}};return t(se,{...s,width:980,title:"Calendar Queries (saved searches)",visible:e,onCancel:n,onOk:l,children:t("div",{className:"overflow-y-auto overflow-x-hidden",style:{maxHeight:"500px"},children:t(f,{initialValues:{query:a},form:i,size:"small",children:t(f.List,{name:"query",children:(c,{add:m,remove:u})=>g(re,{children:[c.map((h,w)=>g("div",{className:"rounded border-dashed border-gray-200 px-4 pt-4 mb-3 relative",children:[t(f.Item,{label:`Query ${w+1}`,children:g(Lt,{gutter:16,children:[t(it,{span:12,children:t(f.Item,{label:"script",name:[h.name,"script"],labelCol:{span:4},children:t(V.TextArea,{rows:10})})}),g(it,{span:12,children:[t(f.Item,{label:"Query Type",name:[h.name,"queryType"],labelCol:{span:7},children:g(W.Group,{children:[t(W,{value:"simple",children:"Simple Query"}),t(W,{value:"advanced",children:"Advanced Query"})]})}),t(f.Item,{label:"Schedule Start",name:[h.name,"scheduleStart"],labelCol:{span:7},children:t(V,{})}),t(f.Item,{label:"Schedule End",name:[h.name,"scheduleEnd"],labelCol:{span:7},children:t(V,{})}),t(f.Item,{label:"Date Formatter",name:[h.name,"dateFormatter"],labelCol:{span:7},children:t(V,{})}),t(f.Item,{label:"Is Milestone",name:[h.name,"isMilestone"],labelCol:{span:7},children:g(W.Group,{children:[t(W,{value:!0,children:"Yes"}),t(W,{value:!1,children:"No"})]})})]})]})}),g("div",{className:"absolute bottom-4 right-4",children:[t(Oe,{title:"Execute this query in DevTools",children:t(Vo,{onClick:()=>d(w)})}),w!==0&&t(Ye,{className:"ml-2",onClick:()=>u(h.name)})]})]},w)),t(f.Item,{children:t(U,{type:"dashed",size:"small",onClick:()=>m(),block:!0,icon:t(Ne,{}),children:"Add Schedule Query"})})]})})})})})},Oo=({value:e,onChange:o,calendarId:a})=>{const[n,r]=x.exports.useState(!1);return g("div",{children:[t(Oe,{title:"Edit Calendar Queries",children:t(U,{type:"link",icon:t(Ko,{}),onClick:()=>r(!0)})}),t(Sr,{visible:n,calendarId:a,initialValues:e,onCancel:()=>r(!1),onOk:s=>{o?.(s),r(!1)}})]})},Or=({visible:e,onCancel:o,onSave:a})=>{const[n]=f.useForm(),r=async s=>await de({originalName:s})?(logseq.App.showMsg(`The page with the same name already exists
Please add properties to the page manually
agenda:: true`,"error"),{success:!0}):(await logseq.Editor.createPage(s,{agenda:!0}),{success:!0});return t(se,{title:"Create Calendar",visible:e,onOk:()=>{n.validateFields().then(async s=>{const i=s.calendarId.trim();if(s.agenda){const{success:l}=await r(i);if(!l)return}a({name:i,agenda:Boolean(s.agenda)})})},onCancel:o,children:g(f,{form:n,children:[t(f.Item,{name:"calendarId",label:"Calendar ID",rules:[{required:!0}],children:t(V,{})}),t(f.Item,{name:"agenda",label:"Control By Agenda",tooltip:"Checking means that the plugin may modify this document",extra:"Not recommended, please use project instead",children:g(W.Group,{children:[t(W,{value:!0,children:"Yes"}),t(W,{value:!1,children:"No"})]})})]})})},Nr=J(j()),No=async(e,o)=>{if(!Array.isArray(e))return[];const a=e?.filter(l=>l?.enabled);if(!a?.length)return[];const r=(await Promise.allSettled(a.map(l=>Zo.get(l.url,{headers:{accept:"text/calendar"}})))).map(async(l,d)=>{if(l.status==="rejected")return logseq.App.showMsg(`Get Calendar ${a[d].id} data error
${l.reason}`,"error"),[];try{const c=Xo.parse(l.value.data),{events:m}=Mr(c),u=m.map(async h=>{const{dtstart:w,dtend:D,summary:A,description:q}=h,C=w.type==="date-time";let v=D?.value||w.value;if(!C){const y=p(v).subtract(1,"day").endOf("day");y.isSameOrAfter(p(w?.value),"day")&&(v=y.format())}return await ht({blockData:{id:new Date().valueOf(),content:`${A?.value||"no summary"}
${q?.value||""}`,subscription:!0},category:C?"time":"allday",start:w.value,end:v,calendarConfig:a[d],defaultDuration:o,isAllDay:!C})});return Promise.all(u)}catch(c){return logseq.App.showMsg(`Parse Calendar ${a[d].id} data error
${c}`,"error"),console.error("[faiz:] === Parse Calendar error",c),[]}});return(await Promise.allSettled(r)).filter(l=>l?.status==="fulfilled").map(l=>l?.value)?.flat()},Mr=e=>{function o(i){return i.reduce((l,d)=>({...l,[d[0]]:{type:d[2],value:d[3]}}),{})}const[a,n,r]=e,s=r.filter(i=>i[0]==="vevent").map(i=>{const[l,d]=i;return o(d)});return{type:a,info:o(n),events:s}},Ir="_title_8pzto_1",Er="_content_8pzto_4",qr="_formBlock_8pzto_8",Pr="_show_8pzto_14",jr="_tabs_8pzto_19",Br="_tab_8pzto_19",Lr="_active_8pzto_27";var $={title:Ir,content:Er,formBlock:qr,show:Pr,tabs:jr,tab:Br,active:Lr};const _r=({value:e,tabs:o,onChange:a})=>{const n=e;return t("div",{className:$.tabs,children:o.map(({value:r,label:s})=>t("div",{className:N($.tab,{[$.active]:n===r}),onClick:()=>a?.(r),children:s},r))})},Be={4:"A",3:"B",2:"C",1:void 0};let Q=null;const St=e=>{if(Q&&!e)return Q;if(e)return Q=new _t.TodoistApi(e);const{todoist:o}=j();if(o?.token)return Q=new _t.TodoistApi(o.token)},Rr=async()=>{if(ve(`
=== Start synchronizing tasks from todoist ... ===
`,"#d27e24"),!Q)return logseq.App.showMsg("Please check your todoist configuration","error");const e=j(),{preferredDateFormat:o}=await logseq.App.getUserConfigs(),{todoist:a}=e;let n=[];a?.sync===1?(a.project||logseq.UI.showMsg("Missing project, cannot sync using the project sync option","error"),n=await Q.getTasks({projectId:a.project})):a?.sync===2&&a.filter?(a.filter||logseq.UI.showMsg("Missing filter, cannot sync using the filter sync option","error"),n=await Q.getTasks({filter:a.filter})):n=await Q.getTasks();const r=await Wr(),s=await Promise.all(r?.map(u=>oe(u,e))||[]);console.info("[faiz: pull totoist] === todoist active tasks:",n),console.info("[faiz: pull totoist] === exists logseq events:",s);let i=[],l=[];n.forEach(u=>{const h=s.find(w=>w.properties?.todoistId===u.id);if(!h)return l.push(u);if(Gr(h,u))return i.push({...h,todoistTask:u})});const d=s.filter(u=>u.addOns.status!=="done").filter(u=>!n.find(h=>h.id===u.properties?.todoistId)).map(async u=>({...u,todoistTask:await Q?.getTask(u.properties?.todoistId)})),m=(await Promise.allSettled(d)).map(u=>u.status==="rejected"?null:u.value).filter(Boolean);i=[...i,...m],l.forEach(u=>zr(u,o)),i.forEach(u=>Mo(u,u.todoistTask)),logseq.App.showMsg(`Get todoist data successfully:
${l.length} new tasks created
${i.length} tasks updated`),ve(`
=== Synchronizing tasks from todoist success ===
`,"green")},Yr=(e,o)=>Q?.updateTask(e,o),Hr=e=>Q?.getTask(e),Fr=e=>Q?.closeTask(e),$r=e=>Q?.reopenTask(e),Ur=e=>Q?.addTask(e),Wr=async()=>{const e="(and (task todo doing done waiting canceled later now) (property todoist-id))";return logseq.DB.q(e)},Gr=(e,o)=>{const a=e.addOns.status==="done",n=e.rawTime?p(e.rawTime?.start).valueOf():void 0,r=e.addOns.contentWithoutTime?.split(`
`)[0],s=e.properties?.todoistDesc||"",i=e.priority,{completed:l,due:d,content:c,priority:m,description:u=""}=o;let h=d?d?.datetime?p(d?.datetime).valueOf():p(d.date).valueOf():void 0;return a!==l||r!==c||s!==u||n!==h||i!==Be[m]},zr=async(e,o)=>{const{todoist:a}=j(),n=e.due?.datetime||e.due?.date;let r;if(a?.position)r=await logseq.Editor.getPage(a.position);else{const d=X(p().valueOf(),o);r=await logseq.Editor.createPage(d,{},{journal:!0})}let s=e.content;const i=Be[e.priority];if(i&&(s=`[#${i}] ${s}`),s=`TODO ${s}`,n){const d=e.due?.datetime?"YYYY-MM-DD ddd HH:mm":"YYYY-MM-DD ddd";s+=`
SCHEDULED: <${p(n).format(d)}>`}const l=e?.description?.split(`
`)[0]||"";return logseq.Editor.insertBlock(r.originalName,s,{isPageBlock:!0,sibling:!0,properties:{"todoist-id":e.id,"todoist-desc":l}})},Mo=async(e,o)=>{if(!o)return;let a=o.content;const n=Be[o.priority];n&&(a=`[#${n}] ${a}`),a=`${o.completed?"DONE":"TODO"} ${a}`;const r=o.due?.datetime||o.due?.date;if(r){const i=o.due?.datetime?"YYYY-MM-DD ddd HH:mm":"YYYY-MM-DD ddd";a+=`
SCHEDULED: <${p(r).format(i)}>`}const s=o?.description?.split(`
`)[0]||"";return await logseq.Editor.updateBlock(e.uuid,a),await logseq.Editor.upsertBlockProperty(e.uuid,"todoist-desc",s),logseq.Editor.upsertBlockProperty(e.uuid,"todoist-id",o.id)},Io=[{value:"basis",label:"Basis"},{value:"projects",label:"Project"},{value:"customCalendar",label:"Custom Calendar"},{value:"subscription",label:"Subscription"},{value:"calendarView",label:"Calendar View"},{value:"pomodoro",label:"Pomodoro"},{value:"todoist",label:"Todoist"}],Qr=({...e})=>{const[o]=ea.useForm(),[a,n]=x.exports.useState(Io[0].value),[r,s]=x.exports.useState([]),[i,l]=x.exports.useState([]),[d,c]=x.exports.useState([]),[m,u]=x.exports.useState(!1),h=j({filterInvalideProject:!1}),[,w]=E(rt),[,D]=E(Nr),A=y=>{n(y)},q=({name:y,agenda:b=!1})=>{const T=[...o.getFieldValue("calendarList"),b?ln(y):sn(y)];o.setFieldsValue({calendarList:T}),u(!1),C({calendarList:T},o.getFieldsValue(!0))},C=(y,b)=>{if(y.todoist?.token?.length===40){const T=St(y.todoist?.token);v(T)}D(b),logseq.updateSettings({calendarList:1,subscriptionList:1,projectList:1}),logseq.updateSettings({subscriptionList:[],projectList:[],...b,ignoreTag:b.ignoreTag||null}),typeof y.weekStartDay=="number"&&p.updateLocale("en",{weekStart:y.weekStartDay}),setTimeout(async()=>{if((y?.lightThemeType||y.theme)&&Jt(),y?.calendarList,y?.subscriptionList){const{subscriptionList:T}=await j();w(await No(T))}},500)},v=y=>{!y||(y?.getProjects().then(b=>{l(b?.map(T=>({value:T.id,label:T.name})))}),y?.getLabels().then(b=>{c(b?.map(T=>({value:T.id,label:T.name})))}))};return x.exports.useEffect(()=>{logseq.Editor.getAllPages().then(b=>{s(b?.filter(T=>!T?.["journal?"])?.map(T=>({value:T.originalName,label:T.originalName})))});const y=St();v(y)},[]),g("div",{className:"page-container p-8 flex flex-col items-center",children:[t("h1",{className:N($.title,"title-text"),children:"Settings"}),g("div",{className:N($.content,"rounded-2xl flex"),children:[g("div",{className:"flex flex-col justify-between pr-5",children:[t(_r,{value:a,tabs:Io,onChange:A}),t(ta,{title:g("span",{children:["Are you sure you want to restore default settings?",t("br",{}),"This is an irreversible operation."]}),onConfirm:()=>{o.setFieldsValue(K),C(K,K)},children:t(U,{className:"text-left",type:"link",style:{color:"var(--ls-tertiary-background-color)"},children:"Restore Defaults"})})]}),g(f,{initialValues:h,labelCol:{span:4},preserve:!0,form:o,style:{maxWidth:"800px",width:"80%"},onValuesChange:C,className:"relative h-full",children:[g("div",{id:"basis",className:N($.formBlock,{[$.show]:a==="basis"}),children:[t(f.Item,{label:"Theme",name:"theme",children:t(H,{options:_a})}),t(f.Item,{label:"Light Theme Type",name:"lightThemeType",children:t(H,{options:Ra})}),t(f.Item,{label:"Home Page",name:"homePage",children:t(H,{options:st})}),t(f.Item,{label:"Ignore Tag",name:"ignoreTag",children:t(H,{showSearch:!0,allowClear:!0,placeholder:"Project ID (Page Name)",optionFilterProp:"label",style:{width:"300px"},options:r,filterOption:(y,b)=>b?.label?.toLowerCase()?.includes(y?.toLowerCase())})}),t(f.Item,{label:"Default Duration",name:["defaultDuration","value"],children:t(ae,{addonAfter:t(f.Item,{name:["defaultDuration","unit"],noStyle:!0,children:t(H,{style:{width:80},options:Ha})})})}),t(f.Item,{label:"Log Key",tooltip:"Interstitial Journal",children:g("div",{className:"flex items-center justify-between",children:[t(f.Item,{noStyle:!0,name:["logKey","id"],rules:[{required:!0}],children:t(H,{style:{width:"240px"},options:r,showSearch:!0,optionFilterProp:"label",filterOption:(y,b)=>b?.label?.toLowerCase()?.includes(y?.toLowerCase())})}),t(f.Item,{name:["logKey","bgColor"],noStyle:!0,rules:[{required:!0}],children:t(z,{text:"background"})}),t(f.Item,{name:["logKey","textColor"],noStyle:!0,rules:[{required:!0}],children:t(z,{text:"text"})}),t(f.Item,{name:["logKey","borderColor"],noStyle:!0,rules:[{required:!0}],children:t(z,{text:"border"})}),t(f.Item,{name:["logKey","enabled"],noStyle:!0,valuePropName:"checked",children:t(Me,{})})]})}),t(f.Item,{label:"Journal",required:!0,children:g("div",{className:"flex items-center justify-between",children:[t(f.Item,{noStyle:!0,name:["journal","id"],rules:[{required:!0}],children:t(V,{style:{width:"240px"},disabled:!0})}),t(f.Item,{name:["journal","bgColor"],noStyle:!0,rules:[{required:!0}],children:t(z,{text:"background"})}),t(f.Item,{name:["journal","textColor"],noStyle:!0,rules:[{required:!0}],children:t(z,{text:"text"})}),t(f.Item,{name:["journal","borderColor"],noStyle:!0,rules:[{required:!0}],children:t(z,{text:"border"})}),t(f.Item,{name:["journal","query"],rules:[{required:!0}],style:{display:"none"},children:t(Oo,{calendarId:"query"})}),t(f.Item,{name:["journal","enabled"],noStyle:!0,valuePropName:"checked",children:t(Me,{})})]})})]}),t("div",{id:"projects",className:N($.formBlock,{[$.show]:a==="projects"}),children:t(f.List,{name:"projectList",children:(y,{add:b,remove:T,move:k})=>t(re,{children:t(Rt,{onDragEnd:S=>{S?.destination&&k(S.source.index,S.destination.index)},children:t(Yt,{droppableId:"droppable-projects",children:(S,L)=>g("div",{ref:S.innerRef,children:[y.map((I,O)=>t(Ht,{draggableId:`drag ${O}`,index:O,children:(P,M)=>t("div",{ref:P.innerRef,...P.draggableProps,...P.dragHandleProps,children:t(f.Item,{children:g("div",{className:"flex items-center justify-between",children:[t(f.Item,{name:[I.name,"id"],noStyle:!0,rules:[{required:!0}],children:t(H,{showSearch:!0,placeholder:"Project ID (Page Name)",optionFilterProp:"label",style:{width:"300px"},options:r,filterOption:(R,Z)=>Z?.label?.toLowerCase()?.includes(R?.toLowerCase())})}),t(f.Item,{name:[I.name,"bgColor"],noStyle:!0,rules:[{required:!0}],children:t(z,{text:"background"})}),t(f.Item,{name:[I.name,"textColor"],noStyle:!0,rules:[{required:!0}],children:t(z,{text:"text"})}),t(f.Item,{name:[I.name,"borderColor"],noStyle:!0,rules:[{required:!0}],children:t(z,{text:"border"})}),t(f.Item,{name:[I.name,"enabled"],noStyle:!0,valuePropName:"checked",children:t(Me,{})}),t(Ye,{onClick:()=>T(I.name)})]})})})},O)),t(f.Item,{children:t(U,{type:"dashed",onClick:()=>b(Qt),block:!0,icon:t(Ne,{}),children:"Add Project"})})]})})})})})}),g("div",{id:"customCalendar",className:N($.formBlock,{[$.show]:a==="customCalendar"}),children:[t(He,{message:"Do not use this setting unless you need to write your own Query to get the calendar.",type:"warning",className:"mb-6"}),t(f.List,{name:"calendarList",children:(y,{add:b,remove:T,move:k})=>t(re,{children:t(Rt,{onDragEnd:S=>{S?.destination?.index===0||S?.source?.index===0||S?.destination&&k(S.source.index,S.destination.index)},children:t(Yt,{droppableId:"droppable-1",children:(S,L)=>g("div",{ref:S.innerRef,children:[y.map((I,O)=>t(Ht,{draggableId:`drag ${O}`,index:O,children:(P,M)=>t("div",{ref:P.innerRef,...P.draggableProps,...P.dragHandleProps,children:t(f.Item,{children:g("div",{className:"flex items-center justify-between",children:[t(f.Item,{name:[I.name,"id"],noStyle:!0,rules:[{required:!0}],children:t(V,{placeholder:"Calendar ID",style:{width:"300px"}})}),t(f.Item,{name:[I.name,"bgColor"],noStyle:!0,rules:[{required:!0}],children:t(z,{text:"background"})}),t(f.Item,{name:[I.name,"textColor"],noStyle:!0,rules:[{required:!0}],children:t(z,{text:"text"})}),t(f.Item,{name:[I.name,"borderColor"],noStyle:!0,rules:[{required:!0}],children:t(z,{text:"border"})}),t(f.Item,{name:[I.name,"query"],noStyle:!0,rules:[{required:!0}],children:t(Oo,{calendarId:"query"})}),t(f.Item,{name:[I.name,"enabled"],noStyle:!0,valuePropName:"checked",children:t(Me,{})}),t(Ye,{onClick:()=>T(I.name)})]})})})},O)),t(f.Item,{children:t(U,{type:"dashed",onClick:()=>u(!0),block:!0,icon:t(Ne,{}),children:"Add Custom Calendar"})})]})})})})})]}),t("div",{id:"subscription",className:N($.formBlock,{[$.show]:a==="subscription"}),children:t(f.List,{name:"subscriptionList",children:(y,{add:b,remove:T})=>g(re,{children:[y.map((k,S)=>t(f.Item,{label:S===0?"Subscription":"",...S===0?{}:{wrapperCol:{offset:4}},children:g("div",{className:"flex items-center justify-between",children:[t(f.Item,{name:[k.name,"id"],noStyle:!0,rules:[{required:!0}],children:t(V,{placeholder:"Calendar ID",style:{width:"160px"}})}),t(f.Item,{name:[k.name,"url"],noStyle:!0,rules:[{required:!0}],children:t(V,{placeholder:"Url",style:{width:"100px"}})}),t(f.Item,{name:[k.name,"bgColor"],noStyle:!0,rules:[{required:!0}],children:t(z,{text:"background"})}),t(f.Item,{name:[k.name,"textColor"],noStyle:!0,rules:[{required:!0}],children:t(z,{text:"text"})}),t(f.Item,{name:[k.name,"borderColor"],noStyle:!0,rules:[{required:!0}],children:t(z,{text:"border"})}),t(f.Item,{name:[k.name,"enabled"],noStyle:!0,valuePropName:"checked",children:t(Me,{})}),t(Ye,{onClick:()=>T(k.name)})]})})),t(f.Item,{wrapperCol:{offset:4},children:t(U,{type:"dashed",onClick:()=>b(),block:!0,icon:t(Ne,{}),children:"Add Subscription"})})]})})}),g("div",{id:"calendar",className:N($.formBlock,{[$.show]:a==="calendarView"}),children:[t(f.Item,{label:"Default View",name:"defaultView",rules:[{required:!0}],children:t(H,{options:Ut})}),t(f.Item,{label:"Week Start Day",name:"weekStartDay",rules:[{required:!0}],children:g(H,{children:[t(H.Option,{value:0,children:"Sunday"}),t(H.Option,{value:1,children:"Monday"})]})}),t(f.Item,{label:"Time Grid",children:g("div",{className:"flex items-center",children:[t(f.Item,{noStyle:!0,name:"weekHourStart",children:t(ae,{min:0,max:24})}),t("span",{className:"px-2",children:"-"}),t(f.Item,{noStyle:!0,name:"weekHourEnd",children:t(ae,{min:0,max:24})})]})})]}),g("div",{id:"pomodoro",className:N($.formBlock,{[$.show]:a==="pomodoro"}),children:[t(f.Item,{label:"Pomodoro Length",name:["pomodoro","pomodoro"],rules:[{required:!0}],labelCol:{span:5},children:t(ae,{min:3,precision:0,addonAfter:"min"})}),t(f.Item,{label:"Short Break Length",name:["pomodoro","shortBreak"],rules:[{required:!0}],labelCol:{span:5},children:t(ae,{min:1,precision:0,addonAfter:"min"})}),t(f.Item,{label:"Long Break Length",name:["pomodoro","longBreak"],rules:[{required:!0}],labelCol:{span:5},children:t(ae,{min:1,precision:0,addonAfter:"min"})}),t(f.Item,{label:"Long Break Interval",name:["pomodoro","longBreakInterval"],rules:[{required:!0}],labelCol:{span:5},children:t(ae,{min:1,precision:0})}),[...new Array(5).keys()].map(y=>t(f.Item,{name:["pomodoro","commonPomodoros",y],label:y===0?"Common Pomodoro":"",labelCol:{span:5},...y===0?{}:{wrapperCol:{offset:5}},children:t(ae,{min:1,addonAfter:"min"})}))]}),g("div",{id:"todoist",className:N($.formBlock,{[$.show]:a==="todoist"}),children:[t(He,{message:"Restart logseq after modifying the configuration, and the synchronization icon will appear in toolbar.",type:"info",className:"mb-6"}),t(f.Item,{label:"API Token",name:["todoist","token"],labelCol:{span:8},tooltip:t(U,{type:"link",onClick:()=>logseq.App.openExternalLink("https://todoist.com/app/settings/integrations"),children:"Paste your todoist api token here"}),children:t(V,{placeholder:"Please input todoist api token"})}),t(f.Item,{label:"Sync",name:["todoist","sync"],labelCol:{span:8},children:t(H,{placeholder:"Please select",options:[{label:"All Todoist Projects",value:0},{label:"A Specific Todoist Project",value:1},{label:"A Specific Todoist Filter",value:2}]})}),t(f.Item,{noStyle:!0,shouldUpdate:(y,b)=>y.todoist?.sync!==b.todoist?.sync,children:({getFieldValue:y})=>{const b=y(["todoist","sync"]);return t(f.Item,{hidden:b!==2,label:"Todoist filter",name:["todoist","filter"],labelCol:{span:8},tooltip:t(U,{type:"link",onClick:()=>logseq.App.openExternalLink("https://todoist.com/help/articles/205248842"),children:"Define a filter for sync"}),required:b==2,rules:[{required:b==2,message:"Please enter a filter string"}],children:t(V,{placeholder:"Please input a todoist filter string"})})}}),t(f.Item,{noStyle:!0,shouldUpdate:(y,b)=>y.todoist?.sync!==b.todoist?.sync,children:({getFieldValue:y})=>{const b=y(["todoist","sync"]);return t(f.Item,{label:b===0?"Todoist project":"Todoist project for new logseq events",name:["todoist","project"],labelCol:{span:8},children:t(H,{placeholder:"Please select a todoist project",options:i,showSearch:!0,allowClear:!0,filterOption:(T,k)=>k?.label?.toLowerCase()?.includes(T?.toLowerCase())})})}}),t(f.Item,{label:"Todoist label for new logseq events",name:["todoist","label"],labelCol:{span:8},children:t(H,{placeholder:"Please select todoist label",options:d,showSearch:!0,allowClear:!0,filterOption:(y,b)=>b?.label?.toLowerCase()?.includes(y?.toLowerCase())})}),t(f.Item,{label:"Logseq block position",name:["todoist","position"],labelCol:{span:8},children:t(H,{placeholder:"Please select position page",options:r,allowClear:!0,showSearch:!0,optionFilterProp:"label",filterOption:(y,b)=>b?.label?.toLowerCase()?.includes(y?.toLowerCase())})})]})]})]}),t(Or,{visible:m,onSave:q,onCancel:()=>u(!1)})]})},Jr=[{value:"todo",label:"todo"},{value:"doing",label:"doing"},{value:"done",label:"done"},{value:"waiting",label:"waiting"},{value:"canceled",label:"canceled"}],Vr=({onSearch:e,initialValues:o})=>{const[a]=f.useForm();j();const[n,r]=x.exports.useState([]),s=()=>{a.validateFields().then(i=>{e(i)})};return x.exports.useEffect(()=>{logseq.Editor.getAllPages().then(i=>{const l=i?.filter(d=>!d?.["journal?"])?.map(d=>({value:d.originalName,label:d.originalName}));r([{value:"journal",label:"Journal"}].concat(l||[]))})},[]),g(f,{form:a,initialValues:o,layout:"inline",className:"mb-6",children:[t(f.Item,{label:"Timeframe",name:"timeframe",children:t(Re.RangePicker,{allowClear:!0,ranges:{Today:[p(),p()],"This Week":[p().weekday(0),p().weekday(6)],"Last Week":[p().weekday(-7),p().weekday(-1)],"This Month":[p().startOf("month"),p().endOf("month")],"Last Month":[p().subtract(1,"month").startOf("month"),p().subtract(1,"month").endOf("month")]}})}),t(f.Item,{label:"Status",name:"status",children:t(H,{options:Jr,mode:"multiple",placeholder:"Please select",style:{minWidth:"100px"},allowClear:!0})}),t(f.Item,{label:"Project",name:"project",children:t(H,{showSearch:!0,allowClear:!0,mode:"multiple",placeholder:"Project ID (Page Name)",optionFilterProp:"label",style:{minWidth:"240px"},options:n,filterOption:(i,l)=>l?.label?.toLowerCase()?.includes(i?.toLowerCase())})}),t(f.Item,{children:t(U,{type:"primary",onClick:()=>s(),children:"Review"})})]})},Kr=({data:e})=>{const o=x.exports.useRef(),a=ce();return x.exports.useEffect(()=>{const n=document.getElementById("mix-line-bar");async function r(){if(!n||!a)return;const s={tooltip:{trigger:"axis",axisPointer:{type:"cross",crossStyle:{color:"#999"}}},toolbox:{feature:{dataView:{show:!0,readOnly:!0},magicType:{show:!0,type:["line","bar"]},restore:{show:!0},saveAsImage:{show:!0}}},legend:{data:["Evaporation","Precipitation","Temperature"]},xAxis:[{type:"category",data:e.map(l=>{const d=p(l.date).format("DD");return d==="01"?p(l.date).format("MM.DD"):d}),axisPointer:{type:"shadow"}}],yAxis:[{type:"value",name:"Pomodoro Amount",interval:1,axisLabel:{formatter:"{value}"}},{type:"value",name:"Pomodoro Length",interval:20,axisLabel:{formatter:"{value} min"}}],series:[{name:"Pomodoro Amount",type:"bar",tooltip:{valueFormatter:function(l){return l}},data:e.map(l=>l?.pomodoros?.length)},{name:"Interruption Amount",type:"bar",tooltip:{valueFormatter:function(l){return l}},data:e.map(l=>l?.pomodoros?.reduce((d,c)=>d+(c.interruptions?.length||0),0))},{name:"Pomodoro Length",type:"line",yAxisIndex:1,tooltip:{valueFormatter:function(l){return l+" min"}},data:e.map(l=>Math.ceil(l?.pomodoros?.reduce((d,c)=>d+c.length,0)/60))}]},i=a==="dark"?"dark":"light";window.requestAnimationFrame(()=>{const l=_e(n,i);o.current=l,l.setOption(s)})}return r(),()=>{o.current&&o.current.dispose()}},[e,a]),t("div",{id:"mix-line-bar",style:{height:"400px",width:"100%"}})},Zr=({data:e})=>{const o=x.exports.useRef(),a=ce();return x.exports.useEffect(()=>{const n=document.getElementById("treemap"),r=oa;async function s(){if(!n||!a)return;const i={title:{text:"Project Time",left:"center"},toolbox:{feature:{dataView:{show:!0,readOnly:!0},saveAsImage:{show:!0}}},tooltip:{formatter:function(d){for(var c=d.value,m=d.treePathInfo,u=[],h=1;h<m.length;h++)u.push(m[h].name);return['<div class="tooltip-title">'+r.encodeHTML(u.join("/"))+"</div>","Pomodoro Length: "+r.addCommas(c)+" min"].join("")}},series:[{name:"Project Time",type:"treemap",visibleMin:300,data:e,label:{show:!0,formatter:"{b}"},upperLabel:{show:!0,height:30},itemStyle:{borderColor:"#fff"},levels:[{itemStyle:{borderColor:"#777",borderWidth:0,gapWidth:1},upperLabel:{show:!1}},{itemStyle:{borderColor:"#555",borderWidth:5,gapWidth:1},emphasis:{itemStyle:{borderColor:"#ddd"}}},{colorSaturation:[.35,.5],itemStyle:{borderWidth:5,gapWidth:1,borderColorSaturation:.6}}]}]},l=a==="dark"?"dark":"light";window.requestAnimationFrame(()=>{const d=_e(n,l);o.current=d,d.setOption(i)})}return s(),()=>{o.current&&o.current.dispose()}},[e,a]),t("div",{id:"treemap",style:{height:"600px",width:"100%"}})},Xr=(e,o)=>{let a=e;if(o.project?.length){const n=o.project?.some(r=>r==="journal");a=a.filter(r=>n&&r.addOns.isJournal||o.project?.some(s=>s===r.addOns.project))}if(o.status?.length){const n=ge(a);a=o.status.reduce((r,s)=>r.concat(n?.[s]||[]),[])}if(o.timeframe?.length){const[n,r]=o.timeframe;a=a.filter(s=>{if(!s.rawTime)return!1;const i=p(s.addOns.start),l=s.addOns.end?p(s.addOns.end):i;return i.isSameOrBefore(r,"day")&&l.isSameOrAfter(n,"day")})}return a.sort((n,r)=>p(n.addOns.start).diff(p(r.addOns.start)))},es=(e,o)=>{const a=e.map(c=>c.addOns.pomodoros).filter(Boolean)?.flat(),n=new Map;a?.forEach(c=>{if(!c)return;const m=p(c.start).startOf("day").valueOf();n.has(m)||n.set(m,[]),n.get(m)?.push(c)});const r=Math.min(...Array.from(n.keys())),s=Math.max(...Array.from(n.keys())),[i,l]=o||[p(r),p(s)];return Wa(i,l).map(c=>{const m=c?.startOf("day").valueOf();return{date:m,pomodoros:n.get(m)||[]}})},ts=e=>{const o=new Map;e.forEach(n=>{const r=n.addOns.project;o.has(r)||o.set(r,[]),o.get(r)?.push(n)});let a=[];return o.forEach((n,r)=>{a.push({name:r,value:Math.ceil(n.reduce((s,i)=>s+fo(i),0)/60),children:n.map(s=>({name:s.addOns.showTitle,value:Math.ceil(fo(s)/60)}))})}),a},Eo=e=>e.rawTime?p(e.addOns.start).valueOf():0,os=()=>{const[e]=E(fe),[o,a]=x.exports.useState({timeframe:[p().weekday(0),p().weekday(6)]}),n=Xr(e.tasks.withTime.concat(e.tasks.noTime),o),r=es(n,o?.timeframe),s=ts(n),i=l=>{a(l)};return t("div",{className:"page-container flex",children:g("div",{className:N("flex flex-1 flex-col overflow-hidden p-8"),children:[t("h1",{className:"title-text",children:"Review"}),g("div",{className:"bg-quaternary flex-1 rounded-2xl box-border p-6 overflow-auto",children:[t(Vr,{onSearch:i,initialValues:o}),t(ie,{dataSource:n,title:()=>t("div",{className:"flex justify-end",children:t(U,{size:"small",type:"link",onClick:()=>{Fa(n.map(l=>l.addOns.showTitle).join(`
`)),aa.success(`\u{1F973} ${n.length} pieces of data have been copied to clipboard!`)},children:"Export"})}),columns:[{title:"Title",dataIndex:["addOns","showTitle"],width:"240px",ellipsis:!0},{title:"Project",dataIndex:["page","original-name"],render:(l,d)=>d.addOns.isJournal?"Journal":l},{title:"Date",dataIndex:["addOns","start"],width:"240px",render:(l,d)=>d.rawTime?`${p(l).format("YYYY-MM-DD")} - ${p(d.addOns.end).format("YYYY-MM-DD")}`:"-",defaultSortOrder:"descend",sorter:(l,d)=>Eo(l)-Eo(d),filters:[{text:"Scheduled",value:"scheduled"},{text:"No Schedule",value:"noSchedule"}],onFilter:(l,d)=>l==="noSchedule"?!Boolean(d.rawTime):l==="scheduled"?Boolean(d.rawTime):!0},{title:"Status",dataIndex:["addOns","status"]},{title:"Pomodoro Amount",dataIndex:["addOns","pomodoros"],render:l=>l?.length},{title:"Pomodoro Length",dataIndex:["addOns","pomodoros"],render:l=>`${Math.ceil(l?.reduce((d,c)=>d+c.length,0)/60)} min`}]}),t(Kr,{data:r}),t(Zr,{data:s})]})]})})},as=()=>{const[e,o]=x.exports.useState([]);return x.exports.useEffect(()=>{Qa().then(a=>{o(a)})},[]),t("div",{className:"page-container flex",children:g("div",{className:N("flex flex-1 flex-col overflow-hidden p-8"),children:[t("h1",{className:"title-text",children:"Daily Log"}),t("div",{className:"bg-quaternary flex flex-col flex-1 rounded-2xl box-border p-6",children:t(At,{schedules:e,isProjectCalendar:!1,isDailyLogCalendar:!0})})]})})},st=[{label:"Dashboard",value:"dashboard",icon:t(na,{}),path:"/dashboard",element:t(pr,{})},{label:"Calendar",value:"calendar",icon:t(ra,{}),path:"/calendar",element:t(wr,{})},{label:"Gantt",value:"gantt",icon:t(sa,{}),path:"/gantt",element:t(xr,{})},{label:"Timeline",value:"timeline",icon:t(la,{}),path:"/timeline",element:t(Ar,{})},{label:"Daily Log",value:"dailyLogCalendar",icon:t(ia,{}),path:"/dailyLogCalendar",element:t(as,{})},{label:"Review",value:"review",icon:t(da,{}),path:"/review",element:t(os,{})},{label:"Settings",value:"settings",icon:t(ca,{}),path:"/settings",element:t(Qr,{})}],qo=({projectId:e,mode:o})=>{const[a]=E(tt),n=a?.find(s=>s.id===e),r=ce();return n?t(nt,{data:[n],weekStartDay:logseq.settings?.weekStartDay||0,theme:r,defaultMode:o,uniqueId:mt()}):null},ns="_page_1ia39_1",rs="_border_1ia39_9",ss="_linkText_1ia39_12";var Ot={page:ns,border:rs,linkText:ss};const ls=({upcomingList:e,waitingList:o,doneList:a,canceledList:n,onSelect:r,value:s})=>{const i=l=>t(Ie.Item,{onClick:()=>r(l),className:N("cursor-pointer px-2 rounded",{"bg-quinary":l.id+""===s}),children:g("div",{className:"flex justify-between w-full",children:[t("span",{children:l.addOns.showTitle}),l.rawTime&&t("span",{className:N(Ot.linkText,"whitespace-nowrap"),children:p(l.addOns.start).format("MM-DD")})]})});return t("div",{className:"w-full h-full",children:g(le,{ghost:!0,defaultActiveKey:["upcoming","waiting"],children:[t(le.Panel,{header:g("span",{children:[t("b",{children:"Upcoming"}),t("span",{className:"ml-2 description-text",children:e.length})]}),children:t(Ie,{dataSource:e,renderItem:i})},"upcoming"),t(le.Panel,{header:g("span",{children:[t("b",{children:"Waiting"}),t("span",{className:"ml-2 description-text",children:o.length})]}),children:t(Ie,{dataSource:o,renderItem:i})},"upcoming"),t(le.Panel,{header:g("span",{children:[t("b",{children:"Done"}),t("span",{className:"ml-2 description-text",children:a.length})]}),children:t(Ie,{dataSource:a,renderItem:i})},"done"),t(le.Panel,{header:g("span",{children:[t("b",{children:"Canceled"}),t("span",{className:"ml-2 description-text",children:n.length})]}),children:t(Ie,{dataSource:n,renderItem:i})},"canceled")]})})},is=({projectId:e})=>{const[o,a]=x.exports.useState(),[n]=E(De),[r]=E(Te),s=e==="Journal"?n:r.get(e),i=ge(s?.tasks?.noTime||[]),l=ge(s?.tasks?.withTime||[]),d=[...l.doing,...l.todo,...i.doing,...i.todo],c=[...l.done,...i.done],m=[...l.canceled,...i.canceled],u=[...l.waiting,...i.waiting],h=async(w,D)=>{logseq.Editor.scrollToBlockInPage(w,D),logseq.hideMainUI()};return g("div",{className:"w-full h-full flex",children:[t("div",{className:N("w-1/2 overflow-auto",Ot.border),children:t(ls,{waitingList:u,upcomingList:d,doneList:c,canceledList:m,onSelect:a,value:o?.id+""})}),t("div",{className:"w-1/2 overflow-auto",children:o&&g("div",{className:"pl-4",children:[t("h3",{children:o.addOns.showTitle}),t("p",{className:"whitespace-pre-line",children:o.content}),t(U,{type:"link",className:"px-0",onClick:()=>h(o.page.originalName,o.uuid),children:"Navigate To Block"})]})})]})},ds=()=>{const{projectId:e=""}=ua(),o=decodeURIComponent(e),[a]=E(Sn),[n]=E(On),r=o==="Journal"?a?.schedules:n.find(s=>s?.calendarConfig?.id===o)?.schedules||[];return g("div",{className:N(Ot.page,"page-container p-8 flex flex-col items-center"),children:[t("h1",{className:"title-text w-full",children:o}),t("div",{className:"rounded-2xl flex w-full h-full p-6 bg-quaternary",children:o&&g(Ee,{className:"w-full",tabPosition:"left",children:[t(Ee.TabPane,{tab:"List",children:t(is,{projectId:o})},"list"),t(Ee.TabPane,{tab:"Calendar",children:t(At,{schedules:r,isProjectCalendar:!0})},"calendar"),t(Ee.TabPane,{tab:"Gantt",children:t(qo,{projectId:o,mode:"advanced"})},"gantt"),t(Ee.TabPane,{tab:"Timeline",children:t(qo,{projectId:o,mode:"simple"})},"timeline")]})})]})},cs=({defaultRoute:e})=>{const[,o]=E(rt),[,a]=E(fe),[,n]=E(De),[,r]=E(Te),{homePage:s=K.homePage,logKey:i}=j(),l=st.find(c=>c.value===s)?.element,d=i?.enabled?st:st.filter(c=>c.value!=="dailyLogCalendar");return x.exports.useEffect(()=>{async function c(){const m=await vt();if(m){const{fullEvents:h,journalEvents:w,projectEventsMap:D}=m;a(h),n(w),r(D)}const{subscriptionList:u}=j();o(await No(u))}c()},[]),t("main",{className:"w-screen h-screen flex",prefix:"custom",children:g(ma,{children:[t(kn,{defaultRoute:e,menus:d}),g(pa,{children:[t(dt,{path:"/",element:l}),d.map(c=>t(dt,{path:c.path,element:c.element},c.value)),t(dt,{path:"/project/:projectId",element:t(ds,{})})]})]})})};const us=({visible:e,uuid:o,onSave:a,onCancel:n})=>{const[r,s]=x.exports.useState(!1),[i]=E(et),l=i.map(h=>({label:h.addOns.showTitle,value:h.uuid})),[d,c]=x.exports.useState([]),m=()=>{l.length===d.length?c([]):c(l.map(h=>h.value))},u=async()=>{let h=[];for(let w=0;w<d.length;w++){const D=await xe({uuid:d[w]});h.push(D)}logseq.Editor.insertBatchBlock(o,h.map(w=>({content:`((${w?.uuid}))`})),{before:!1,sibling:!0}),a()};return x.exports.useEffect(()=>{d?.length>0&&d.length<l.length?s(!0):s(!1)},[d?.length,l?.length]),g(se,{visible:e,title:"Insert Today Task",onCancel:n,onOk:u,children:[t(He,{className:"mb-2",message:"It is not recommended to use this feature for the time being, as it may cause some block refs to be lost after reindex, unless you ensure that all embed blocks generate id.",type:"warning"}),t(He,{className:"mb-2",message:"You can jump to the corresponding block by clicking the task from the sidebar and then copy the block ref.",type:"warning"}),t(ct.Group,{value:d,onChange:h=>c(h),children:l.map((h,w)=>t(Lt,{children:t(it,{span:24,children:t(ct,{value:h.value,children:h.label},h.value)})}))}),t(Bt,{}),t(ct,{indeterminate:r,checked:l.length===d.length,onClick:m,children:"Check All"})]})},ms=({visible:e,onCancel:o,onOk:a,data:n})=>{const[r]=f.useForm();return x.exports.useEffect(()=>{n&&r.setFieldsValue({...n,start:n.start?p(n.start):p(),length:Math.ceil(n.length/60)||1,interruptions:n.interruptions?.map(s=>({...s,time:s.time?p(s.time):p()}))||[]})},[n?.start]),t(se,{title:"Modify Pomodoro",visible:e,onCancel:o,onOk:async()=>{const s=await r.validateFields();a({...s,start:s.start.valueOf(),length:s.length*60,interruptions:s.interruptions?.map(i=>({...i,time:i.time.valueOf()}))})},children:g(f,{form:r,children:[t(f.Item,{name:"isFull",label:"Is Full",rules:[{required:!0}],children:g(W.Group,{children:[t(W,{value:!0,children:"Full Tomato"}),t(W,{value:!1,children:"Half Tomato"})]})}),t(f.Item,{name:"start",label:"Start Time",rules:[{required:!0}],children:t(Re,{showTime:{format:"HH:mm"},format:"YYYY-MM-DD HH:mm"})}),t(f.Item,{name:"length",label:"Length",rules:[{required:!0}],children:t(ae,{min:1,addonAfter:"min"})})]})})},ps=({data:e,onCancel:o,onOk:a,visible:n})=>{const[r,s]=x.exports.useState(e.addOns.pomodoros||[]),[i,l]=x.exports.useState({visible:!1}),d=()=>{const{pomodoro:c}=j();s([...r,{start:p().valueOf(),length:c.pomodoro*60,isFull:!0}])};return x.exports.useEffect(()=>{s(e.addOns.pomodoros||[])},[e.uuid]),g(se,{title:"Pomodoro",okText:"Save",width:"800px",visible:n,onCancel:o,onOk:async()=>{const c=await kt(e.uuid,r,"update");c&&logseq.Editor.updateBlock(e.uuid,c),o()},children:[t(U,{type:"primary",onClick:d,className:"mb-4",icon:t(Ne,{}),children:"Add New Pomodoro"}),t(ie,{pagination:!1,dataSource:r,id:"start",columns:[{title:"Full Tomato",dataIndex:"isFull",render(c,m,u){return c?"\u2705":"\u274C"}},{title:"Length",dataIndex:"length",render:c=>`${Math.ceil(c/60)} min`},{title:"Start",dataIndex:"start",width:"200px",render:c=>p(c).format("YYYY-MM-DD HH:mm")},ie.EXPAND_COLUMN,{title:"Interruption",dataIndex:"interruptions",render:(c,m,u)=>c?.length||0},{title:"Action",dataIndex:"operation",render:(c,m,u)=>t(U,{type:"link",onClick:()=>l({visible:!0,data:m}),children:"Edit"})}],expandable:{rowExpandable:c=>Boolean(c?.interruptions?.length),expandedRowRender:c=>t(ie,{size:"small",dataSource:c.interruptions,pagination:!1,columns:[{title:"Type",dataIndex:"type",render:m=>m===1?t(Ft,{color:"green",children:"Internal"}):t(Ft,{color:"magenta",children:"External"})},{title:"Time",dataIndex:"time",render:m=>p(m).format("YYYY-MM-DD HH:mm")},{title:"Remark",dataIndex:"remark"}]})},summary:c=>c?.length?t(re,{children:g(ie.Summary.Row,{children:[t(ie.Summary.Cell,{index:0,children:"Total"}),g(ie.Summary.Cell,{index:1,colSpan:3,children:[Math.ceil(c.reduce((m,u)=>m+u.length,0)/60)," min"]}),t(ie.Summary.Cell,{index:4,colSpan:2,children:c.reduce((m,u)=>m+(u.interruptions?.length||0),0)})]})}):null}),t(ms,{visible:i.visible,data:i.data,onCancel:()=>l({visible:!1}),onOk:c=>{i?.data?.start&&(s(r.map(m=>m.start===i.data?.start?{...m,...c}:m)),l({visible:!1}))}})]})},hs=e=>{E(xo);const[,o]=E(fe),[,a]=E(De),[,n]=E(Te),r=e.type,s=()=>{logseq.hideMainUI()},i=()=>{logseq.hideMainUI()};return x.exports.useEffect(()=>{async function l(){const d=await vt();if(d){const{fullEvents:c,journalEvents:m,projectEventsMap:u}=d;o(c),a(m),n(u)}}r==="insertTodaySchedule"&&l()},[r]),g("div",{className:"w-screen h-screen",children:[r==="editSchedule"&&t(To,{visible:!0,showKeepRef:e.showKeepRef,type:e.data.type,initialValues:e.data.initialValues,onSave:s,onCancel:i}),r==="insertTodaySchedule"&&t(us,{visible:!0,uuid:e.data.uuid,onSave:s,onCancel:i}),r==="pomodoro"&&t(ps,{visible:!0,data:e.data,onOk:s,onCancel:i})]})};function gs(e,o=!1){const a=e?.addOns.start,n=e?.addOns.end,r=p(a),s=p(n),i=r.isSame(s,"day");return o?e.addOns.allDay?i?{start:r.format("MM-DD")}:{start:r.format("MM-DD"),end:s.format("MM-DD")}:i&&r.isSame(p(),"day")?{start:r.format("HH:mm"),end:s.format("HH:mm")}:i?{start:r.format("MM-DD")}:{start:r.format("MM-DD"),end:s.format("MM-DD")}:i?e.addOns.allDay?{start:"all-day"}:{start:r.format("HH:mm"),end:s.format("HH:mm")}:{start:r.format("MM-DD"),end:s.format("MM-DD")}}const Nt=({task:e,type:o="allDay"})=>{const a=p(e.addOns.start),n=p(e.addOns.end),r=o==="time"&&p().isBetween(a,n),s=e.addOns.status==="done",i=e.addOns.calendarConfig,{start:l,end:d}=gs(e,o==="overdue");return g("div",{className:"agenda-sidebar-task flex cursor-pointer",style:{margin:"10px 0",opacity:s?.4:.9},onClick:async()=>{const{id:m,originalName:u}=e?.page||{};let h=u;h||(h=(await de({id:m}))?.originalName),logseq.Editor.scrollToBlockInPage(h,e.uuid)},children:[g("div",{className:"flex flex-col justify-between text-right",style:{color:o==="overdue"?"#ed4245":"var(--ls-icon-color)",fontSize:"0.8em",width:"50px"},children:[t("div",{className:"w-full",children:l}),d&&t("div",{className:"w-full",style:{opacity:.6},children:d})]}),t("div",{style:{width:"4px",backgroundColor:i?.bgColor,borderRadius:"2px",margin:"0 6px"}}),g("div",{style:{width:"calc(100% - 90px)",paddingBottom:"24px",position:"relative"},children:[t("div",{style:{color:"var(--ls-icon-color)",fontSize:"0.8em",opacity:.6},children:i?.id}),t("div",{className:"agenda-sidebar-task__title",style:{marginBottom:"-0.2em",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",position:"absolute",bottom:0,width:"calc(100% - 30px)"},title:e.addOns.showTitle,children:e.addOns.showTitle}),r&&t("span",{className:"ui__button bg-indigo-600",style:{fontSize:"0.5em",position:"absolute",right:0,bottom:0,padding:"0 3px",borderRadius:"3px"},children:"NOW"})]})]})};function fs(e){const o=e.start,a=e.end,n=p(o),r=p(a);return n.isSame(r,"day")?e.isAllDay?{start:"all-day"}:{start:n.format("HH:mm"),end:r.format("HH:mm")}:{start:n.format("MM-DD"),end:r.format("MM-DD")}}const Po=({subscription:e,type:o="allDay"})=>{const a=p(e.start),n=p(e.end),r=o==="time"&&p().isBetween(a,n),{start:s,end:i}=fs(e);return g("div",{className:"agenda-sidebar-task flex cursor-pointer",style:{margin:"10px 0",opacity:.9},children:[g("div",{className:"flex flex-col justify-between text-right",style:{color:"var(--ls-icon-color)",fontSize:"0.8em",width:"50px"},children:[t("div",{className:"w-full",children:s}),i&&t("div",{className:"w-full",style:{opacity:.6},children:i})]}),t("div",{style:{width:"4px",backgroundColor:e.bgColor,borderRadius:"2px",margin:"0 6px"}}),g("div",{style:{width:"calc(100% - 90px)",paddingBottom:"24px",position:"relative"},children:[t("div",{style:{color:"var(--ls-icon-color)",fontSize:"0.8em",opacity:.6},children:e?.calendarId}),t("div",{className:"agenda-sidebar-task__title",style:{marginBottom:"-0.2em",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",position:"absolute",bottom:0,width:"calc(100% - 30px)"},title:e.title,children:e.title}),r&&t("span",{className:"ui__button bg-indigo-600",style:{fontSize:"0.5em",position:"absolute",right:0,bottom:0,padding:"0 3px",borderRadius:"3px"},children:"NOW"})]})]})},ys=({containerId:e})=>{E(xo);const[o]=E(Co),{allDaySubscriptions:a,timeSubscriptions:n}=ao(o),[r]=E(et),{overdueTasks:s,allDayTasks:i,timeTasks:l}=oo(r),[,d]=E(fe),[,c]=E(De),[,m]=E(Te);return x.exports.useEffect(()=>{async function u(){const h=await vt();if(h){const{fullEvents:w,journalEvents:D,projectEventsMap:A}=h;d(w),c(D),m(A)}}u(),logseq.DB.onChanged(({blocks:h,txData:w,txMeta:D})=>{w?.some(A=>A?.[1]==="marker")&&parent.document.querySelector("#"+e)&&u()})},[]),g("main",{children:[s?.length===0&&i?.length===0&&l?.length===0&&t("div",{children:"Empty task list"}),s.length>0&&t("div",{style:{margin:"8px 0"},children:s.map(u=>t(Nt,{task:u,type:"overdue"},u.id))}),(i.length>0||a.length>0)&&g("div",{children:[a.map(u=>t(Po,{subscription:u,type:"allDay"},u.id)),i.map(u=>t(Nt,{task:u,type:"allDay"},u.id))]}),(l.length>0||n.length>0)&&g("div",{children:[n.map(u=>t(Po,{subscription:u,type:"time"},u.id)),l.map(u=>t(Nt,{task:u,type:"time"},u.id))]})]})},ws=({visible:e,pomodoroId:o,uuid:a,onCancel:n,onOk:r})=>{const[s]=f.useForm();return t(se,{title:"Record Inerruption",visible:e,onCancel:n,onOk:async()=>{const i=await s.validateFields(),l=window.interruptionMap.get(o)||[];window.interruptionMap.set(o,l.concat({type:i.type,remark:i.remark,time:p().valueOf()})),n()},children:g(f,{form:s,labelCol:{span:4},children:[t(f.Item,{name:"type",label:"Type",initialValue:1,rules:[{required:!0}],children:t(W.Group,{optionType:"button",buttonStyle:"solid",options:[{label:"Internal",value:1},{label:"External",value:2}]})}),t(f.Item,{name:"remark",label:"Remark",rules:[{required:!0}],children:t(V,{maxLength:50,showCount:!0})})]})})},Le=({label:e,onClick:o,classNames:a=""})=>t("button",{onClick:o,className:`border-transparent font-medium shadow-sm px-3 py-2 text-sm leading-4 rounded-md bg-red-600 hover:bg-red-500 text-white uppercase cursor-pointer ${a}`,children:e}),bs=({label:e,onClick:o,classNames:a=""})=>t("button",{onClick:o,className:`border-transparent bg-transparent font-medium shadow-sm w-12 h-5 text-xs leading-4 rounded-md border border-solid cursor-pointer description-text ${a}`,children:e}),ks=({uuid:e})=>{const o=x.exports.useMemo(()=>{const{pomodoro:k}=j();return{...k,pomodoro:k.pomodoro*60,shortBreak:k.shortBreak*60,longBreak:k.longBreak*60,notificationConfig:{type:"every",time:5}}},[e]),{state:a,start:n,stop:r,reset:s,goPomodoro:i,goShortBreak:l,goLongBreak:d,changeConfig:c}=ha(o),{pomodoro:m}=j(),[u,h]=x.exports.useState(),w=a.type==="pomodoro",D=x.exports.useRef(),[A,q]=x.exports.useState(!1),C=k=>{c({...a.config,pomodoro:k*60})},v=async()=>{if(!u)return;const{id:k,originalName:S}=u?.page||{};let L=S;L||(L=(await de({id:k}))?.originalName),logseq.Editor.scrollToBlockInPage(L,u.uuid)},y=()=>{n();const k=p().valueOf();D.current=k,window.interruptionMap.set(k,[])},b=async()=>{const k=a.config.pomodoro,S=a.timer;s();const L=await kt(e,{isFull:!1,start:D.current,length:k-S,interruptions:window.interruptionMap.get(D.current)||[]});L&&logseq.Editor.updateBlock(e,L)},T=()=>{const{progress:k}=a;return w?k===0?t(Le,{label:"start",onClick:y}):[t(Le,{label:"stop",onClick:s},"stop"),t(Le,{label:"finish",onClick:b,classNames:"ml-2"},"finish")]:k===0?t(Le,{label:"start",onClick:n,classNames:"bg-green-600 hover:bg-green-500"}):t(Le,{label:"skip",onClick:i,classNames:"bg-green-600 hover:bg-green-500"})};return x.exports.useEffect(()=>{logseq.App.registerUIItem("toolbar",{key:"logseq-plugin-agenda-pomodoro",template:po(e,a.formattedTimer,a.progress,a.type!=="pomodoro")}),window.currentPomodoro={uuid:e,state:{paused:a.paused}}},[a.formattedTimer,a.type,a.paused,e]),x.exports.useEffect(()=>{if(!!e){if(!a.paused)return logseq.App.showMsg("Pomodoro is running, please stop it first.","error");logseq.Editor.getBlock(e).then(async k=>{if(!k)return;const S=await oe(k,j());h(S)})}},[e]),x.exports.useEffect(()=>{w&&a.progress===1&&e&&(kt(e,{isFull:!0,start:D.current,length:a.config.pomodoro,interruptions:window.interruptionMap.get(D.current)||[]}).then(k=>logseq.Editor.updateBlock(e,k)),Ga("Pomodoro is finished!"))},[w,a.progress,e]),g(re,{children:[t("div",{className:"fixed top-0 left-0 w-screen h-screen",onClick:()=>logseq.hideMainUI()}),g("div",{className:"fixed right-10 shadow-md px-4 py-6 rounded-md bg-quaternary flex",style:{top:"48px",minWidth:"300px"},children:[g("div",{className:"flex-1",children:[g("div",{className:"singlge-line-ellipsis cursor-pointer description-text flex items-center",style:{maxWidth:"220px"},onClick:v,title:u?.addOns.showTitle,children:[u?.addOns.showTitle,t(jt,{})]}),g("div",{children:[t("p",{className:"text-center text-4xl mt-6 mb-6",children:a.formattedTimer}),t("div",{className:"flex flex-row justify-center",children:T()})]})]}),t("div",{className:"flex flex-col w-12 justify-between pt-2",children:m?.commonPomodoros?.map(k=>t(bs,{label:k+"min",onClick:()=>C(k)},k))}),g("div",{className:"absolute right-5 top-1 opacity-60",children:[t(ga,{className:"cursor-pointer",onClick:()=>q(!0)}),t(It,{className:"ml-2 cursor-pointer",onClick:()=>{logseq.hideMainUI(),window?.unmountPomodoroApp(),window.currentPomodoro={},window.interruptionMap.delete(D.current),logseq.App.registerUIItem("toolbar",{key:"logseq-plugin-agenda-pomodoro",template:'<div class="agenda-toolbar-pompdoro hide"></div>'})}})]})]}),t(ws,{pomodoroId:D.current,visible:A,onCancel:()=>q(!1)})]})};p.extend(fa);p.extend(ya);p.extend(wa);p.extend(ba);p.extend(ka);p.extend(va);p.extend(xa);p.extend(Ca);Da([Ta,Aa,Sa,Oa,Na,Ma,Ia,Ea,qa,Pa]);ve("=== logseq-plugin-agenda loaded ==="),logseq.ready(()=>{an();const{weekStartDay:e,todoist:o}=j();p.updateLocale("en",{weekStart:e}),Jt(),Notification.requestPermission(),logseq.App.getUserConfigs().then(n=>{window.logseqAppUserConfigs=n}),$a(()=>logseq.hideMainUI()),logseq.App.onThemeModeChanged(({mode:n})=>{ze(n)}),logseq.on("ui:visible:changed",n=>{!n.visible&&window.currentApp!=="pomodoro"&&be.unmountComponentAtNode(document.getElementById("root"))}),logseq.provideModel({show(){jo(),logseq.showMainUI()},showPomodoro(n){const r=n.dataset.uuid;if(!r)return logseq.App.showMsg("uuid is required");Bo(r),logseq.showMainUI()},pullTodoistTasks(){Rr()}}),logseq.App.registerUIItem("toolbar",{key:"logseq-plugin-agenda",template:'<a data-on-click="show" class="button"><i class="ti ti-comet"></i></a>'}),o?.token&&(logseq.App.registerUIItem("toolbar",{key:"plugin-agenda-todoist",template:'<a data-on-click="pullTodoistTasks" class="button"><i class="ti ti-chevrons-down"></i></a>'}),St(),logseq.DB.onChanged(({blocks:n,txData:r,txMeta:s})=>{on(async l=>{const d=await logseq.Editor.getBlock(l),c=await oe(d,j()),m=c.properties?.todoistId;try{const u=await Hr(m),h=$t(Be,D=>D===c.priority);let w={content:c.addOns.contentWithoutTime?.split(`
`)?.[0],description:d?.properties?.todoistDesc,priority:h};if(c.addOns.allDay===!0&&(w.dueDate=p(c.addOns.start).format("YYYY-MM-DD")),c.addOns.allDay===!1&&(w.dueDatetime=p.utc(c.addOns.start).format()),c.rawTime||(w.dueString="no due date"),c.addOns.status==="done"&&u?.completed===!1)return Fr(m);if(c.addOns.status!=="done"&&u?.completed===!0)return $r(m);Yr(m,w)}catch(u){if(u.httpStatusCode===404)return logseq.App.showMsg(`Sync Error
message: ${u?.responseData}
Please check whether the task has been deleted or whether the todoist-id is correct`,"error")}})?.({blocks:n,txData:r,txMeta:s})}),logseq.Editor.registerBlockContextMenuItem("Agenda: Upload to todoist",async({uuid:n})=>{const r=j(),{todoist:s}=r,i=await logseq.Editor.getBlock(n);if(!i?.marker)return logseq.App.showMsg("This block is not a task","error");if(i?.properties?.todoistId)return logseq.App.showMsg(`This task has already been uploaded,
please do not upload it again`,"error");const l=await oe(i,r),d=$t(Be,m=>m===l.priority);let c={content:l.addOns.contentWithoutTime?.split(`
`)?.[0],description:i?.properties?.todoistDesc,priority:d};l.addOns.allDay===!0&&(c.dueDate=p(l.addOns.start).format("YYYY-MM-DD")),l.addOns.allDay===!1&&(c.dueDatetime=p.utc(l.addOns.start).format()),s?.project&&(c.projectId=s.project),s?.label&&(c.labelIds=[s.label]),Ur(c)?.then(async m=>(await Mo(l,m),logseq.App.showMsg("Upload task to todoist success"))).catch(m=>{logseq.App.showMsg("Upload task to todoist failed","error"),console.error("[faiz:] === Upload task to todoist failed",m)})})),logseq.App.registerCommandPalette({key:"logseq-plugin-agenda:show",label:"Show Agenda",keybinding:{binding:"ctrl+shift+a"}},n=>{jo(),logseq.showMainUI()}),window.unmountPomodoroApp=()=>be.unmountComponentAtNode(document.getElementById("pomodoro-root")),window.interruptionMap=new Map;const a=async n=>{let r=await logseq.Editor.getBlock(n.uuid);const s=await Promise.all(r.refs?.map(l=>logseq.Editor.getPage(l.id)));r.refs=s;const i=await oe(r,j());lt({type:"editSchedule",data:{type:"update",initialValues:{id:i.uuid,start:p(i.addOns.start),end:p(i.addOns.end),isAllDay:i.addOns.allDay,calendarId:i.addOns.calendarConfig?.id,title:i.addOns.showTitle,raw:i}},showKeepRef:!0}),logseq.showMainUI()};logseq.App.registerPageMenuItem("Agenda: Add this page to agenda project",async({page:n})=>{const r=await logseq.Editor.getPage(n);if(!r)return logseq.UI.showMsg("Page not found","error");const s=logseq.settings?.projectList||[],i=r.originalName;if(s.find(d=>d.id===i))return logseq.UI.showMsg("This Page is already in agenda project","warning");const l={...Qt,id:i};logseq.updateSettings({projectList:1}),logseq.updateSettings({...logseq.settings,projectList:s.concat(l)}),logseq.App.showMsg("Successfully added")}),logseq.Editor.registerBlockContextMenuItem("Agenda: Modify Schedule",a),logseq.Editor.registerBlockContextMenuItem("Agenda: Start Pomodoro Timer",async({uuid:n})=>{if(logseq.App.registerUIItem("toolbar",{key:"logseq-plugin-agenda-pomodoro",template:po(n,"--:--",0)}),window?.currentPomodoro?.uuid!==n&&window?.currentPomodoro?.state?.paused===!1)return logseq.App.showMsg("Another block is running pomodoro timer, please finish it first","error");setTimeout(()=>{Bo(n),logseq.showMainUI()},0)}),logseq.Editor.registerSlashCommand("Agenda: Modify Schedule",a),logseq.Editor.registerSlashCommand("Agenda: Insert Today's Task",n=>(lt({type:"insertTodaySchedule",data:{uuid:n.uuid}}),logseq.showMainUI(),Promise.resolve())),logseq.Editor.registerSlashCommand("Agenda: Insert Task List",async()=>{logseq.Editor.insertAtEditingCursor("{{renderer agenda, task-list}}")}),logseq.App.onMacroRendererSlotted(async({slot:n,payload:{arguments:r,uuid:s}})=>{if(r?.[0]==="agenda"){if(r?.[1]==="task-list"){if(parent.document.getElementById(n)?.childElementCount)return;const l=`agenda-task-list-${n}`;logseq.provideUI({key:`agenda-${n}`,slot:n,reset:!0,template:`<div id="${l}"></div>`}),logseq.provideStyle(`${mo}
          #block-content-${s} .lsp-hook-ui-slot {
            width: 100%;
          }
          #block-content-${s} .lsp-hook-ui-slot > div {
            width: 100%;
          }
          #block-content-${s} .lsp-hook-ui-slot > div > div {
            width: 100%;
          }
        `),setTimeout(()=>{be.render(t(Fe.StrictMode,{children:t(ys,{containerId:l})}),parent.document.getElementById(l))},0)}else if(r?.[1]==="pomodoro-timer"){const i=`agenda-pomodoro-timer-${n}`;logseq.provideUI({key:`agenda-${n}`,slot:n,reset:!0,template:`<div id="${i}"></div>`})}}}),logseq.setMainUIInlineStyle({zIndex:1e3}),logseq.provideStyle(mo),top&&top.document.addEventListener("click",async n=>{const r=n.composedPath(),s=r[0];if(s.tagName==="A"&&s.className.includes("external-link")&&s.getAttribute("href")?.startsWith("#agenda")){let i="agenda";s.getAttribute("href")?.startsWith("#agenda-pomo://")&&(i="pomodoro");const l=tn(r);if(!l)return;const d=await logseq.Editor.getBlock(l),c=await logseq.Editor.getPage(d.page?.id),m=await oe(d,j());i==="agenda"?lt({type:"editSchedule",data:{type:"update",initialValues:{id:l,title:m.addOns.showTitle,calendarId:c?.originalName,keepRef:!1,start:p(m.addOns.start),end:p(m.addOns.end),isAllDay:m.addOns.allDay,raw:m}}}):i==="pomodoro"&&lt({type:"pomodoro",data:m}),logseq.showMainUI()}})});async function jo(){window.currentApp="app",bt(!1),ut(!1);let e="";const o=await logseq.Editor.getCurrentPage(),{projectList:a=[]}=j();a.some(n=>Boolean(n.id)&&n.id===o?.originalName)&&(e=`project/${encodeURIComponent(o?.originalName)}`),be.render(t(Fe.StrictMode,{children:t(cs,{defaultRoute:e})}),document.getElementById("root"))}function lt(e){window.currentApp="modal",bt(!1);const{type:o,data:a}=e;ut(!0),be.render(t(Fe.StrictMode,{children:t(hs,{type:o,data:a,showKeepRef:e.showKeepRef})}),document.getElementById("root"))}function Bo(e){window.currentApp="pomodoro",bt(!0),ut(!0),be.render(t(Fe.StrictMode,{children:t(ks,{uuid:e})}),document.getElementById("pomodoro-root"))}
