import{f as l,p as h,R as a,r as u,u as d,a as M}from"./vendor.53d1de2e.js";const b=function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))n(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function s(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerpolicy&&(o.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?o.credentials="include":t.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(t){if(t.ep)return;t.ep=!0;const o=s(t);fetch(t.href,o)}};b();const q="modulepreload",f={},v="",E=function(r,s){return!s||s.length===0?r():Promise.all(s.map(n=>{if(n=`${v}${n}`,n in f)return;f[n]=!0;const t=n.endsWith(".css"),o=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${n}"]${o}`))return;const i=document.createElement("link");if(i.rel=t?"stylesheet":q,t||(i.as="script",i.crossOrigin=""),i.href=n,document.head.appendChild(i),t)return new Promise((g,y)=>{i.addEventListener("load",g),i.addEventListener("error",y)})})).then(()=>r())},m="logseq-heatmap-trigger-icon",w=()=>{const[e,r]=u.exports.useState(logseq.isMainUIVisible),s=d();return a.useEffect(()=>{const n="ui:visible:changed",t=async({visible:o})=>{s()&&r(o)};return logseq.on(n,t),()=>{logseq.off(n,t)}},[s]),e},I=()=>{const[e,r]=a.useState(null),s=a.useCallback(async()=>{const n=await logseq.Editor.getCurrentPage();r(n)},[]);return a.useEffect(()=>(s(),logseq.App.onRouteChanged(s)),[s]),e},$=()=>{const e=I();return a.useMemo(()=>e&&e["journal?"]&&e.journalDay?A(e.journalDay):null,[e])},S=()=>{const e=d(),[r,s]=a.useState("light");return a.useEffect(()=>{s(top?.document.querySelector("html")?.getAttribute("data-theme")??(matchMedia("prefers-color-scheme: dark").matches?"dark":"light")),logseq.App.onThemeModeChanged(n=>{console.log(n),e()&&s(n.mode)})},[e]),r};let p="MMM do, yyyy";async function _(){let e=(await logseq.App.getUserConfigs())?.preferredDateFormat??"MMM do, yyyy";return p=e,e}const c=e=>typeof e!="string"?e:new Date(e),R=e=>l(c(e),"yyyy-MM-dd"),N=e=>l(c(e),"yyyyMMdd"),O=e=>l(c(e),p),A=e=>h(`${e}`,"yyyyMMdd",new Date),D=a.lazy(()=>E(()=>import("./Heatmap.929fdc1a.js"),["assets/Heatmap.929fdc1a.js","assets/Heatmap.37e5dcb5.css","assets/vendor.53d1de2e.js"]).then(e=>({default:e.Heatmap})));function k(){const e=u.exports.useRef(null),r=w(),s=S(),[n,t]=a.useState(r);return a.useEffect(()=>{if(r)t(!0);else{const o=setTimeout(()=>{t(!1)},1*1e3);return()=>{clearTimeout(o)}}},[r]),n?a.createElement(a.Suspense,{fallback:"loading..."},a.createElement("main",{className:`absolute inset-0 ${s}`,onClick:o=>{e.current?.contains(o.target)||window.logseq.hideMainUI()}},a.createElement(D,{ref:e}))):null}const x=(e,...r)=>String.raw(e,...r),P="__heatmap__plugin__loaded__";function C(){const e=logseq.baseInfo.id;console.info(`#${e}: MAIN`),M.render(a.createElement(a.StrictMode,null,a.createElement(k,null)),document.getElementById("app"));function r(){return{async show(){await _(),logseq.showMainUI()}}}logseq.provideModel(r()),logseq.setMainUIInlineStyle({zIndex:11,maxWidth:"calc(100% - 10px)"}),top[P]=!0,logseq.provideStyle(x`
    .${m} {
      width: 18px;
      height: 18px;
      margin: 2px 0.4em 0 0.4em;
      background-color: #26a641;
      border-radius: 4px;
      border: 1px solid #eee;
    }
  `),logseq.App.registerUIItem("toolbar",{key:"heatmap-plugin-open",template:`
    <a data-on-click="show">
      <div class="${m}"></div>
    </a>
  `})}logseq.ready(C).catch(console.error);export{O as a,N as b,R as f,A as p,m as t,$ as u};
